{"version":3,"sources":["LoginScreen.js","NavigationBar.js","PolicyList.js","accesscontrol/syntax/Attribute.js","accesscontrol/syntax/Request.js","accesscontrol/syntax/Response.js","accesscontrol/syntax/Combinator.js","accesscontrol/syntax/Comparator.js","accesscontrol/syntax/Evaluable.js","accesscontrol/syntax/Rule.js","accesscontrol/syntax/CombiningAlgorithm.js","accesscontrol/syntax/Policy.js","constants/index.js","policycomponents/ConnectingLine.js","policycomponents/DecisionLine.js","hooks/PolicyEditorContext.js","hooks/useRule.js","policycomponents/RuleComponent.js","hooks/usePolicy.js","policycomponents/PolicyComponent.js","PolicyStage.js","ShadeHeader.js","PolicyComponentEditor.js","RuleComponentEditor.js","hooks/EvaluableErrorContext.js","hooks/useEvaluable.js","evaluablecomponents/EmptyComponent.js","evaluablecomponents/CombinatorComponent.js","evaluablecomponents/AttributeComponent.js","evaluablecomponents/HasAttributeComponent.js","evaluablecomponents/ValueComponent.js","evaluablecomponents/ComparatorComponent.js","evaluablecomponents/ActionTypeComponent.js","evaluablecomponents/EvaluableComponent.js","EvaluableShade.js","evaluablecomponents/DraggableEvaluable.js","DrawerEvaluables.js","DrawerActions.js","DrawerAttributes.js","EvaluableEditorDrawer.js","SelectedComponentShade.js","GroupUsersShade.js","GroupDevicesShade.js","EnvironmentShade.js","RequestBuilder.js","ControlPanel.js","PolicyEditor.js","App.js","serviceWorker.js","index.js"],"names":["LoginScreenComponent","props","failedAlert","_useState","useState","_useState2","Object","slicedToArray","username","setUsername","_useState3","_useState4","remote","setRemote","_useState5","_useState6","failed","setFailed","_useState7","_useState8","error","setError","react_default","a","createElement","className","role","placeholder","value","onChange","e","target","type","onClick","axios","post","then","response","data","status","localStorage","setItem","JSON","stringify","user","setLoggedInUser","catch","err","console","log","NavigationBar","parse","getItem","name","removeItem","PolicyList","groupPolicies","setGroupPolicies","devicePolicies","setDevicePolicies","useEffect","get","headers","Authorization","id","groups","devices","groupSection","length","Fragment","scope","map","policy","setSelectedPolicy","deviceSection","Attribute","data_type","classCallCheck","this","attribute_id","rawObj","Error","Request","Subject","Attributes","Resource","Action","Type","Environment","obj","attr","assign","res","find","undefined","push","db","userid","_this","Promise","resolve","reject","row","_addSubjectAttribute","_this2","all","rows","datatype","deviceid","_this3","_addResourceAttribute","ownerid","_this4","populateUserDefaultAttributes","populateUserCustomAttributes","populateDeviceDefaultAttributes","populateDeviceCustomAttributes","Response","description","Decision","Obligations","decision","obligation","obligations","Combinator","op","evaluableArray","children","request","_anyOf","_allOf","child","validate","every","dt","val","evaluate","some","v","toJson","anyOf","allOf","Comparator","param1","param2","v1","v2","_equalTo","_lessThan","dt1","param","object","comparator","Evaluable","result","errordetail","key","keys","default_value","initValue","combinator","action","subjectAttribute","_obj_constructor","resourceAttribute","environmentAttribute","n","subjectHasAttribute","resourceHasAttribute","actionType","ret","_getSubjectAttribute","_getResourceAttribute","_getEnvironmentAttribute","_subjectHasAttribute","_resourceHasAttribute","_actionType","string","throwError","isNaN","value_dt","message","getSubjectAttribute","getResourceAttribute","getEnvironmentAttribute","getActionType","attribute","getObject","Rule","parent","isTargetMet","isConditionMet","finalDecision","condition","effect","depth_level","depth","d","acc","conditionMet","setDecision","setObligations","desc","moveChildUp","moveChildDown","deleteChild","CombiningAlgorithm","setType","includes","responses","_denyOverrides","_permitOverrides","_firstApplicable","_permitUnlessDeny","_denyUnlessPermit","newResponse","Policy","isRoot","idCounter","isActive","algorithm","newRule","newPolicy","nAcc","i","_this$children$i$calc","calculateDepthLevel","_this$children$i$calc2","results","forEach","isApplicable","deactivate","combine","targetMet","algo","array","index","findIndex","newArray","slice","concat","splice","init","getType","CANVAS_TOP_SPACE","CANVAS_LEFT_SPACE","POLICY_COMPONENT_WIDTH","POLICY_COMPONENT_HEIGHT","POLICY_COMPONENT_COLOR","RULE_COMPONENT_WIDTH","RULE_COMPONENT_HEIGHT","RULE_COMPONENT_COLOR_INACTIVE","RULE_COMPONENT_COLOR_INAPPLICABLE","RULE_COMPONENT_COLOR_PERMIT","RULE_COMPONENT_COLOR_DENY","COMPONENT_BORDER_COLOR_UNSELECTED","COMPONENT_BORDER_COLOR_SELECTED","CHILD_COMPONENT_HORIZONTAL_INDENT","CHILD_COMPONENT_VERTICAL_SPACE","LINE_COLOR_INACTIVE","LINE_COLOR_ACTIVE","DRAGGABLE_EVALUABLES","options","comOp","DRAGGABLE_ACTIONS","ConnectingLine","parentX","parentY","childX","childY","parentActive","active","setActive","parentPosition","x","y","Constants","childPosition","color","ReactKonva","points","stroke","fill","pointerLength","pointerWidth","strokeWidth","zIndex","DecisionLine","PolicyEditorContext","React","createContext","selectedComponent","setSelectedComponent","setRequest","useRule","rule","context","useContext","ruleContainer","useRef","rulePojo","setRulePojo","depthLevel","setDepthLevel","current","setSelectedPojo","depthLevels","ruleObj","setName","setDescription","setEffect","reevaluateRequest","moveUp","moveUpInParent","recalculateDepthLevels","moveDown","moveDownInParent","destroy","deleteInParent","RuleComponent","ruleHook","setParentPosition","pos","setPos","setParentActive","isParentsDecision","setIsParentsDecision","controlsRef","labelRef","isSelected","isFinalDecision","show","hide","parentFinalDecision","handleControlHoverIn","document","body","style","cursor","handleControlHoverOut","connectingLine","policycomponents_ConnectingLine","decisionLine","policycomponents_DecisionLine","border_color","thisComponent","draggable","onDragMove","onDragEnd","width","height","text","fontSize","fontFamily","tag","visible","pointerDirection","pointerHeight","lineJoin","padding","ref","onMouseEnter","onMouseLeave","usePolicy","policyContainer","policyPojo","setPolicyPojo","setIsRoot","policyObj","setAlgorithm","newChildPolicy","newChildRule","PolicyComponent","policyHook","pol","thisGroupComponent","childrenComponents","policycomponents_RuleComponent","PolicyStage","layerRef","FontFaceObserver","load","draw","hooks_PolicyEditorContext","Consumer","Provider","policycomponents_PolicyComponent","ShadeHeader","isOpen","setIsOpen","title","editable","isEditing","onSave","class","onEdit","tmpIsOpen","onCollapse","removeable","onRemove","PolicyComponentEditor","selectedPojo","htmlFor","RuleComponentEditor","EvaluableErrorContext","useEvaluable","evaluable","errorContext","evaluableContainer","evaluablePojo","setEvaluablePojo","evaluableObj","setOp","initSubjectHasAttribute","initResourceHasAttribute","initSubjectAttribute","initResourceAttribute","initEnvironmentAttribute","initComparator","initCombinator","initActionType","setEmpty","resetToEmpty","combinatorAdd","combinatorAddChild","setAttribute","setValue","setDataType","setAction","EmptyComponent","evalHook","_useDrop","useDrop","accept","drop","item","monitor","didDrop","collect","isHovering","isOver","_useDrop2","evaluablecomponents_EvaluableComponent","CombinatorComponent","label","evalPojo","setIsEditing","editingIcons","window","alert","AttributeComponent","shallow","content","HasAttributeComponent","ValueComponent","onKeyDown","ComparatorComponent","ActionTypeComponent","EvaluableComponent","finalComponent","evaluablecomponents_EmptyComponent","evaluablecomponents_ValueComponent","evaluablecomponents_AttributeComponent","evaluablecomponents_CombinatorComponent","evaluablecomponents_ComparatorComponent","evaluablecomponents_HasAttributeComponent","evaluablecomponents_ActionTypeComponent","EvaluableShade","savedReq","shadeContent","hooks_EvaluableErrorContext","src_ShadeHeader","b","setDrawerOpen","DraggableComponent","_useDrag","useDrag","drag","DrawerEvaluables","evaluables","DraggableEvaluable","DrawerActions","actions","DrawerAttributes","userDefaultAttributes","editorData","deviceDefaultAttributes","groupCustomAttributes","environmentDefaultAttributes","prettyname","EvaluableEditorDrawer","selectedTab","setSelectedTab","src_DrawerEvaluables","src_DrawerAttributes","src_DrawerActions","href","SelectedComponentShade","drawerOpen","evaluableShades","propNames","getOwnPropertyNames","src_PolicyComponentEditor","src_EvaluableShade","src_RuleComponentEditor","esm","backend","HTML5Backend","src_EvaluableEditorDrawer","GroupUsersShade","selectedUser","setSelectedUser","selectUser","users","GroupDevicesShade","selectedDevice","setSelectedDevice","selectDevice","device","EnvironmentShade","date","setDate","time","setTime","RequestBuilder","selectedActionType","setSelectedActionType","envAttributes","dateAttribute","timeAttribute","timeValue","setTimeValue","_useState9","_useState10","dateValue","setDateValue","attributes","disabled","selected","src_GroupUsersShade","src_GroupDevicesShade","src_EnvironmentShade","ControlPanel","src_SelectedComponentShade","src_RequestBuilder","PolicyEditor","rootPolicy","setRootPolicy","loadedRequest","setLoadedRequest","setDepthLevels","_useState11","_useState12","setFinalDecision","_useState13","_useState14","setEditorData","url","selectedPolicy","groupid","_policy$calculateDept","_policy$calculateDept2","depths","_rootPolicy$calculate","_rootPolicy$calculate2","src_PolicyStage","src_ControlPanel","LoadingOverlay_default","spinner","react_spinners","App","pageContent","loggedInUser","src_PolicyEditor","src_PolicyList","src_NavigationBar","src_LoginScreen","Boolean","location","hostname","match","ReactDOM","render","src_App","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.bf0a04de.chunk.js","sourcesContent":["import React, { useState } from 'react'\nimport axios from 'axios'\n\nimport './styles/LoginScreen.css';\n\nfunction LoginScreenComponent(props) {\n    const [username, setUsername] = useState(\"\")\n    const [remote, setRemote] = useState(\"http://localhost:3002\")\n    const [failed, setFailed] = useState(false)\n    const [error, setError] = useState(\"\")\n\n    function submit() {\n        axios.post(remote+\"/users/login\", {username: username})\n        .then(response => {\n            if (response.data.status == \"success\") {\n                localStorage.setItem('remoteUrl', remote)\n                localStorage.setItem('user', JSON.stringify(response.data.user))\n                props.setLoggedInUser(response.data.user)\n            } else {\n                setError(\"Connection to remote established, but login details incorrect!\")\n                setFailed(true)\n            }\n        })\n        .catch(err => {\n            console.log(err)\n            setError(\"Could not connect to remote!\")\n            setFailed(true)\n        })\n    }\n\n    let failedAlert\n    if (failed) {\n        failedAlert = (\n            <div className=\"alert alert-danger\" role=\"alert\">{error}</div>\n        )\n    }\n\n    return (\n        <div className=\"container-fluid\">\n            <div className=\"row align-items-center vertical-center\">\n                <div className=\"col-sm-3\"></div>\n                <div className=\"col-sm-6\">\n                    <div className=\"jumbotron\">\n                        {failedAlert}\n                        <div className=\"form-group\">\n                            <label>Username</label>\n                            <input className=\"form-control\" placeholder=\"Enter your username\" value={username} onChange={e=>setUsername(e.target.value)}></input>\n                        </div>\n                        <div className=\"form-group\">\n                            <label>Remote URL</label>\n                            <input className=\"form-control\" placeholder=\"Enter the hostname of remote server\" value={remote} onChange={e=>setRemote(e.target.value)}></input>\n                        </div>\n                        <button type=\"submit\" className=\"btn btn-primary btn-block\" onClick={submit}>Sign In</button>\n                    </div>\n                </div>\n                <div className=\"col-sm-3\"></div>\n            </div>\n        </div>\n    );\n}\n\nexport default LoginScreenComponent","import React, { useState } from 'react'\n\nfunction NavigationBar(props) {\n    let username = JSON.parse(localStorage.getItem('user')).name\n    function logout() {\n        localStorage.removeItem('user')\n        props.setLoggedInUser(null)\n    }\n\n    return (\n        <div>\n            <div className=\"navbar\">\n                <div className=\"container\">\n                    <span className=\"navbar-brand\">IoT Policy Editor</span>\n                    <button className=\"btn btn-outline-danger\" onClick={logout}>Sign Out</button>\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default NavigationBar","import axios from 'axios'\nimport React, { useState, useEffect } from 'react'\nimport './styles/PolicyList.css'\n\nfunction PolicyList(props) {\n    const [groupPolicies, setGroupPolicies] = useState([])\n    const [devicePolicies, setDevicePolicies] = useState([])\n\n    useEffect(() => {\n        axios.get(localStorage.getItem('remoteUrl')+\"/users/policies\", {headers:{'Authorization':props.user.id}})\n        .then(response => {\n            setGroupPolicies(response.data.groups)\n            setDevicePolicies(response.data.devices)\n        })\n        .catch(err => console.log(err))\n    }, [])\n\n    let groupSection = null\n    if (groupPolicies.length > 0) {\n        groupSection = (\n            <>\n                <thead>\n                    <tr>\n                        <th scope='col'>Groups</th>\n                        <th scope='col'>Filename</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {groupPolicies.map(policy => \n                    <tr onClick={() => props.setSelectedPolicy({type:'group', data: policy})}>\n                        <td scope='row'>{policy.name}</td>\n                        <td>group_{policy.id}.json</td>\n                    </tr>\n                    )}\n                </tbody>\n            </>\n        )\n    }\n\n    let deviceSection = null\n    if (devicePolicies.length > 0) {\n        deviceSection = (\n            <>\n                <thead>\n                    <tr>\n                        <th scope='col'>Devices</th>\n                        <th scope='col'></th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {devicePolicies.map(policy => \n                        <tr onClick={() => props.setSelectedPolicy({type:'device', data: policy})}>\n                            <td scope='row'>{policy.name}</td>\n                            <td>device_{policy.id}.json</td>\n                        </tr>\n                    )}\n                </tbody>\n            </>\n        )\n    }\n\n    return (\n        <div className=\"container\">\n            <div className=\"row\">\n                <table className=\"table table-hover\" id=\"policyListTable\">\n                    {groupSection}\n                    {deviceSection}\n                </table>\n            </div>\n        </div>\n    )\n}\n\nexport default PolicyList","class Attribute {\n    _obj_constructor(rawObj) {\n        if(!(\"attribute_id\" in rawObj)) throw new Error(\"No attribute_id in attribute.\");\n        if(!(\"data_type\" in rawObj)) throw new Error(\"No data_type in attribute.\");\n        if(!(\"value\" in rawObj)) throw new Error(\"No value in attribute.\");\n        this.attribute_id = rawObj.attribute_id;\n        this.data_type = rawObj.data_type;\n        this.value = rawObj.value;\n    }\n    \n    constructor(id, data_type, value) {\n        this.attribute_id = id;\n        this.data_type = data_type;\n        this.value = value;\n    }\n}\n\nexport default Attribute","// An example request can be seen in the examples directory, made up of info about Subject, Resource, Action and Environment\nimport Attribute from './Attribute'\n\nclass Request {\n\n    constructor() {\n        // Create an empty request\n        this.Subject = {Attributes:[]};\n        this.Resource = {Attributes:[]};\n        this.Action = {Type: \"unknown\", Attributes:[]};\n        this.Environment = {Attributes:[]};\n    }\n\n    _obj_constructor(obj) {\n        if(!(\"Subject\" in obj)) throw new Error(\"No Subject in request.\");\n        if(!(\"Resource\" in obj)) throw new Error(\"No Resource in request.\");\n        if(!(\"Environment\" in obj)) throw new Error(\"No Environment in request.\");\n        if(!(\"Action\" in obj)) throw new Error(\"No Action in request.\");\n        if(!(\"Attributes\" in obj.Subject)) throw new Error(\"No Attributes in request Subject.\");\n        if(!(\"Attributes\" in obj.Resource)) throw new Error(\"No Attributes in request Resource.\");\n        if(!(\"Attributes\" in obj.Environment)) throw new Error(\"No Attributes in request Environment.\");\n        if(!(\"Attributes\" in obj.Action)) throw new Error(\"No Attributes in request Action.\");\n        if(!(\"Type\" in obj.Action)) throw new Error(\"No Type in request Action.\");\n        this.Subject.Attributes = obj.Subject.Attributes.map((attr)=>{return Object.assign(new Attribute, attr)});\n        this.Resource.Attributes = obj.Resource.Attributes.map((attr)=>{return Object.assign(new Attribute, attr)});\n        this.Action.Type = obj.Action.Type;\n        this.Action.Attributes = obj.Action.Attributes.map((attr)=>{return Object.assign(new Attribute, attr)});\n        this.Environment.Attributes = obj.Environment.Attributes.map((attr)=>{return Object.assign(new Attribute, attr)});\n    }\n\n    getSubjectAttribute(name) {\n        // Get an attribute from this request by its ID (which is a unique descriptive string), if not found return undefined\n        let res = this.Subject.Attributes.find(attr => attr.attribute_id == name);\n        if (res != undefined) return res;\n        throw new Error(\"Could not get attribute \" + name + \" from the subject in this request\");\n    }\n\n    getResourceAttribute(name) {\n        let res = this.Resource.Attributes.find(attr => attr.attribute_id == name);\n        if (res != undefined) return res;\n        throw new Error(\"Could not get attribute \" + name + \" from the resource in this request\");\n    }\n\n    getActionType() {\n        return this.Action.Type\n    }\n\n    getEnvironmentAttribute(name) {\n        let res = this.Environment.Attributes.find(attr=> attr.attribute_id == name)\n        if (res != undefined) return res\n        throw new Error(\"Could not get attribute \" + name + \" from the environment in this request\")\n    }\n\n    getActionAttribute(name) {\n        return this.Action.Attributes.find(attr=> attr.attribute_id == name);\n    }\n\n    _addSubjectAttribute(attr) {\n        this.Subject.Attributes.push(attr);\n    }\n\n    _addResourceAttribute(attr) {\n        this.Resource.Attributes.push(attr);\n    }\n\n    _addActionAttribute(attr) {\n        this.Action.Attributes.push(attr);\n    }\n\n    _addEnvironmentAttribute(attr) {\n        this.Environment.Attributes.push(attr);\n    }\n\n    setActionType(type) {\n        this.Action.Type = type;\n    }\n\n    populateUserDefaultAttributes(db, userid) {\n        return new Promise((resolve, reject) => {\n            db.get(\"SELECT * FROM User WHERE id=?\", userid, { Promise })\n                .then(row => {\n                    this._addSubjectAttribute(new Attribute(\"user_id\", \"integer\", row.id));\n                    this._addSubjectAttribute(new Attribute(\"user_name\", \"string\", row.name));\n                    resolve();\n                })\n                .catch(err => reject(\"Could not get default user attributes from database.\"));\n        });\n    }\n\n    populateUserCustomAttributes(db, userid) {\n        return new Promise((resolve, reject) => {\n            db.all(`\n                SELECT ADef.name, ADef.datatype, AVal.value\n                FROM AttributeValue AS AVal\n                JOIN AttributeDef AS ADef\n                ON AVal.attrid = ADef.id\n                WHERE AVal.userid = ?\n            `, userid, { Promise })\n            .then(rows => {\n                rows.map(attr => this._addSubjectAttribute(new Attribute(attr.name, attr.datatype, attr.value)));\n                resolve();\n            })\n            .catch(err => {reject(\"Could not get user custom attributes from database!\")})\n        });\n    }\n\n    populateDeviceDefaultAttributes(db, deviceid) {\n        return new Promise((resolve, reject) => {\n            db.get(\"SELECT * FROM Device WHERE id=?\", deviceid, { Promise })\n                .then(row => {\n                    if (row == undefined) reject(\"No such device to get attributes for!\");\n                    this._addResourceAttribute(new Attribute(\"device_id\", \"integer\", row.id));\n                    this._addResourceAttribute(new Attribute(\"device_owner_id\", \"integer\", row.ownerid));\n                    resolve();\n                })\n                .catch(err => {\n                    reject(\"Could not get default device attributes from database.\")\n                });\n        });\n    }\n\n    populateDeviceCustomAttributes(db, deviceid) {\n        return new Promise((resolve, reject) => {\n            db.all(`\n                SELECT ADef.name, ADef.datatype, AVal.value\n                FROM AttributeValue AS AVal\n                JOIN AttributeDef AS ADef\n                ON AVal.attrid = ADef.id\n                WHERE AVal.deviceid = ?\n            `, deviceid, { Promise })\n            .then(rows=> {\n                rows.map(attr=> this._addResourceAttribute(new Attribute(attr.name, attr.datatype, attr.value)));\n                resolve();\n            })\n            .catch(err => reject(\"Could not get device custom attributes from database!\"))\n        });\n    }\n\n    populateAttributes(db, userid, deviceid) {\n        return Promise.all([\n            this.populateUserDefaultAttributes(db, userid),\n            this.populateUserCustomAttributes(db, userid),\n            this.populateDeviceDefaultAttributes(db, deviceid),\n            this.populateDeviceCustomAttributes(db, deviceid)\n        ]);\n    }\n\n}\n\nexport default Request","class Response {\n    // TODO: Will be more useful if a response has more info about where it has come from etc will be easier for users to understand..\n\n    constructor(id, description) {\n        this.id = id\n        this.description = description\n        this.Decision = \"NotApplicable\";\n        this.Obligations = [];\n    }\n\n    setDecision(decision) {\n        this.Decision = decision;\n    }\n\n    addObligation(obligation) {\n        this.Obligations.push(obligation);\n    }\n\n    setObligations(obligations) {\n        this.Obligations = obligations;\n    }\n}\n\nexport default Response","class Combinator {\n    constructor(op, evaluableArray) {\n        this.op = op;\n        this.children = evaluableArray;\n    }\n\n    evaluate(request) {\n        switch(this.op) {\n            case 'anyOf':\n                return this._anyOf(request);\n            case 'allOf':\n                return this._allOf(request);\n            default:\n                throw new Error('Cannot evaluate invalid combinator.');\n        }\n    }\n\n    validate() {\n        try {\n            let data_types = this.children.map(child => {return child.validate()})\n            if (data_types.every(dt => dt == 'boolean')) {\n                return 'boolean'\n            } else {\n                throw new Error(\"Combinators must all be booleans\")\n            }\n        } catch(err) {\n            throw err\n        }\n    }\n\n    _anyOf(request) {\n        let resArray = this.children.map(val => {return val.evaluate(request)});\n        return resArray.some(v => v == true);\n    }\n\n    _allOf(request) {\n        let resArray = this.children.map(val => {return val.evaluate(request)});\n        return resArray.every(v => v == true);\n    }\n\n    getObject() {\n        let object = {\n            op: this.op,\n            children: this.children\n        }\n        return object\n    }\n\n    toJson() {\n        let children = this.children.map((child) => child.toJson())\n        switch(this.op) {\n            case 'anyOf':\n                return {anyOf: children}\n            case 'allOf':\n                return {allOf: children}\n            default:\n                throw new Error(\"cannot toJson invalid combinator\")\n        }\n    }\n}\n\nexport default Combinator\n","// const Evaluable = require('./Evaluable');\n\nclass Comparator {\n    constructor(op, param1, param2) {\n        this.op = op\n        this.param1 = param1\n        this.param2 = param2\n    }\n\n    // constructor(obj, evaluator) {\n    //     this.evaluator = evaluator;\n    //     if (!('comparator' in obj)) throw new Error(\"Invalid comparator.\");\n    //     this.op = obj.comparator;\n    //     switch (this.op) {\n    //         case 'equalTo':\n    //             if(!('param1' in obj)) throw new Error(\"Missing param1 in comparator\");\n    //             if(!('param2' in obj)) throw new Error(\"Missing param2 in comparator\");\n    //             // this.param1 = new Evaluable(obj.param1);\n    //             // this.param2 = new Evaluable(obj.param2);\n    //             this.param1 = evaluator._DI(obj.param1);\n    //             this.param2 = evaluator._DI(obj.param2);\n    //             break;\n    //         default:\n    //             throw new Error('Invalid comparator operation.');\n    //             break;\n    //     }\n    // }\n\n    evaluate(request) {\n        switch(this.op) {\n            case 'equalTo':\n                var v1 = this.param1.evaluate(request);\n                var v2 = this.param2.evaluate(request);\n                console.log(\"EQUALTO: \" + v1 + \", \" + v2);\n                return this._equalTo(v1,v2);\n            case 'lessThan':\n                var v1 = this.param1.evaluate(request);\n                var v2 = this.param2.evaluate(request);\n                console.log(\"LESSTHAN: \" + v1 + \", \" + v2)\n                return this._lessThan(v1, v2)\n            default:\n                throw new Error('Cannot evaluate invalid comparator.');\n        }\n    }\n\n    validate() {\n        try {\n            let dt1 = this.param1.validate()\n            let dt2 = this.param2.validate()\n            if (dt1 != dt2) {\n                throw new Error(\"Comparator cannot compare different data types!\")\n            }\n            if (this.op == 'lessThan') {\n                if (dt1 != 'integer') throw new Error(\"Less than only works on integer values\")\n            }\n            return 'boolean'\n        } catch(err) {\n            throw err\n        }\n    }\n\n    _equalTo(param, value) {\n        return param == value;\n    }\n\n    _lessThan(param, value) {\n        return param < value\n    }\n\n    getObject() {\n        let object = {\n            op: this.op\n        }\n        switch(this.op) {\n            case 'lessThan':\n            case 'equalTo':\n                object.param1 = this.param1\n                object.param2 = this.param2\n                break\n            default:\n                throw new Error(\"Could not getObject on invalid Comparator\")\n        }\n        return object\n    }\n\n    toJson() {\n        switch(this.op) {\n            case 'equalTo':\n                let param1 = this.param1.toJson()\n                let param2 = this.param2.toJson()\n                return {comparator: 'equalTo', param1: param1, param2: param2}\n            default:\n                throw new Error(\"Cannot toJson invalid comparator\")\n        }\n    }\n}\n\nexport default Comparator","import Combinator from './Combinator'\nimport Comparator from './Comparator'\n\nclass Evaluable {\n\n    // Construct an empty evaluable object\n    constructor() {\n        this.op = 'empty'\n        this.result = null\n        this.error = false\n        this.errordetail = ''\n    }\n\n    resetToEmpty() {\n        for(let key in Object.keys(this)) {\n            delete this[key]\n        }\n        this.op ='empty'\n        this.result = null\n        this.error = false\n        this.errordetail = ''\n    }\n\n    // functions to init each type of evaluable object\n    initSubjectHasAttribute() {\n        this.op = \"subjectHasAttribute\"\n        this.attr = null\n    }\n\n    initResourceHasAttribute() {\n        this.op = \"resourceHasAttribute\"\n        this.attr = null\n    }\n\n    initSubjectAttribute() {\n        this.op = \"subjectAttribute\"\n        this.attr = null\n        this.default_value = new Evaluable()\n        this.default_value.initValue()\n    }\n\n    initResourceAttribute() {\n        this.op = \"resourceAttribute\"\n        this.attr = null\n        this.default_value = new Evaluable()\n        this.default_value.initValue()\n    }\n\n    initEnvironmentAttribute() {\n        this.op = \"environmentAttribute\"\n        this.attr = null\n        this.default_value = new Evaluable()\n        this.default_value.initValue()\n    }\n\n    initCombinator(op) {\n        this.op = \"combinator\"\n        this.combinator = new Combinator(op, [new Evaluable()])\n    }\n\n    initComparator(op) {\n        this.op = \"comparator\"\n        this.comparator = new Comparator(op, new Evaluable(), new Evaluable())\n    }\n\n    initValue() {\n        this.op =\"value\"\n        this.value = null\n        this.data_type = 'string'\n    }\n\n    initActionType() {\n        this.op = \"actionType\"\n        this.action = null\n    }\n\n    // Fill in the details using an existing object (eg from json)\n    _obj_constructor(obj) {\n        console.log(obj)\n        if (Object.keys(obj).length == 0) {\n            this.op = 'empty'\n            return\n        }\n\n        // This is a value literal because it contains the key 'value'\n        if ('value' in obj) {\n            this.op = 'value';\n            this.value = obj.value;\n            this.data_type = obj.data_type;\n            return;\n        }\n\n        // This is a subject attribute lookup because it contains the key 'subjectAttribute'\n        if ('subjectAttribute' in obj) {\n            this.op = 'subjectAttribute';\n            this.attr = obj.subjectAttribute;\n            this.default_value = new Evaluable()\n            this.default_value._obj_constructor(obj.default_value)\n            return;\n        }\n\n        // This is a resource attribute lookup because it contains the key 'resourceAttribute'\n        if ('resourceAttribute' in obj) {\n            this.op = 'resourceAttribute';\n            this.attr = obj.resourceAttribute;\n            this.default_value = new Evaluable()\n            this.default_value._obj_constructor(obj.default_value)\n            return;\n        }\n\n        if ('environmentAttribute' in obj) {\n            this.op = 'environmentAttribute'\n            this.attr = obj.environmentAttribute\n            this.default_value = new Evaluable()\n            this.default_value._obj_constructor(obj.default_value)\n            return\n        }\n\n        // This is a comparator because it contains the key 'comparator'\n        if ('comparator' in obj) {\n            this.op = 'comparator';\n            let param1 = new Evaluable()\n            param1._obj_constructor(obj.param1)\n            let param2 = new Evaluable()\n            param2._obj_constructor(obj.param2)\n            this.comparator = new Comparator(obj.comparator, param1, param2);\n            return;\n        }\n\n        // This is an allOf combinator because it contains the key 'allOf'\n        if ('allOf' in obj) {\n            this.op = 'combinator';\n            this.combinator = new Combinator('allOf', obj.allOf.map(n => {\n                let child = new Evaluable()\n                child._obj_constructor(n)\n                return child\n            }));\n            return;\n        }\n        if ('anyOf' in obj) {\n            this.op = 'combinator';\n            this.combinator = new Combinator('anyOf', obj.anyOf.map(n => {\n                let child = new Evaluable()\n                child._obj_constructor(n)\n                return child\n            }));\n            return;\n        }\n\n        // This is an attribute presence check on the subject because it contains the key 'subjectHasAttribute'\n        if ('subjectHasAttribute' in obj) {\n            this.op = 'subjectHasAttribute';\n            this.attr = obj.subjectHasAttribute;\n            return;\n        }\n        // This is an attribute check on the resource because it contains the key 'resourceHasAttribute'\n        if ('resourceHasAttribute' in obj) {\n            this.op = 'resourceHasAttribute';\n            this.attr = obj.resourceHasAttribute;\n            return;\n        }\n\n        if ('actionType' in obj) {\n            this.op=\"actionType\"\n            this.action = obj.actionType\n            return;\n        }\n    }\n\n    setAction(type) {\n        this.action = type\n    }\n\n    evaluate(request) {\n        let ret\n        switch(this.op) {\n            case 'empty':\n                ret = true\n                break\n            case 'value':\n                ret = this.value;\n                break\n            case 'subjectAttribute':\n                ret = this._getSubjectAttribute(request);\n                break\n            case 'resourceAttribute':\n                ret = this._getResourceAttribute(request);\n                break\n            case 'environmentAttribute':\n                ret = this._getEnvironmentAttribute(request)\n                break\n            case 'combinator':\n                ret = this.combinator.evaluate(request);\n                break\n            case 'comparator':\n                ret = this.comparator.evaluate(request);\n                break\n            case 'subjectHasAttribute':\n                ret = this._subjectHasAttribute(request);\n                break\n            case 'resourceHasAttribute':\n                ret = this._resourceHasAttribute(request);\n                break\n            case 'actionType':\n                ret = this._actionType(request);\n                break\n            default:\n                throw new Error(\"Could not evaluate invalid evaluable.\");\n        }\n        this.result = ret\n        return this.result\n    }\n\n    throwError(string) {\n        this.error = true\n        this.errordetail = string\n        throw new Error(string)\n    }\n\n    validate() {\n        this.error = false\n        this.errordetail = null\n        let data_type\n        switch(this.op) {\n            case 'empty':\n                data_type = 'boolean'\n                break\n            case 'value':\n                if (this.value == null) this.throwError('value undefined')\n                if (this.data_type == null) this.throwError(\"No data type specified for value\")\n                switch(this.data_type) {\n                    case 'boolean':\n                        if (this.value != 'true' && this.value != 'false') this.throwError(\"Invalid value for boolean\")\n                        break\n                    case 'string':\n                        // Values are stored as strings anyway\n                        break\n                    case 'integer':\n                        if (isNaN(this.value)) this.throwError(\"Invalid value for integer\")\n                        break\n                    default:\n                        this.throwError(\"invalid datatype for value\")\n                }\n                data_type = this.data_type\n                break\n            case 'subjectAttribute':\n                if (this.attr == null) this.throwError(\"missing attribute in subject attribute lookup\")\n                if (this.default_value == null) this.throwError('must provide a default attribute for subject attribute lookup')\n                try {\n                    let value_dt = this.default_value.validate()\n                    if (this.attr.data_type != value_dt) this.throwError(\"Default value datatype for subject attribute lookup must match the attributes datatype\")\n                    data_type = this.attr.data_type\n                    break\n                } catch(err) {\n                    throw Error(err)\n                }\n                break\n            case 'resourceAttribute':\n                if (this.attr == null) this.throwError(\"missing attribute in resource attribute lookup\")\n                if (this.default_value == null) this.throwError('must provide a default attribute for resource attribute lookup')\n                try {\n                    let value_dt = this.default_value.validate()\n                    if (this.attr.data_type != value_dt) this.throwError(\"Default value datatype for resource attribute lookup must match the attributes datatype\")\n                    data_type = this.attr.data_type\n                    break\n                } catch(err) {\n                    this.throwError(\"Default value for resource attribute lookup is invalid\")\n                }\n                break\n            case 'environmentAttribute':\n                    if (this.attr == null) this.throwError(\"missing attribute in resource attribute lookup\")\n                    if (this.default_value == null) this.throwError('must provide a default attribute for environment attribute lookup')\n                    try {\n                        let value_dt = this.default_value.validate()\n                        if (this.attr.data_type != value_dt) this.throwError(\"Default value datatype for environment attribute lookup must match the attributes datatype\")\n                        data_type = this.attr.data_type\n                        break\n                    } catch(err) {\n                        throw err\n                    }\n                    break\n            case 'subjectHasAttribute':\n                if (this.attr == null) this.throwError('missing attribute')\n                data_type = 'boolean'\n                break\n            case 'resourceHasAttribute':\n                if (this.attr == null) this.throwError('missing attribute')\n                data_type = 'boolean'\n                break\n            case 'comparator':\n                try {\n                    data_type = this.comparator.validate()\n                    break\n                } catch(err) {\n                    this.throwError(err.message)\n                }\n            case 'combinator':\n                try {\n                    data_type = this.combinator.validate()\n                    break\n                } catch(err) {\n                    this.throwError(err.message)\n                }\n            case 'actionType':\n                if (this.action == null) this.throwError(\"Action type cannot be null\")\n                data_type = 'boolean'\n                break\n            default:\n                throw new Error('could not validate invalid evaluable')    \n        }\n        return data_type\n    }\n\n    combinatorAddChild() {\n        this.combinator.children.push(new Evaluable())\n    }\n\n    setValue(val) {\n        this.value = val\n    }\n\n    _getSubjectAttribute(request) {\n        try {\n            return request.getSubjectAttribute(this.attr.attribute_id).value;\n        } catch(err) {\n            return this.default_value.evaluate()\n        }\n    }\n\n    _getResourceAttribute(request) {\n        try {\n            return request.getResourceAttribute(this.attr.attribute_id).value;\n        } catch(err) {\n            return this.default_value.evaluate()\n        }\n    }\n\n    _getEnvironmentAttribute(request) {\n        try {\n            return request.getEnvironmentAttribute(this.attr.attribute_id).value\n        } catch(err) {\n            return this.default_value.evaluate()\n        }\n    }\n\n    _subjectHasAttribute(request) {\n        try {\n            let attr = request.getSubjectAttribute(this.attr.attribute_id)\n            if (attr == undefined) {\n                return false\n            }\n            return true\n        } catch (err) {\n            return false\n        }\n    }\n\n    _resourceHasAttribute(request) {\n        try {\n            let attr = request.getResourceAttribute(this.attr.attribute_id)\n            if (attr == undefined) {\n                return false\n            }\n            return true\n        } catch(err) {\n            return false\n        }\n    }\n\n    _actionType(request) {\n        return this.action == request.getActionType()\n    }\n\n    // Returns a plain old javascript object for use by react\n    getObject() {\n        let object = {\n            op: this.op,\n            result: this.result,\n            error: this.error,\n            errordetail: this.errordetail\n        }\n        switch (this.op) {\n            case 'empty':\n                break\n            case 'value':\n                object.value = this.value\n                object.data_type = this.data_type\n                break\n            case 'subjectAttribute':\n                object.attribute = this.attr\n                object.default_value = this.default_value\n                break\n            case 'resourceAttribute':\n                object.attribute = this.attr\n                object.default_value = this.default_value\n                break\n            case 'environmentAttribute':\n                object.attribute = this.attr\n                object.default_value = this.default_value\n                break\n            case 'combinator':\n                object.combinator = this.combinator.getObject()\n                break\n            case 'comparator':\n                object.comparator = this.comparator.getObject()\n                break\n            case 'subjectHasAttribute':\n                object.attribute = this.attr\n                break\n            case 'resourceHasAttribute':\n                object.attribute = this.attr\n                break\n            case 'actionType':\n                object.action = this.action\n                break\n            default:\n                throw new Error(\"Could not getObject of invalid evaluable\")\n        }\n        return object\n    }\n\n    toJson() {\n        switch(this.op) {\n            case 'empty':\n                return {}\n            case 'value':\n                return {value: this.value, data_type: this.data_type}\n            case 'subjectAttribute':\n                return {subjectAttribute: this.attr, default_value: this.default_value.toJson()}\n            case 'resourceAttribute':\n                return {resourceAttribute: this.attr, default_value: this.default_value.toJson()}\n            case 'environmentAttribute':\n                return {environmentAttribute: this.attr,\n                default_value: this.default_value.toJson()}\n            case 'combinator':\n                return this.combinator.toJson()\n            case 'comparator':\n                return this.comparator.toJson()\n            case 'subjectHasAttribute':\n                return {subjectHasAttribute: this.attr}\n            case 'resourceHasAttribute':\n                return {resourceHasAttribute: this.attr}\n            case 'actionType':\n                return {actionType: this.action}\n            default:\n                throw new Error(\"Could not toJson invalid evaluable.\");\n        }\n    }\n}\n\nexport default Evaluable\n\n","// const Target = require('./Target');\n// const Condition = require('./Condition');\nimport Response from './Response'\nimport Evaluable from './Evaluable'\n\nclass Rule {\n    constructor(parent) {\n        if (parent == null) {\n            throw new Error(\"Rule has no parent - but cannot be the root of the policy\")\n        }\n        this.parent = parent\n        this.isTargetMet = false\n        this.isConditionMet = false\n        this.finalDecision = undefined\n    }\n\n    init(id) {\n        this.id = id\n        this.name = \"No Name\"\n        this.description = \"No Description\"\n        this.target = new Evaluable()\n        this.condition = new Evaluable()\n        this.obligations = []\n        this.effect = \"Deny\"\n        this.depth_level = null\n    }\n\n    _obj_constructor(rawObj) {\n\n        if(!(\"id\" in rawObj)) throw new Error(\"id not defined in rule object.\");\n        if(!(\"target\" in rawObj)) throw new Error(\"target not defined in rule object.\");\n        if(!(\"obligations\" in rawObj)) throw new Error(\"obligations not defined in rule object.\");\n        if(!(\"condition\" in rawObj)) throw new Error(\"condition not defined in rule object.\");\n        if(!(\"effect\" in rawObj)) throw new Error(\"effect not defined in rule object.\");\n        if (\"name\" in rawObj) {\n            this.name = rawObj.name\n        } else {\n            this.name = \"No Name\"\n        }\n        \n        if((\"description\" in rawObj)) {\n            this.description = rawObj.description\n        } else {\n            this.description = \"No Description\"\n        }\n\n        this.id = rawObj.id;\n        this.target = new Evaluable();\n        this.target._obj_constructor(rawObj.target)\n        this.condition = new Evaluable();\n        this.condition._obj_constructor(rawObj.condition)\n        this.effect = rawObj.effect;\n        this.obligations = rawObj.obligations;\n\n        this.depth = 0\n        this.depth_level = null;\n\n        return this.id\n    }\n\n    calculateDepthLevel(d, acc) {\n        this.depth_level = d\n        console.log(\"Rule \" + this.id + \" depth_level: \" + this.depth_level)\n        acc[this.id] = this.depth_level\n        return [d, acc]\n    }\n\n    isApplicable(request) {\n        // Evaluate the target of this rule to decide if it is applicable to this request\n        this.isTargetMet = this.target.evaluate(request)\n        return this.isTargetMet\n    }\n\n    conditionMet(request) {\n        this.isConditionMet = this.condition.evaluate(request)\n        return this.isConditionMet\n    }\n\n    evaluate(request) {\n        // Evaluate the condition of this rule to determine what decision should be made (CAUTION does not test target, just condition)\n        let response = new Response(this.id, this.description);\n        if (this.conditionMet(request)) {\n            response.setDecision(this.effect);\n            response.setObligations(this.obligations);\n        }\n        this.finalDecision = response\n        return this.finalDecision\n    }\n\n    setName(name) {\n        this.name = name\n    }\n\n    setDescription(desc) { \n        this.description = desc\n    }\n\n    setEffect(effect) {\n        this.effect = effect\n    }\n\n    deactivate() {\n        // Inform this rule it is no longer active in the viewer\n        this.isTargetMet = false\n        this.isConditionMet = false\n        this.finalDecision = undefined\n    }\n\n    moveUpInParent() {\n        this.parent.moveChildUp(this.id)\n    }\n\n    moveDownInParent() {\n        this.parent.moveChildDown(this.id)\n    }\n\n    deleteInParent() {\n        this.parent.deleteChild(this.id)\n    }\n\n    getObject() {\n        return {\n            id: this.id,\n            name: this.name,\n            description: this.description,\n            obligations: this.obligations,\n            target: this.target,\n            condition: this.condition,\n            effect: this.effect,\n            depth_level: this.depth_level,\n            isTargetMet: this.isTargetMet,\n            isConditionMet: this.isConditionMet,\n            finalDecision: this.finalDecision\n        }\n    }\n\n    toJson() {\n        let target = this.target.toJson()\n        let condition = this.condition.toJson()\n        return {\n            id: this.id,\n            name: this.name,\n            description: this.description,\n            obligations: this.obligations,\n            target: target,\n            condition: condition,\n            effect: this.effect\n        }\n    }\n}\n\nexport default Rule","import Response from './Response'\n\nclass CombiningAlgorithm {\n    constructor(id, description, type) {\n        this.id = id\n        this.description = description\n        this.setType(type)\n    }\n\n    getType() {\n        return this.type\n    }\n\n    setType(type) {\n        if (!(['denyOverrides', 'permitOverrides', 'firstApplicable', 'permitUnlessDeny', 'denyUnlessPermit']).includes(type)) {\n            throw new Error(\"Invalid combining algorithm type!\");\n        }\n        this.type = type; \n    }\n\n    combine(responses) {\n        switch(this.type) {\n            case \"denyOverrides\":\n                return this._denyOverrides(responses);\n            case \"permitOverrides\":\n                return this._permitOverrides(responses);\n            case \"firstApplicable\":\n                return this._firstApplicable(responses);\n            case \"permitUnlessDeny\":\n                return this._permitUnlessDeny(responses);\n            case \"denyUnlessPermit\":\n                return this._denyUnlessPermit(responses);\n            default:\n                throw new Error(\"Could not evaluate invalid algorithm type!\");\n        }\n    }\n\n    // Deny overrides, so [Permit, Permit, Permit, Deny] is Deny.. but can still be NotApplicable eg if [NA, NA]\n    _denyOverrides(responses) {\n        // let response = new Response();\n        // if ((responses.filter(r=> r.Decision == \"Deny\")).length > 0) {\n        //     response.setDecision(\"Deny\");\n        // } else if ((responses.filter(r=> r.Decision == \"Permit\")).length > 0) {\n        //     response.setDecision(\"Permit\");\n        // }\n        let response = responses.find(res => res.Decision == \"Deny\")\n        if (response) {\n            return response;\n        } else {\n            // No deny so default to firstApplicable\n            return this._firstApplicable(responses)\n        }\n    }\n\n    _permitOverrides(responses) {\n        // TODO: Collect obligations from all responses?\n        // let response = new Response();\n        // if ((responses.filter(r=> r.Decision == \"Permit\")).length > 0) {\n        //     response.setDecision(\"Permit\");\n        // } else if ((responses.filter(r=> r.Decision == \"Deny\")).length > 0) {\n        //     response.setDecision(\"Deny\");\n        // }\n        // return response;\n        let response = responses.find(res => res.Decision == \"Permit\")\n        if (response) {\n            return response\n        } else {\n            return this._firstApplicable(responses)\n        }\n    }\n\n    _firstApplicable(responses) {\n        // for(let i=0; i<responses.length; i++) {\n        //     let r = responses[i];\n        //     if (r.Decision == \"Permit\" || r.Decision == \"Deny\") {\n        //         return r;\n        //     }\n        // }\n\n        let response = responses.find(res => res.Decision == \"Permit\" || res.Decision == \"Deny\")\n        if (response) {\n            return response\n        } else {\n            // No valid response found so return a new NotApplicable response from this id in the policytree\n            let newResponse = new Response(this.id, this.description)\n            return newResponse\n        }\n    }\n\n    _permitUnlessDeny(responses) {\n        let response = responses.find(res => res.Decision == \"Deny\")\n        if (response) {\n            return response\n        } else {\n            let newResponse = new Response(this.id, this.description)\n            newResponse.setDecision(\"Permit\")\n            return newResponse\n        }\n    }\n\n    _denyUnlessPermit(responses) {\n        // let response = new Response();\n        // if ((responses.filter(r=>r.Decision==\"Permit\")).length > 0) {\n        //     // Responses DOES contain a Permit\n        //     response.setDecision(\"Permit\");\n        // } else {\n        //     response.setDecision(\"Deny\");\n        // }\n        // return response;\n\n        let response = responses.find(res => res.Decision == \"Permit\")\n        if (response) {\n            return response\n        } else {\n            let newResponse = new Response(this.id, this.description)\n            newResponse.setDecision(\"Deny\")\n            return newResponse\n        }\n    }\n}\n\nexport default CombiningAlgorithm","/*\nClient side version -> \n    Policies can have either rules or policies as their children; hence removing the notion of 'policyset' as they make it unnecessarily complicated\n    Rather than automatically creating all their children in the constructor have\n*/\nimport Rule from './Rule'\nimport Evaluable from './Evaluable'\nimport CombiningAlgorithm from './CombiningAlgorithm'\n\nclass Policy {\n    constructor(parent) {\n        if (parent == null) {\n            this.isRoot = true\n        }\n        this.parent = parent\n        this.idCounter = 0\n        this.finalDecision = undefined\n        this.isActive = false\n        this.isTargetMet = false\n    }\n\n    // Initialise a new empty Policy with default values\n    init(id) {\n        this.id = id\n        this.name = \"No Name\"\n        this.description = \"No Description\"\n        this.target = new Evaluable()\n        this.obligations = []\n        this.algorithm = new CombiningAlgorithm(this.id, this.description, 'firstApplicable')\n        this.children = []\n        this.depth_level = null\n    }\n\n    _obj_constructor(rawObj) {\n        console.log(\"Constructing new AC Policy object\")\n        if(!(\"id\" in rawObj)) throw new Error(\"id not defined in policy object.\");\n        if(!(\"target\" in rawObj)) throw new Error(\"target not defined in policy object.\");\n        if(!(\"obligations\" in rawObj)) throw new Error(\"obligations not defined in policy object.\");\n        if(!(\"children\" in rawObj)) throw new Error(\"children not defined in policy object.\");\n        if(!(\"algorithm\" in rawObj)) throw new Error(\"policy combining algorithm not defined in policy object.\");\n        if(\"name\" in rawObj) {\n            this.name = rawObj.name\n        } else {\n            this.name = \"No Name\"\n        }\n        if(\"description\" in rawObj) {\n            this.description = rawObj.description\n        } else {\n            this.description = \"No Description\"\n        }\n\n        this.id = rawObj.id;\n        this.target = new Evaluable();\n        this.target._obj_constructor(rawObj.target)\n        this.obligations = rawObj.obligations;\n        this.children = rawObj.children.map((child)=>{\n            if (\"condition\" in child) {\n                // Child is a rule\n                let newRule = new Rule(this) // COnstruct rule object setting this policy to be its parent\n                newRule._obj_constructor(child)\n                // let split = newId.split('_')\n                // let idsuffix = parseInt(split[split.length-1])\n                // if ((idsuffix) >= this.idCounter) this.counter = idsuffix+1\n                return newRule\n            } else {\n                // Child is another policy\n                let newPolicy = new Policy(this)\n                newPolicy._obj_constructor(child)\n                // let split = newId.split('_')\n                // let idsuffix = parseInt(split[split.length-1])\n                // if ((idsuffix) > this.idCounter) this.counter = idsuffix+1\n                return newPolicy\n            }\n        });\n        this.algorithm = new CombiningAlgorithm(this.id, this.description, rawObj.algorithm);\n\n        this.depth_level = null\n\n        this.idCounter = this.children.length\n\n        return this.id\n    }\n\n    // Calculate depth of each component in policy and build up an accumulated depths for each ID object\n    calculateDepthLevel(d, acc) {\n        this.depth_level = d\n        let n = d\n        let nAcc = acc\n        for (var i=0; i<this.children.length; i++) {\n            [n, nAcc] = this.children[i].calculateDepthLevel(n+1, nAcc)\n        }\n        acc[this.id] = this.depth_level\n        return [n, nAcc]\n    }\n\n    isApplicable(request) {\n        // Test if the target is satisfied by the current request to determine if should be further evaluated\n        let res = this.target.evaluate(request);\n        this.isTargetMet = res\n        return res\n    }\n\n    evaluate(request) {\n        this.isActive = true\n        let results = [];\n        this.children.forEach(child => {\n            if (child.isApplicable(request)) {\n                results.push(child.evaluate(request));\n            } else {\n                child.deactivate()\n            }\n        });\n        this.finalDecision = this.algorithm.combine(results)\n        console.log(this.id + \" final decision is \" + this.finalDecision.id)\n        return this.finalDecision\n    }\n\n    deactivate() {\n        this.isActive = false\n        this.targetMet = false\n        this.finalDecision = undefined\n        this.children.forEach(child => {\n            child.deactivate()\n        })\n    }\n\n    setName(name) {\n        this.name = name\n    }\n\n    setDescription(desc) {\n        this.description = desc\n    }\n\n    setAlgorithm(algo) {\n        this.algorithm.setType(algo)\n    }\n\n    // Instruct the parent policy to move this policy up in its children\n    moveUpInParent() {\n        if (this.parent != null) {\n            this.parent.moveChildUp(this.id)\n        }\n    }\n\n    moveDownInParent() {\n        if (this.parent != null) {\n            this.parent.moveChildDown(this.id)\n        }\n    }\n\n    deleteInParent() {\n        if (this.parent != null) {\n            this.parent.deleteChild(this.id)\n        }\n    }\n\n    // Move a child policy up\n    moveChildUp(id) {\n        let array = this.children\n        let index = array.findIndex(n => n.id == id)\n        if (index == 0) {\n            // Do nothing it can't be moved up\n            return\n        }\n        // Remove the element from array\n        let newArray = array.slice(0, index).concat(array.slice(index+1))\n        newArray.splice(index-1, 0, array[index])\n        this.children = newArray\n    }\n\n    moveChildDown(id) {\n        let array = this.children\n        let index = array.findIndex(n => n.id == id)\n        if (index == array.length-1) {\n            // This is the last element so cant be moved\n            return\n        }\n        let newArray = array.slice(0, index).concat(array.slice(index+1))\n        newArray.splice(index+1, 0, array[index])\n        this.children = newArray\n    }\n\n    deleteChild(id) {\n        let array = this.children\n        let index = array.findIndex(n => n.id == id)\n        let newArray = this.children.slice(0)\n        newArray.splice(index, 1)\n        this.children = newArray\n    }\n\n    newChildPolicy() {\n        let newPolicy = new Policy(this)\n        newPolicy.init(this.id + '_' + this.idCounter)\n        this.idCounter++\n        this.children.push(newPolicy)\n    }\n\n    newChildRule() {\n        let newRule = new Rule(this)\n        newRule.init(this.id + '_' + this.idCounter)\n        this.idCounter++\n        this.children.push(newRule)\n    }\n\n    // Returns a plain old data object for use by React\n    getObject() {\n        return {\n            id : this.id,\n            name: this.name,\n            description: this.description,\n            obligations: this.obligations,\n            target: this.target,\n            algorithm: this.algorithm,\n            depth_level: this.depth_level,\n            children: this.children,\n            isActive: this.isActive,\n            isTargetMet: this.isTargetMet,\n            finalDecision: this.finalDecision\n        }\n    }\n\n    toJson() {\n        let target = this.target.toJson()\n        let children = this.children.map((child) => {\n            return child.toJson()\n        })\n\n        return {\n            id: this.id,\n            name: this.name,\n            description: this.description,\n            obligations: this.obligations,\n            target: target,\n            algorithm: this.algorithm.getType(),\n            children: children\n        }\n        \n    }\n}\n\nexport default Policy","export const CANVAS_TOP_SPACE = 50\nexport const CANVAS_LEFT_SPACE = 50\nexport const POLICY_COMPONENT_WIDTH = 150\nexport const POLICY_COMPONENT_HEIGHT = 50\nexport const POLICY_COMPONENT_COLOR = 'white'\nexport const RULE_COMPONENT_WIDTH = 150\nexport const RULE_COMPONENT_HEIGHT = 50\nexport const RULE_COMPONENT_COLOR_INACTIVE = \"white\"\nexport const RULE_COMPONENT_COLOR_INAPPLICABLE = \"grey\"\nexport const RULE_COMPONENT_COLOR_PERMIT = \"green\"\nexport const RULE_COMPONENT_COLOR_DENY = \"red\"\nexport const COMPONENT_BORDER_COLOR_UNSELECTED = \"grey\"\nexport const COMPONENT_BORDER_COLOR_SELECTED = \"black\"\nexport const CHILD_COMPONENT_HORIZONTAL_INDENT = POLICY_COMPONENT_WIDTH\nexport const CHILD_COMPONENT_VERTICAL_SPACE = POLICY_COMPONENT_HEIGHT * 2\nexport const LINE_COLOR_INACTIVE = 'grey'\nexport const LINE_COLOR_ACTIVE = 'black'\nexport const LINE_COLOR_PERMIT = 'green'\nexport const LINE_COLOR_DENY = 'red'\n\nexport const DRAGGABLE_EVALUABLES = [\n    {\n        name: \"Subject Has Attribute\",\n        type: \"Evaluable\",\n        options: {op:\"subjectHasAttribute\"}\n    },\n    {\n        name: \"Resource Has Attribute\",\n        type: \"Evaluable\",\n        options: {op: \"resourceHasAttribute\"}\n    },\n    {\n        name: \"Subject Attribute\",\n        type: \"Evaluable\",\n        options: {op: \"subjectAttribute\"}\n    },\n    {\n        name: \"Resource Attribute\",\n        type: \"Evaluable\",\n        options: {op: \"resourceAttribute\"}\n    },\n    {\n        name: \"Environment Attribute\",\n        type: \"Evaluable\",\n        options: {op: \"environmentAttribute\"}\n    },\n    {\n        name: \"Value\",\n        type: \"Evaluable\",\n        options: {op: \"value\"}\n    },\n    {\n        name: \"All Of\",\n        type: \"Evaluable\",\n        options: {op: \"combinator\", comOp: \"allOf\"}\n    },\n    {\n        name: \"Any Of\",\n        type: \"Evaluable\",\n        options: {op: \"combinator\", comOp: \"anyOf\"}\n    },\n    {\n        name: \"Equal To\",\n        type: \"Evaluable\",\n        options: {op: \"comparator\", comOp: \"equalTo\"}\n    },\n    {\n        name: \"Less Than\",\n        type: \"Evaluable\",\n        options: {op:\"comparator\", comOp: \"lessThan\"}\n    },\n    {\n        name: \"Action Type\",\n        type: \"Evaluable\",\n        options: {op: \"actionType\"}\n    }\n]\n\nexport const DRAGGABLE_ACTIONS = [\n    {\n        name: \"Power Control\",\n        type: \"Action\",\n        options: {type: \"powerControl\"}\n    },\n    {\n        name: \"Config Data 1\",\n        type: \"Action\",\n        options: {type: \"config1\"}\n    },\n    {\n        name: \"Config Data 2\",\n        type: \"Action\",\n        options: {type: \"config2\"}\n    }\n]","import React, { useState, useEffect } from 'react'\nimport { Arrow } from 'react-konva' \nimport * as Constants from '../constants/'\n\n// Component for connecting 2 boxes and will track as they're moved\nfunction ConnectingLine(props) {\n    const [active, setActive] = useState(props.parentActive)\n\n    useEffect(() => {\n        setActive(props.parentActive)\n    }, [props.parentActive])\n\n    let parentX\n    let parentY\n    let childX\n    let childY\n    if (props.parentPosition.x != 0 && props.parentPosition.y != 0) {\n        parentX = props.parentPosition.x + (Constants.POLICY_COMPONENT_WIDTH / 2)\n        parentY = props.parentPosition.y + (Constants.POLICY_COMPONENT_HEIGHT)\n        childX = props.childPosition.x\n        childY = props.childPosition.y + (Constants.POLICY_COMPONENT_HEIGHT / 2)\n    } else {\n        parentX = props.parentPosition.x\n        parentY = props.childPosition.y + (Constants.POLICY_COMPONENT_HEIGHT / 2)\n        childX = props.childPosition.x\n        childY = props.childPosition.y + (Constants.POLICY_COMPONENT_HEIGHT / 2)\n    }\n\n    let color = active ? Constants.LINE_COLOR_ACTIVE : Constants.LINE_COLOR_INACTIVE\n\n    // let finalDecisionLine = null\n    // if (isFinalDecision) {\n    //     finalDecisionLine = (\n\n    //     )\n    // }\n\n    return (\n        <Arrow\n        // x={parentX}\n        // y={parentY}\n        points={[parentX, parentY, parentX, childY, childX, childY]}\n        stroke={color}\n        fill={color}\n        pointerLength={10}\n        pointerWidth={10}\n        strokeWidth={2}\n        zIndex\n        />\n    )\n}\n\nexport default ConnectingLine","import React, { useState, useEffect } from 'react'\nimport { Arrow } from 'react-konva' \nimport * as Constants from '../constants/'\n\nfunction DecisionLine(props) {\n    //const [decision, setDecision] = useState(props.parentDecision)\n\n    if (!props.decision) return null\n\n    let parentX\n    let parentY\n    let childX\n    let childY\n    if (props.parentPosition.x != 0 && props.parentPosition.y != 0) {\n        parentX = (props.parentPosition.x + (Constants.POLICY_COMPONENT_WIDTH / 2)) - 10\n        parentY = props.parentPosition.y + (Constants.POLICY_COMPONENT_HEIGHT)\n        childX = props.childPosition.x\n        childY = (props.childPosition.y + (Constants.POLICY_COMPONENT_HEIGHT / 2)) + 10\n    } else {\n        parentX = props.parentPosition.x\n        parentY = (props.childPosition.y + (Constants.POLICY_COMPONENT_HEIGHT / 2)) + 10\n        childX = props.childPosition.x\n        childY = (props.childPosition.y + (Constants.POLICY_COMPONENT_HEIGHT / 2)) + 10\n    }\n\n    let color = props.decision.Decision == \"Permit\" ? \"green\" : props.decision.Decision == \"Deny\" ? \"red\" : \"grey\"\n\n    return (\n        <Arrow\n        // x={parentX}\n        // y={parentY}\n        points={[childX, childY, parentX, childY, parentX, parentY]}\n        stroke={color}\n        fill={color}\n        pointerLength={10}\n        pointerWidth={10}\n        strokeWidth={2}\n        zIndex\n        />\n    )\n}\n\nexport default DecisionLine","import React, { useState } from 'react'\n\nconst PolicyEditorContext = React.createContext(\n    {\n        selectedComponent: null,\n        setSelectedComponent: function() {},\n        request: null,\n        setRequest: function() {}\n    }\n)\n\nexport default PolicyEditorContext","import React,{ useState, useRef, useEffect, useContext } from 'react'\n\nimport PolicyEditorContext from './PolicyEditorContext'\nimport * as Constants from '../constants/'\n\nfunction useRule(rule) {\n    const context = useContext(PolicyEditorContext)\n    const ruleContainer = useRef(rule)\n    const [rulePojo, setRulePojo] = useState(rule.getObject())\n    const [id, setId] = useState(rule.id)\n    const [depthLevel, setDepthLevel] = useState(null)\n    const [finalDecision, setFinalDecision] = useState(undefined)\n\n    useEffect(() => {\n        return () => {\n            console.log(ruleContainer.current.id + \" hook unmounted\")\n            ruleContainer.current = null\n        }\n    }, [])\n\n    useEffect(() => {\n        if (context.selectedComponent && context.selectedComponent.id == id) {\n            context.setSelectedPojo(rulePojo)\n        }\n    }, [context.selectedComponent])\n\n    useEffect(() => {\n        if (context.selectedComponent && context.selectedComponent.id == id) {\n            context.setSelectedPojo(rulePojo)\n        }\n    }, [rulePojo])\n\n    useEffect(() => {\n        if (context.depthLevels) {\n            setDepthLevel((context.depthLevels[id] * Constants.CHILD_COMPONENT_VERTICAL_SPACE) + Constants.CANVAS_TOP_SPACE)\n            setRulePojo(ruleContainer.current.getObject())\n        }\n    }, [context.depthLevels])\n\n    useEffect(() => {\n        setRulePojo(ruleContainer.current.getObject())\n    }, [context.finalDecision])\n\n    function setName(name) {\n        ruleContainer.current.setName(name)\n        setRulePojo(ruleContainer.current.getObject())\n    }\n\n    function setDescription(desc) {\n        ruleContainer.current.setDescription(desc)\n        setRulePojo(ruleContainer.current.getObject())\n    }\n\n    function setEffect(effect) {\n        ruleContainer.current.setEffect(effect)\n        setRulePojo(ruleContainer.current.getObject())\n        context.reevaluateRequest()\n    }\n\n    function moveUp() {\n        ruleContainer.current.moveUpInParent()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n\n    function moveDown() {\n        ruleContainer.current.moveDownInParent()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n\n    function destroy() {\n        context.setSelectedComponent(undefined)\n        ruleContainer.current.deleteInParent()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n\n    return {\n        id: id,\n        rulePojo: rulePojo,\n        ruleObj: ruleContainer.current,\n        setName: setName,\n        setDescription: setDescription,\n        setEffect: setEffect,\n        depthLevel: depthLevel,\n        moveUp: moveUp,\n        moveDown: moveDown,\n        destroy: destroy,\n        finalDecision: finalDecision\n    }\n}\n\nexport default useRule","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport { Rect, Group, Text, Label, Tag } from 'react-konva'\nimport * as Constants from '../constants/'\n\nimport ConnectingLine from './ConnectingLine'\nimport DecisionLine from './DecisionLine'\nimport PolicyEditorContext from '../hooks/PolicyEditorContext'\nimport useRule from '../hooks/useRule'\n\nfunction RuleComponent(props) {\n    const ruleObj = useRef(props.rule)\n    const ruleHook = useRule(props.rule)\n    const rule = ruleHook.rulePojo\n    const [parentPosition, setParentPosition] = useState(props.parentPosition)\n    const [pos, setPos] = useState(null)\n    const [parentActive, setParentActive] = useState(props.parentActive)\n    const [isParentsDecision, setIsParentsDecision] = useState(false)\n    // const [parentFinalDecision, setParentFinalDecision] = useState(props.parentFinalDecision)\n    const context = useContext(PolicyEditorContext)\n\n    const controlsRef = useRef()\n    const labelRef = useRef()\n\n    let isSelected = context.selectedComponent? context.selectedComponent.id == rule.id : false\n\n    let isFinalDecision = context.finalDecision ? context.finalDecision.id == rule.id : false\n\n    useEffect(() => {\n        return () => {\n            // Called when component is unmounted\n            console.log(rule.id + \" unmounted\")\n        }\n    }, [])\n\n    useEffect(() => {\n        if (ruleHook.depthLevel != null) {\n            setPos({x: props.x, y: ruleHook.depthLevel})\n        }\n    }, [ruleHook.depthLevel])\n\n    useEffect(() => {\n        if (pos != null) {\n            if(isSelected) {\n                controlsRef.current.show()\n            } else {\n                controlsRef.current.hide()\n            }\n        }\n    }, [isSelected])\n\n    useEffect(() => {\n        setParentPosition(props.parentPosition)\n    }, [props.parentPosition])\n\n    useEffect(() => {\n        setParentActive(props.parentActive)\n    }, [props.parentActive])\n\n    useEffect(() => {\n        if (context.request != null) {\n            if (rule.finalDecision && props.parentFinalDecision) {\n                setIsParentsDecision(props.parentFinalDecision.id == rule.finalDecision.id)\n            } else {\n                setIsParentsDecision(false)\n            }\n        } else {\n            setIsParentsDecision(false)\n        }\n    }, [props.parentFinalDecision])\n\n    if (pos == null) return null\n\n    function handleControlHoverIn(e) {\n        document.body.style.cursor = \"pointer\"\n        //e.target.setFill(Constants.LINE_COLOR_ACTIVE)\n    }\n\n    function handleControlHoverOut(e) {\n        document.body.style.cursor = \"default\"\n        //e.target.fill(Constants.LINE_COLOR_INACTIVE)\n    }\n\n    function handleSelect(e) {\n        console.log(rule.id + \" clicked\")\n        context.setSelectedComponent(ruleHook)\n    }\n\n    function handleDragMove(e) {\n        setPos({x: e.target.x(), y: e.target.y()})\n    }\n\n    function handleDragEnd(e) {\n        setPos({x: e.target.x(), y: e.target.y()})\n    }\n\n    let connectingLine = <ConnectingLine parentPosition={parentPosition} childPosition={pos} parentActive={parentActive} />\n\n    let decisionLine = null\n    if (isParentsDecision) {\n        decisionLine = <DecisionLine parentPosition={parentPosition} childPosition={pos} decision={rule.finalDecision} />\n    }\n\n    let color = parentActive ? (rule.isTargetMet && rule.isConditionMet ? (rule.effect == \"Permit\" ? Constants.RULE_COMPONENT_COLOR_PERMIT : Constants.RULE_COMPONENT_COLOR_DENY) : Constants.RULE_COMPONENT_COLOR_INAPPLICABLE) : Constants.RULE_COMPONENT_COLOR_INACTIVE\n\n    let border_color = isSelected ? Constants.COMPONENT_BORDER_COLOR_SELECTED : Constants.COMPONENT_BORDER_COLOR_UNSELECTED\n\n    let thisComponent = (\n        <Group x={pos.x} y={pos.y} draggable onDragMove={handleDragMove} onDragEnd={handleDragEnd} onClick={handleSelect}>\n            <Rect\n                x={0}\n                y={0}\n                width={Constants.RULE_COMPONENT_WIDTH}\n                height={Constants.RULE_COMPONENT_HEIGHT}\n                fill={color}\n                stroke={border_color}\n            />\n            <Text\n                x={Constants.RULE_COMPONENT_HEIGHT * 0.1}\n                y={Constants.RULE_COMPONENT_HEIGHT * 0.1}\n                text={rule.name}\n                fontSize={15}\n                fontFamily={'Calibri'}\n                fill={'black'}\n            />\n            <Label\n                x={Constants.RULE_COMPONENT_WIDTH + 5}\n                y={Constants.RULE_COMPONENT_HEIGHT / 2}\n                tag={labelRef}\n                visible={isFinalDecision}>\n                    <Tag\n                    pointerDirection={'left'}\n                    pointerWidth={10}\n                    pointerHeight={10}\n                    fill={context.finalDecision? context.finalDecision.Decision == \"Permit\" ? 'green' : context.finalDecision.Decision == \"Deny\" ? 'red' : 'grey' : 'black'}\n                    lineJoin='round'\n                    />\n                    <Text\n                        text={'Final decision'}\n                        fontSize={18}\n                        padding={5}\n                        fill={'white'}\n                    />\n            </Label>\n            <Group ref={controlsRef} visible={false}>\n                <Text\n                    x={Constants.POLICY_COMPONENT_WIDTH + 5}\n                    y={0}\n                    fontSize={15}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    onClick={ruleHook.moveUp}\n                    text={'\\uf062'}\n                />\n                <Text\n                    x={Constants.POLICY_COMPONENT_WIDTH + 5}\n                    y={20}\n                    fontSize={15}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    text={'\\uf063'}\n                    onClick={ruleHook.moveDown}\n                />\n                <Text\n                    x={Constants.POLICY_COMPONENT_WIDTH + 5}\n                    y={40}\n                    fontSize={15}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    text={'\\uf1f8'}\n                    onClick={ruleHook.destroy}\n                />\n            </Group>\n        </Group>\n    )\n\n    return (\n        <>\n        {connectingLine}\n        {decisionLine}\n        {thisComponent}\n        </>\n    )\n}\n\nexport default RuleComponent","import React,{ useState, useRef, useEffect, useContext } from 'react'\nimport * as Constants from '../constants/'\nimport PolicyEditorContext from './PolicyEditorContext'\n\nfunction usePolicy(policy) {\n    const context = useContext(PolicyEditorContext)\n    const policyContainer = useRef(policy)\n    const [policyPojo, setPolicyPojo] = useState(policy.getObject())\n    const [id, setId] = useState(policy.id)\n    const [depthLevel, setDepthLevel] = useState(null)\n    const [isRoot, setIsRoot] = useState(false)\n    // const [targetMet, setTargetMet] = useState(false)\n    // const [receivedDecisions, setReceivedDecisions] = useState([])\n    // const [finalDecision, setFinalDecision] = useState(undefined)\n\n    useEffect(() => {\n        return () => {\n            console.log(policyContainer.current.id + \" hook unmounted\")\n            policyContainer.current = null\n        }\n    }, [])\n\n    useEffect(() => {\n        if (context.selectedComponent && context.selectedComponent.id == id) {\n            context.setSelectedPojo(policyPojo)\n        }\n    }, [context.selectedComponent])\n\n    useEffect(() => {\n        if (context.selectedComponent && context.selectedComponent.id == id) {\n            context.setSelectedPojo(policyPojo)\n        }\n    }, [policyPojo])\n\n    useEffect(() => {\n        if (context.depthLevels) {\n            if (context.depthLevels[id] == 0) setIsRoot(true)\n            setDepthLevel((context.depthLevels[id] * Constants.CHILD_COMPONENT_VERTICAL_SPACE) + Constants.CANVAS_TOP_SPACE)\n            // Will also update the pojo because a component might have been added or deleted\n            setPolicyPojo(policyContainer.current.getObject())\n        }\n    }, [context.depthLevels])\n\n    useEffect(() => {\n        setPolicyPojo(policyContainer.current.getObject())\n    }, [context.finalDecision])\n\n    function setName(name) {\n        policyContainer.current.setName(name)\n        setPolicyPojo(policyContainer.current.getObject())\n    }\n\n    function setDescription(desc) {\n        policyContainer.current.setDescription(desc)\n        setPolicyPojo(policyContainer.current.getObject())\n    }\n\n    function setAlgorithm(algo) {\n        policyContainer.current.setAlgorithm(algo)\n        setPolicyPojo(policyContainer.current.getObject())\n        context.reevaluateRequest()\n    }\n\n    // Move the policy 'up' in the parents children list \n    function moveUp() {\n        policyContainer.current.moveUpInParent()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n    \n    function moveDown() {\n        policyContainer.current.moveDownInParent()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n\n    function destroy() {\n        context.setSelectedComponent(undefined)\n        policyContainer.current.deleteInParent()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n\n    function newPolicy() {\n        policyContainer.current.newChildPolicy()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n\n    function newRule() {\n        policyContainer.current.newChildRule()\n        context.recalculateDepthLevels()\n        context.reevaluateRequest()\n    }\n\n    // function provideDecision(decision) {\n    //     setReceivedDecisions(array=> array.concat(decision))\n    // }\n\n    return {\n        id: id,\n        policyPojo: policyPojo,\n        policyObj: policyContainer.current,\n        depthLevel: depthLevel,\n        isRoot: isRoot,\n        setName: setName,\n        setDescription: setDescription,\n        setAlgorithm: setAlgorithm,\n        moveUp: moveUp,\n        moveDown: moveDown,\n        destroy: destroy,\n        newPolicy: newPolicy,\n        newRule: newRule\n    }\n}\n\nexport default usePolicy","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport { Group, Rect, Text, Label, Tag } from 'react-konva'\nimport * as Constants from '../constants/'\nimport Konva from 'konva'\n\nimport RuleComponent from './RuleComponent'\nimport ConnectingLine from './ConnectingLine'\nimport DecisionLine from './DecisionLine'\nimport PolicyEditorContext from '../hooks/PolicyEditorContext'\nimport usePolicy from '../hooks/usePolicy'\n\n// Will be passed the details of the \nfunction PolicyComponent(props) {\n    const policyObj = useRef(props.policy)\n    const policyHook = usePolicy(props.policy)\n    const policy = policyHook.policyPojo\n    const [parentPosition, setParentPosition] = useState(props.parentPosition)\n    const [parentActive, setParentActive] = useState(props.parentActive)\n    const [pos, setPos] = useState(null)\n    const context = useContext(PolicyEditorContext)\n    const controlsRef = useRef()\n    const [isParentsDecision, setIsParentsDecision] = useState(false)\n\n    let isSelected = context.selectedComponent ? context.selectedComponent.id == policy.id : false\n\n    let isFinalDecision = context.finalDecision ? context.finalDecision.id == policy.id : false\n\n    useEffect(() => {\n        if (policyHook.depthLevel != null) {\n            setPos({x: props.x, y: policyHook.depthLevel})\n        }\n    }, [policyHook.depthLevel])\n\n    useEffect(() => {\n        if (policy) {\n            console.log(policy.id + \" has \" + policy.children.length + \" children \" + policy.children.map(pol => pol.id))\n        }\n    }, [policy])\n\n    // Update state that parents position has changed - so that the connecting lines props are updated and is redrawn\n    useEffect(() => {\n        setParentPosition(props.parentPosition)\n    }, [props.parentPosition])\n\n    useEffect(() => {\n        setParentActive(props.parentActive)\n    }, [props.parentActive])\n\n    useEffect(() => {\n        if (context.request != null) {\n            if (props.parentFinalDecision && policy.finalDecision) {\n                setIsParentsDecision(props.parentFinalDecision.id == policy.finalDecision.id)\n            } else {\n                setIsParentsDecision(false)\n            }\n        } else {\n            setIsParentsDecision(false)\n        } \n    }, [props.parentFinalDecision])\n\n    if (pos == null) {return null}\n\n    function handleControlHoverIn(e) {\n        document.body.style.cursor = \"pointer\"\n        //e.target.setFill(Constants.LINE_COLOR_ACTIVE)\n    }\n\n    function handleControlHoverOut(e) {\n        document.body.style.cursor = \"default\"\n        //e.target.fill(Constants.LINE_COLOR_INACTIVE)\n    }\n\n    function handleSelect(e) {\n        console.log(policy.id + ' selected')\n        context.setSelectedComponent(policyHook)\n    }\n\n    function handleDragMove(e) {\n        setPos({x: e.target.x(), y: e.target.y()})\n    }\n\n    function handleDragEnd(e) {\n        setPos({x: e.target.x(), y: e.target.y()})\n    }\n\n    let connectingLine = <ConnectingLine parentPosition={parentPosition} childPosition={pos} parentActive={parentActive} />\n\n    let decisionLine = null\n    if (isParentsDecision && context.finalDecision) {\n        decisionLine = <DecisionLine parentPosition={parentPosition} childPosition={pos} decision={policy.finalDecision} />\n    }\n\n    let border_color = isSelected ? Constants.COMPONENT_BORDER_COLOR_SELECTED : Constants.COMPONENT_BORDER_COLOR_UNSELECTED\n\n    let thisGroupComponent = (\n        <Group x={pos.x} y={pos.y} draggable onDragMove={handleDragMove} onDragEnd={handleDragEnd} onClick={handleSelect} >\n            <Rect\n                x={0}\n                y={0}\n                width={Constants.POLICY_COMPONENT_WIDTH}\n                height={Constants.POLICY_COMPONENT_HEIGHT}\n                fill={Constants.POLICY_COMPONENT_COLOR}\n                stroke={border_color}\n            />\n            <Text\n                x={Constants.POLICY_COMPONENT_HEIGHT * 0.1}\n                y={Constants.POLICY_COMPONENT_HEIGHT * 0.1}\n                text={policy.name}\n                fontSize={15}\n                fontFamily={'Calibri'}\n                fill={'black'}\n            />\n            <Text\n                x={Constants.POLICY_COMPONENT_HEIGHT * 0.1}\n                y={Constants.POLICY_COMPONENT_HEIGHT * 0.5}\n                text={`Target met: ${policy.isTargetMet}`}\n                fontSize={15}\n                fontFamily={'Calibri'}\n                fill={'black'}\n            />\n            <Label\n                x={Constants.RULE_COMPONENT_WIDTH + 5}\n                y={Constants.RULE_COMPONENT_HEIGHT / 2}\n                visible={isFinalDecision}>\n                    <Tag\n                    pointerDirection={'left'}\n                    pointerWidth={10}\n                    pointerHeight={10}\n                    fill={context.finalDecision ? context.finalDecision.Decision == \"Permit\" ? 'green' : context.finalDecision.Decision == \"Deny\" ? 'red' : 'grey' : 'black'}\n                    lineJoin='round'\n                    />\n                    <Text\n                        text={'Final decision'}\n                        fontSize={18}\n                        padding={5}\n                        fill={'white'}\n                    />\n            </Label>\n            <Group ref={controlsRef} visible={isSelected}>\n                {(policyHook.isRoot ? null : <Text\n                    x={Constants.POLICY_COMPONENT_WIDTH + 5}\n                    y={0}\n                    fontSize={15}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    text={'\\uf062'}\n                    onClick={policyHook.moveUp}\n                />)}\n                {(policyHook.isRoot ? null : <Text\n                    x={Constants.POLICY_COMPONENT_WIDTH + 5}\n                    y={20}\n                    fontSize={15}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    text={'\\uf063'}\n                    onClick={policyHook.moveDown}\n                />)}\n                {(policyHook.isRoot ? null : <Text\n                    x={Constants.POLICY_COMPONENT_WIDTH + 5}\n                    y={40}\n                    fontSize={15}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    text={'\\uf1f8'}\n                    onClick={policyHook.destroy}\n                />)}\n                <Text\n                    x={0}\n                    y={Constants.POLICY_COMPONENT_HEIGHT + 5}\n                    fontSize={13}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    text={'\\uf067 Policy'}\n                    onClick={policyHook.newPolicy}\n                />\n                <Text\n                    x={Constants.POLICY_COMPONENT_WIDTH * 0.6}\n                    y={Constants.POLICY_COMPONENT_HEIGHT + 5}\n                    fontSize={13}\n                    fontFamily=\"FontAwesome\"\n                    fill={Constants.LINE_COLOR_INACTIVE}\n                    onMouseEnter={handleControlHoverIn}\n                    onMouseLeave={handleControlHoverOut}\n                    text={'\\uf067 Rule'}\n                    onClick={policyHook.newRule}\n                />\n            </Group>\n        </Group>\n    )\n\n    let childrenComponents = null\n    if (policy.children.length > 0) {\n        childrenComponents = policy.children.map(child => {\n            if ('children' in child) {\n                return <PolicyComponent\n                        key={child.id}\n                        policy={child}\n                        x={props.x + Constants.CHILD_COMPONENT_HORIZONTAL_INDENT}\n                        parentPosition={pos}\n                        parentActive={policy.isActive}\n                        parentFinalDecision={policy.finalDecision}\n                        />\n            } else {\n                return  <RuleComponent\n                        key={child.id}\n                        rule={child}\n                        x={props.x + Constants.CHILD_COMPONENT_HORIZONTAL_INDENT}\n                        parentPosition={pos}\n                        parentActive={policy.isActive}\n                        parentFinalDecision={policy.finalDecision}\n                        />\n            }\n        })\n    }\n\n    return (\n        <>\n        {thisGroupComponent} \n        {context.finalDecision ? decisionLine : null}\n        {connectingLine}\n        {childrenComponents}\n        </>\n    )\n}\n\nexport default PolicyComponent","import React, { useState, useEffect, useRef } from 'react'\nimport { Canvas, Stage, Layer, Rect } from 'react-konva'\nimport FontFaceObserver from 'fontfaceobserver'\n\nimport Policy from './accesscontrol/syntax/Policy'\nimport Request from './accesscontrol/syntax/Request'\nimport './styles/PolicyStage.css'\nimport * as Constants from './constants/'\n\nimport PolicyComponent from './policycomponents/PolicyComponent'\n//import SelectedComponentContext from './hooks/SelectedComponentContext'\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\nfunction PolicyStage(props) {\n    // const [policy, setPolicy] = useState(null)\n    const layerRef = useRef()\n\n    useEffect(() => {\n        let font = new FontFaceObserver(\"FontAwesome\")\n        font.load().then(()=> {\n            if (layerRef.current) {\n                layerRef.current.draw()\n            }\n        })\n    }, [])\n\n    // useEffect(() => {\n    //     setPolicy(props.policy)\n    // }, [props.policy])\n\n    if (props.policy == null) return null;\n\n\n    return(\n        <PolicyEditorContext.Consumer>\n            {(context) => (\n                <Stage width={1000} height={1000}>\n                <PolicyEditorContext.Provider value={context}>\n                <Layer ref={layerRef}>\n                    <PolicyComponent \n                    policy={props.policy} \n                    x={Constants.CANVAS_LEFT_SPACE} \n                    parentPosition={{x:0, y:0}} \n                    parentActive={true}\n                    />\n                </Layer>\n                </PolicyEditorContext.Provider>\n                </Stage>\n            )}\n        </PolicyEditorContext.Consumer>\n    )\n}\n\nexport default PolicyStage","import React, { useState, useEffect } from 'react'\nimport './styles/ControlPanel.css'\n\n// This component only exists when a component is selected, can be closed with an x arrow which deselects the component\nfunction ShadeHeader(props) {\n    const [isOpen, setIsOpen] = useState(props.isOpen)\n\n\n    function handleCollapse() {\n        let tmpIsOpen = !isOpen\n        setIsOpen(tmpIsOpen)\n        props.onCollapse(tmpIsOpen)\n    }\n\n    return (\n        <div className=\"shade-header\">\n            <span className=\"title\">{props.title}</span>\n            <div className=\"shade-controls\">\n                {props.editable ? props.isEditing ? <i className=\"fa fa-floppy-o\" onClick={() => props.onSave()}></i> : <i id=\"edit\" class=\"fa fa-pencil\" onClick={()=>props.onEdit(true)}></i> : null}\n                <i id=\"collapse\" class={isOpen ? \"fa fa-caret-down\" : \"fa fa-caret-left\"} onClick={handleCollapse}></i>\n                {props.removeable ? <i id=\"close\" class=\"fa fa-times-circle\" onClick={props.onRemove}></i> : null}\n            </div>\n        </div>\n    )\n}\n\nexport default ShadeHeader","import React, { useState, useEffect, useContext } from 'react'\nimport './styles/ControlPanel.css'\n\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\nfunction PolicyComponentEditor(props) {\n    const context = useContext(PolicyEditorContext)\n    const selectedComponent = context.selectedComponent\n\n    function handleNameChange(e) {\n        context.selectedComponent.setName(e.target.value)\n    }\n\n    function handleDescChange(e) {\n        context.selectedComponent.setDescription(e.target.value)\n    }\n\n    function handleAlgorithmChange(e) {\n        selectedComponent.setAlgorithm(e.target.value)\n    }\n\n    if (context.selectedPojo) {\n        return (\n            <div className=\"policy-editor\">\n                <form>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"nameEntry\" className=\"form-control-sm\">Policy Name</label>\n                        <input className=\"form-control form-control-sm\" id=\"nameEntry\" placeholder=\"Policy Name\" value={context.selectedPojo.name} onChange={handleNameChange}/>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"descEntry\" className=\"form-control-sm\">Policy Description (This will be provided in the response to the user)</label>\n                        <input className=\"form-control form-control-sm\" id=\"descEntry\" placeholder=\"Policy Name\" value={context.selectedPojo.description} onChange={handleDescChange}/>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"algoEntry\" className=\"form-control-sm\">Combining Algorithm</label>\n                        <select className=\"form-control form-control-sm\" id=\"algoEntry\" placeholder=\"Policy Name\" value={context.selectedPojo.algorithm.getType()} onChange={handleAlgorithmChange}>\n                            <option value=\"firstApplicable\">First Applicable</option>\n                            <option value=\"denyOverrides\">Deny Overrides</option>\n                            <option value=\"permitOverrides\">Permit Overrides</option>\n                            <option value=\"denyUnlessPermit\">Deny Unless Permit</option>\n                            <option value=\"permitUnlessDeny\">Permit Unless Deny</option>\n                        </select>\n                    </div>\n                </form>\n                \n                \n            </div>\n        )\n    } else {\n        return null\n    }\n}\n\nexport default PolicyComponentEditor\n","import React, { useState, useEffect, useContext } from 'react'\nimport './styles/ControlPanel.css'\n\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\nfunction RuleComponentEditor(props) {\n    const context = useContext(PolicyEditorContext)\n\n    function handleNameChange(e) {\n        context.selectedComponent.setName(e.target.value)\n    }\n\n    function handleDescChange(e) {\n        context.selectedComponent.setDescription(e.target.value)\n    }\n    \n    function handleEffectChange(e) {\n        context.selectedComponent.setEffect(e.target.value)\n    }\n\n    if (context.selectedPojo) {\n        return (\n            <div className=\"policy-editor\">\n                <form>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"nameEntry\" className=\"form-control-sm\">Rule Name</label>\n                        <input className=\"form-control form-control-sm\" id=\"nameEntry\" placeholder=\"Rule Name\" value={context.selectedPojo.name} onChange={handleNameChange}/>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"descEntry\" className=\"form-control-sm\">Rule Description (This will be provided in the response to the user)</label>\n                        <input className=\"form-control form-control-sm\" id=\"descEntry\" placeholder=\"Rule Description\" value={context.selectedPojo.description} onChange={handleDescChange}/>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"effectEntry\" className=\"form-control-sm\">Effect</label>\n                        <select className=\"form-control form-control-sm\" id=\"effectEntry\" placeholder=\"Policy Name\" value={context.selectedPojo.effect} onChange={handleEffectChange}>\n                            <option value=\"Permit\">Permit</option>\n                            <option value=\"Deny\">Deny</option>\n                        </select>\n                    </div>\n                </form>\n            </div>\n        )\n    } else {\n        return null\n    }\n}\n\nexport default RuleComponentEditor","import React from 'react'\n\nconst EvaluableErrorContext = React.createContext(\n    {\n        error: null\n    }\n)\n\nexport default EvaluableErrorContext","import React, { useState, useEffect, useContext, useRef } from 'react'\nimport Evaluable from '../accesscontrol/syntax/Evaluable'\n\nimport PolicyEditorContext from './PolicyEditorContext'\nimport EvaluableErrorContext from './EvaluableErrorContext'\n\nfunction useEvaluable(evaluable) {\n    const context = useContext(PolicyEditorContext)\n    const errorContext = useContext(EvaluableErrorContext)\n    const evaluableContainer = useRef(evaluable)\n    const [evaluablePojo, setEvaluablePojo] = useState(evaluable.getObject())\n\n    useEffect(() => {\n        // Refresh object if there has been an error\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }, [errorContext.error])\n\n    // Should only be called by Empty components!!\n    function setOp(op, comOp) {\n        if (evaluableContainer.current.op != 'empty') {\n            throw new Error('Cannot change the op of an existing evaluable')\n        }\n        switch(op) {\n            case 'subjectHasAttribute':\n                evaluableContainer.current.initSubjectHasAttribute()\n                break\n            case 'resourceHasAttribute':\n                evaluableContainer.current.initResourceHasAttribute()\n                break\n            case 'subjectAttribute':\n                evaluableContainer.current.initSubjectAttribute()\n                break\n            case 'resourceAttribute':\n                evaluableContainer.current.initResourceAttribute()\n                break\n            case 'environmentAttribute':\n                evaluableContainer.current.initEnvironmentAttribute()\n                break\n            case 'comparator':\n                evaluableContainer.current.initComparator(comOp)\n                break\n            case 'combinator':\n                evaluableContainer.current.initCombinator(comOp)\n                break\n            case 'value':\n                evaluableContainer.current.initValue()\n                break\n            case 'actionType':\n                evaluableContainer.current.initActionType()\n                break\n            default:\n                throw new Error(\"Could not set op to invalid op\")\n        }\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }\n\n    function setAttribute(attr) {\n        evaluableContainer.current.attr = {attribute_id: attr.attribute_id, data_type: attr.data_type}\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }\n\n    function setEmpty() {\n        evaluableContainer.current.resetToEmpty()\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }\n\n    function setAction(type) {\n        evaluableContainer.current.setAction(type)\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }\n\n    function combinatorAdd() {\n        if (evaluableContainer.current.op != \"combinator\") {\n            throw new Error(\"Cannot add to non combinator\")\n        }\n        evaluableContainer.current.combinatorAddChild()\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }\n\n    function setValue(value) {\n        if (evaluableContainer.current.op != 'value') {\n            throw new Error(\"cannot set value of non value eval\")\n        }\n        evaluableContainer.current.setValue(value)\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }\n\n    function setDataType(dt) {\n        if (evaluableContainer.current.op != 'value') {\n            throw new Error(\"cannot set value of non value eval\")\n        }\n        evaluableContainer.current.data_type = dt\n        setEvaluablePojo(evaluableContainer.current.getObject())\n    }\n\n    return {\n        evaluableObj: evaluableContainer.current,\n        evaluablePojo: evaluablePojo,\n        setOp: setOp,\n        setEmpty: setEmpty,\n        combinatorAdd: combinatorAdd,\n        setAttribute: setAttribute,\n        setValue: setValue,\n        setDataType: setDataType,\n        setAction: setAction\n    }\n}\n\nexport default useEvaluable","import React, { useState, useContext } from 'react'\nimport { useDrop } from 'react-dnd'\nimport '../styles/Evaluable.css'\n\nimport useEvaluable from '../hooks/useEvaluable'\nimport EvaluableComponent from './EvaluableComponent'\n\nimport PolicyEditorContext from '../hooks/PolicyEditorContext'\n\nfunction EmptyComponent(props) {\n    const context = useContext(PolicyEditorContext)\n    const evalHook = props.evaluable\n\n    const [{ isHovering }, drop] = useDrop({\n        accept: \"Evaluable\",\n        drop(item, monitor) {\n            if (!props.isEditing) return\n            const didDrop = monitor.didDrop()\n            handleDrop(item.options.op, item.options.comOp)\n        },\n        collect: monitor => ({\n            isHovering: monitor.isOver()\n        })\n    })\n\n    if (evalHook.evaluablePojo.op != 'empty') {\n        let evaluable = evalHook.evaluableObj\n        return <EvaluableComponent evaluable={evaluable} isEditing={props.isEditing}/>\n    }\n\n    // Dropping an evaluable on to Empty should replace it\n    function handleDrop(op, comOp) {\n        evalHook.setOp(op, comOp)\n    }\n\n\n    return (\n        <div ref={drop} className={`evaluable-container ${isHovering ? 'hover' : ''}`}>\n            <span className=\"eval-op-label\">Empty</span>\n            <span className=\"eval-detail-label\">(Always true)</span>\n        </div>\n    )\n}\n\nexport default EmptyComponent","import React, {useState, useEffect} from 'react'\nimport '../styles/Evaluable.css'\n\nimport useEvaluable from '../hooks/useEvaluable'\nimport EvaluableComponent from './EvaluableComponent'\n\nfunction CombinatorComponent(props) {\n    const evalHook = props.evaluable\n    const evalPojo = evalHook.evaluablePojo\n    const [isEditing, setIsEditing] = useState(props.isEditing)\n\n    useEffect(() => {\n        setIsEditing(props.isEditing)\n    }, [props.isEditing])\n\n    function showError() {\n        window.alert(evalPojo.errordetail)\n    }\n\n    if (!evalPojo) return null\n\n    if (evalPojo.op != 'combinator') {\n        let evaluable = evalHook.evaluableObj\n        return <EvaluableComponent evaluable={evaluable} isEditing={props.isEditing} />\n    }\n\n    let label\n    if (evalPojo.combinator.op == \"allOf\") {\n        label = \"All Of\"\n    } else if (evalPojo.combinator.op == \"anyOf\") {\n        label = \"Any Of\"\n    }\n\n    let editingIcons = null\n    if (isEditing) {\n        editingIcons = (\n            <div className=\"evaluable-icons\">\n                <i className=\"fa fa-plus\" onClick={evalHook.combinatorAdd}>add</i>\n                <i className=\"fa fa-trash-o\" onClick={evalHook.setEmpty}>del</i>\n                {evalPojo.error ? <i className=\"fa fa-exclamation-triangle\" onClick={showError}>err</i> : null}\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"evaluable-container\">\n            <span className=\"eval-op-label combinator\">{label}{editingIcons}</span>\n            \n            {evalPojo.combinator.children.map((child) => {\n                return (<div className=\"eval-combinator-child\">\n                    <EvaluableComponent evaluable={child} isEditing={isEditing}/>\n                </div>)\n            })}\n        </div>\n    )\n}\n\nexport default CombinatorComponent","import React, {useState, useEffect} from 'react'\nimport { useDrop } from 'react-dnd'\nimport '../styles/Evaluable.css'\n\nimport useEvaluable from '../hooks/useEvaluable'\nimport EvaluableComponent from './EvaluableComponent';\n\nfunction AttributeComponent(props) {\n    const evalHook = props.evaluable\n    const evalPojo = evalHook.evaluablePojo\n    const [isEditing, setIsEditing] = useState(props.isEditing)\n    const [{ isHovering }, drop] = useDrop({\n        accept: \"Attribute\",\n        drop(item, monitor) {\n            if (!props.isEditing) return\n            const didDrop = monitor.didDrop()\n            handleDrop(item.options)\n        },\n        collect: monitor => ({\n            isHovering: monitor.isOver({shallow:true})\n        })\n    })\n\n    useEffect(() => {\n        setIsEditing(props.isEditing)\n    }, [props.isEditing])\n\n    function showError() {\n        window.alert(evalPojo.errordetail)\n    }\n\n\n    function handleDrop(attr) {\n        evalHook.setAttribute(attr)\n    }\n\n    if (!evalPojo) return null\n\n    let label\n    if (evalPojo.op == \"subjectAttribute\") {\n        label = \"Subject Attribute\"\n    } else if (evalPojo.op == \"resourceAttribute\") {\n        label = \"Resource Attribute\"\n    } else if(evalPojo.op == \"environmentAttribute\") {\n        label = \"Environment Attribute\"\n    }\n\n    let content = (<div ref={drop} className={`empty-placeholder ${isHovering ? \"hover\" : \"\"}`}>\n        <span className=\"eval-detail-label\">You must put an attribute here!</span>\n    </div>)\n    if (evalPojo.attribute != null) {\n        content = <span ref={drop} className={`eval-detail-label ${isHovering ? \"hover\" : \"\"}`}>{evalPojo.attribute.attribute_id}</span>\n    }\n\n    let editingIcons = null\n    if (props.isEditing) {\n        editingIcons = (\n            <div className=\"evaluable-icons\">\n                <i className=\"fa fa-trash-o\" onClick={evalHook.setEmpty}>del</i>\n                {evalPojo.error ? <i className=\"fa fa-exclamation-triangle\" onClick={showError}>err</i> : null}\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"evaluable-container\">\n            <span className=\"eval-op-label\">{label}{editingIcons}</span>\n            {content}\n            <span className=\"eval-op-label\">Defaults To</span>\n            <EvaluableComponent evaluable={evalPojo.default_value} isEditing={isEditing} />\n        </div>\n    )\n}\n\nexport default AttributeComponent","import React from 'react'\nimport { useDrop } from 'react-dnd'\nimport '../styles/Evaluable.css'\n\n\nfunction HasAttributeComponent(props) {\n    const evalHook = props.evaluable\n    const evalPojo = evalHook.evaluablePojo\n    const [{ isHovering }, drop] = useDrop({\n        accept: \"Attribute\",\n        drop(item, monitor) {\n            if (!props.isEditing) return\n            const didDrop = monitor.didDrop()\n            handleDrop(item.options)\n        },\n        collect: monitor => ({\n            isHovering: monitor.isOver({shallow:true})\n        })\n    })\n\n    function showError() {\n        window.alert(evalPojo.errordetail)\n    }\n\n    function handleDrop(attr) {\n        evalHook.setAttribute(attr)\n    }\n\n    if (!evalPojo) return null\n\n    let label \n    if (evalPojo.op == \"subjectHasAttribute\") {\n        label = \"Subject Has Attribute\"\n    } else if (evalPojo.op == \"resourceHasAttribute\") {\n        label = \"Resource Has Attribute\"\n    }\n\n    let editingIcons = null\n    if (props.isEditing) {\n        editingIcons = (\n            <div className=\"evaluable-icons\">\n                <i className=\"fa fa-trash-o\" onClick={evalHook.setEmpty}>del</i>\n                {evalPojo.error ? <i className=\"fa fa-exclamation-triangle\" onClick={showError}>err</i> : null}\n            </div>\n        )\n    }\n\n    let content = (<div ref={drop} className={`empty-placeholder ${isHovering ? \"hover\" : \"\"}`}>\n        <span className=\"eval-detail-label\">You must put an attribute here!</span>\n    </div>)\n    if (evalPojo.attribute != null) {\n        content = <span ref={drop} className={`eval-detail-label ${isHovering ? \"hover\" : \"\"}`}>{evalPojo.attribute.attribute_id}</span>\n    }\n\n    return (\n        <div className=\"evaluable-container\">\n            <span className=\"eval-op-label\">{label}{editingIcons}</span>\n            {content}\n        </div>\n    )\n}\n\nexport default HasAttributeComponent","import React, { useState, useEffect } from 'react'\n\nimport useEvaluable from '../hooks/useEvaluable'\n\nfunction ValueComponent(props) {\n    const evalHook = props.evaluable\n    const evalPojo = evalHook.evaluablePojo\n    const [value, setValue] = useState(evalPojo.value)\n\n    function keypress(e) {\n        if (e.key === 'Enter') {\n            console.log(\"enter pressed\")\n            evalHook.setValue(value)\n        }\n    }\n\n    function handleDTChange(e) {\n        evalHook.setDataType(e.target.value)\n    }\n\n    function showError() {\n        window.alert(evalPojo.errordetail)\n    }\n\n    useEffect(() => {\n        console.log(evalPojo.value)\n    }, [evalPojo])\n\n    if (!evalPojo) return null\n\n    let editingIcons = null\n    if (props.isEditing) {\n        editingIcons = (\n            <div className=\"evaluable-icons\">\n                <i className=\"fa fa-trash-o\" onClick={evalHook.setEmpty}>del</i>\n                {evalPojo.error ? <i className=\"fa fa-exclamation-triangle\" onClick={showError}>err</i> : null}\n            </div>\n        )\n    }\n\n    let content = (\n        <>\n        <span className=\"eval-detail-label\">{evalPojo.value}</span>\n        <span className=\"eval-detail-label\">{evalPojo.data_type}</span>\n        </>\n    )\n    if (props.isEditing) {\n        content = (\n            <>\n            <input placeholder=\"Value\" value={value} onChange={(e) => setValue(e.target.value)} onKeyDown={keypress}></input>\n            <select value={evalPojo.data_type} onChange={handleDTChange}>\n                <option value={'string'}>String</option>\n                <option value={'boolean'}>Boolean</option>\n                <option value={'integer'}>Integer</option>\n            </select>\n            </>\n        )\n    }\n\n    return (\n        <div className=\"evaluable-container\">\n            <span className=\"eval-op-label\">Value{editingIcons}</span>\n            {content}\n        </div>\n    )\n}\n\nexport default ValueComponent","import React, { useState, useEffect } from 'react'\nimport '../styles/Evaluable.css'\n\nimport useEvaluable from '../hooks/useEvaluable'\nimport EvaluableComponent from './EvaluableComponent'\n\nfunction ComparatorComponent(props) {\n    const evalHook = props.evaluable\n    const evalPojo = evalHook.evaluablePojo\n    const [isEditing, setIsEditing] = useState(props.isEditing)\n\n    useEffect(() => {\n        setIsEditing(props.isEditing)\n    }, [props.isEditing])\n\n    function showError() {\n        window.alert(evalPojo.errordetail)\n    }\n\n\n    if (!evalPojo) return null\n\n    let label\n    if (evalPojo.comparator.op == \"equalTo\") {\n        label = \"Equal To\"\n    } else if (evalPojo.comparator.op == \"lessThan\") {\n        label = \"Less Than\"\n    }\n\n    let editingIcons = null\n    if (isEditing) {\n        editingIcons = (\n            <div className=\"evaluable-icons\">\n                <i className=\"fa fa-trash-o\" onClick={evalHook.setEmpty}>del</i>\n                {evalPojo.error ? <i className=\"fa fa-exclamation-triangle\" onClick={showError}>err</i> : null}\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"evaluable-container\">\n            <div className=\"eval-comparator-param1\">\n                <EvaluableComponent evaluable={evalPojo.comparator.param1} isEditing={isEditing}/>\n            </div>\n            <span className=\"eval-op-label comparator\">{label}{editingIcons}</span>\n            <div className=\"eval-comparator-param2\">\n                <EvaluableComponent evaluable={evalPojo.comparator.param2} isEditing={isEditing}/>\n            </div>\n        </div>\n    )\n}\n\nexport default ComparatorComponent","import React, {useState, useEffect} from 'react'\nimport { useDrop } from 'react-dnd'\nimport '../styles/Evaluable.css'\n\nimport useEvaluable from '../hooks/useEvaluable'\n\nfunction ActionTypeComponent(props) {\n    const evalHook = props.evaluable\n    const evalPojo = evalHook.evaluablePojo\n    \n    const [{ isHovering }, drop] = useDrop({\n        accept: \"Action\",\n        drop(item, monitor) {\n            if (!props.isEditing) return\n            const didDrop = monitor.didDrop()\n            handleDrop(item.options)\n        },\n        collect: monitor => ({\n            isHovering: monitor.isOver({shallow:true})\n        })\n    })\n\n    function showError() {\n        window.alert(evalPojo.errordetail)\n    }\n\n\n    function handleDrop(options) {\n        evalHook.setAction(options.type)\n    }\n\n    if (!evalPojo) return null\n\n    let content = (<div ref={drop} className={`empty-placeholder ${isHovering ? \"hover\" : \"\"}`}>\n        <span className=\"eval-detail-label\">You must put an action here!</span>\n    </div>)\n    if (evalPojo.action != null) {\n        content = <span ref={drop} className={`eval-detail-label ${isHovering ? \"hover\" : \"\"}`}>{evalPojo.action}</span>\n    }\n\n    let editingIcons = null\n    if (props.isEditing) {\n        editingIcons = (\n            <div className=\"evaluable-icons\">\n                <i className=\"fa fa-trash-o\" onClick={evalHook.setEmpty}>del</i>\n                {evalPojo.error ? <i className=\"fa fa-exclamation-triangle\" onClick={showError}>err</i> : null}\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"evaluable-container\">\n            <span className=\"eval-op-label\">Action Type {editingIcons}</span>\n            {content}\n        </div>\n    )\n}\n\nexport default ActionTypeComponent","import React, {useEffect, useState} from 'react'\n\nimport useEvaluable from '../hooks/useEvaluable'\n\nimport EmptyComponent from './EmptyComponent'\nimport CombinatorComponent from './CombinatorComponent'\nimport AttributeComponent from './AttributeComponent'\nimport HasAttributeComponent from './HasAttributeComponent'\nimport ValueComponent from './ValueComponent'\nimport ComparatorComponent from './ComparatorComponent'\nimport ActionTypeComponent from './ActionTypeComponent'\n\n// A higher order component that receives an evaluable object and returns the correct component to visualise it\nfunction EvaluableComponent(props) {\n    let evalHook = useEvaluable(props.evaluable)\n    let [isEditing, setIsEditing] = useState(props.isEditing)\n    \n    useEffect(() => {\n        setIsEditing(props.isEditing)\n    }, [props.isEditing])\n\n    if (evalHook.evaluablePojo.error) {\n        console.log(\"error \" + evalHook.evaluablePojo.errordetail)\n    }\n\n    let finalComponent\n    switch(evalHook.evaluablePojo.op) {\n        case 'empty':\n            finalComponent = <EmptyComponent evaluable={evalHook} isEditing={isEditing}/>\n            break\n        case 'value':\n            finalComponent = <ValueComponent evaluable={evalHook} isEditing={isEditing}/>\n            break\n        case 'environmentAttribute':\n        case 'subjectAttribute':\n        case 'resourceAttribute':\n            finalComponent = <AttributeComponent evaluable={evalHook} isEditing={isEditing}/>\n            break\n        case 'combinator':\n            finalComponent = <CombinatorComponent evaluable={evalHook} isEditing={isEditing}/>\n            break\n        case 'comparator':\n            finalComponent = <ComparatorComponent evaluable={evalHook} isEditing={isEditing}/>\n            break\n        case 'subjectHasAttribute':\n        case 'resourceHasAttribute':\n            finalComponent = <HasAttributeComponent evaluable={evalHook} isEditing={isEditing}/>\n            break\n        case 'actionType':\n            finalComponent = <ActionTypeComponent evaluable={evalHook} isEditing={isEditing} />\n            break\n        default:\n            throw new Error(\"EvaluableComponent could not match this evaluable objects op to a component\")\n    }\n\n    return finalComponent\n}\n\nexport default EvaluableComponent","import React, { useState, useContext, useRef } from 'react'\nimport './styles/ControlPanel.css'\nimport './styles/Evaluable.css'\n\nimport Evaluable from './accesscontrol/syntax/Evaluable'\n\nimport ShadeHeader from './ShadeHeader'\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\nimport EvaluableErrorContext from './hooks/EvaluableErrorContext'\nimport EvaluableComponent from './evaluablecomponents/EvaluableComponent'\nimport useEvaluable from './hooks/useEvaluable';\n\n// function cloneEvaluable(evaluable) {\n//     let newEval = new Evaluable()\n//     newEval._obj_constructor(evaluable.toJson())\n//     return newEval\n// }\n\nfunction EvaluableShade(props) {\n    const context = useContext(PolicyEditorContext)\n    const [isOpen, setIsOpen] = useState(false)\n    const [isEditing, setIsEditing] = useState(false)\n    const [error, setError] = useState(null)\n    const savedReq = useRef(null)\n\n    let errorContext = {\n        error: error\n    }\n\n    function handleEdit(b) {\n        if (b) {\n            savedReq.current = context.request\n            props.setDrawerOpen(true)\n            context.setRequest(null)\n            setIsEditing(true)\n        }\n    }\n\n    function handleSave() {\n        try {\n            let dt = props.evaluable.validate()\n            if (dt != 'boolean') {\n                window.alert(\"Evaluable must evaluate to a boolean at the top level!\")\n                return\n            }\n            setError(null)\n            setIsEditing(false)\n            props.setDrawerOpen(false)\n            context.setRequest(savedReq.current)\n        } catch(err) {\n            window.alert(err.message)\n            setError(err.message)\n        }\n    }\n\n    let shadeContent = (\n        <EvaluableComponent evaluable={props.evaluable} isEditing={isEditing}/>\n    )\n\n    return (\n        <EvaluableErrorContext.Provider value={errorContext}>\n        <div className={isOpen ? \"shade shade-open\" : \"shade shade-closed\"}>\n            <ShadeHeader title={props.title} editable onEdit={handleEdit} isEditing={isEditing} onCollapse={setIsOpen} isOpen={isOpen} onSave={handleSave}/>\n            <div className=\"shade-content\">\n                <div className=\"evaluable-view\">\n                    {isOpen ? shadeContent : null}\n                </div>\n            </div>\n        </div>\n        </EvaluableErrorContext.Provider>\n    )\n}\n\nexport default EvaluableShade\n","import React from 'react'\nimport { useDrag } from 'react-dnd'\nimport '../styles/Evaluable.css'\nimport '../styles/ControlPanel.css'\n\nfunction DraggableComponent(props) {\n    const [, drag] = useDrag({\n        item: {\n            type: props.type,\n            options: props.options\n        }})\n\n    return (\n        <div ref={drag} className=\"draggable-component\">\n            {props.name}\n        </div>\n    )\n}\n\nexport default DraggableComponent","import React, { useRef, useState } from 'react'\nimport { useDrag } from 'react-dnd'\nimport './styles/Evaluable.css'\nimport './styles/ControlPanel.css'\n\nimport * as Constants from './constants/'\nimport DraggableEvaluable from './evaluablecomponents/DraggableEvaluable'\n\nfunction DrawerEvaluables(props) {\n    const evaluables = useRef(Constants.DRAGGABLE_EVALUABLES)\n\n    return (\n        <div className=\"drawer-section\">\n            <div className=\"drawer-section-contents\">\n                {evaluables.current.map(evaluable => {\n                    return <DraggableEvaluable name={evaluable.name} type={evaluable.type} options={evaluable.options} />\n                })}\n            </div>\n        </div>\n    )\n}\n\nexport default DrawerEvaluables","import React, { useRef, useState } from 'react'\nimport { useDrag } from 'react-dnd'\nimport './styles/Evaluable.css'\nimport './styles/ControlPanel.css'\n\nimport * as Constants from './constants/'\nimport DraggableEvaluable from './evaluablecomponents/DraggableEvaluable'\n\nfunction DrawerActions(props) {\n    const actions = useRef(Constants.DRAGGABLE_ACTIONS)\n\n    return (\n        <div className=\"drawer-section\">\n            <div className=\"drawer-section-contents\">\n                {actions.current.map(action => {\n                    return <DraggableEvaluable name={action.name} type={action.type} options={action.options} />\n                })}\n            </div>\n        </div>\n    )\n}\n\nexport default DrawerActions","import React, { useRef, useState, useContext } from 'react'\nimport { useDrag } from 'react-dnd'\nimport './styles/Evaluable.css'\nimport './styles/ControlPanel.css'\n\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\nimport DraggableEvaluable from './evaluablecomponents/DraggableEvaluable'\n\nfunction DrawerAttributes(props) {\n    const context = useContext(PolicyEditorContext)\n    const userDefaultAttributes = context.editorData.userDefaultAttributes\n    const deviceDefaultAttributes = context.editorData.deviceDefaultAttributes\n    const groupCustomAttributes = context.editorData.groupCustomAttributes\n    const environmentDefaultAttributes =\n    context.editorData.environmentDefaultAttributes\n\n    return (\n        <div className=\"drawer-section\">\n            <div className=\"drawer-section-contents\">\n                <div className=\"drawer-header\">\n                    <span>Default User Attributes</span>\n                </div>\n                {userDefaultAttributes.map(attr => {\n                    return <DraggableEvaluable name={attr.attribute_id} type={\"Attribute\"} options={attr} />\n                })}\n                <div className=\"drawer-header\">\n                    <span>Default Device Attributes</span>\n                </div>\n                {deviceDefaultAttributes.map(attr => {\n                    return <DraggableEvaluable name={attr.attribute_id} type={\"Attribute\"} options={attr} />\n                })}\n                <div className=\"drawer-header\">\n                    <span>Environment Attributes</span>\n                </div>\n                {environmentDefaultAttributes.map(attr => {\n                    return <DraggableEvaluable name={attr.attribute_id} type={\"Attribute\"} options={attr} />\n                })}\n                <div className=\"drawer-header\">\n                    <span>Group Custom Attributes</span>\n                </div>\n                {groupCustomAttributes.map(attr => {\n                    return <DraggableEvaluable name={attr.prettyname} type={\"Attribute\"} options={attr} />\n                })}\n            </div>\n        </div>\n    )\n}\n\nexport default DrawerAttributes","import React, { useRef, useState } from 'react'\nimport { useDrag } from 'react-dnd'\nimport './styles/Evaluable.css'\nimport './styles/ControlPanel.css'\n\nimport DrawerEvaluables from './DrawerEvaluables'\nimport DrawerActions from './DrawerActions'\nimport DrawerAttributes from './DrawerAttributes'\n\nfunction EvaluableEditorDrawer(props) {\n    const [selectedTab, setSelectedTab] = useState(\"evaluables\")\n\n    let content = null\n    switch(selectedTab) {\n        case \"evaluables\":\n            content = <DrawerEvaluables />\n            break\n        case \"attributes\":\n            content = <DrawerAttributes />\n            break\n        case \"actions\":\n            content = <DrawerActions />\n            break\n    }\n\n    return (\n        <div className=\"drawer-container\">\n            <ul className=\"nav nav-tabs\">\n                <li className=\"nav-item\">\n                    <a href=\"#\" className=\"nav-link active\" onClick={() => setSelectedTab(\"evaluables\")}>Evaluables</a>\n                </li>\n                <li className=\"nav-item\">\n                    <a href=\"#\" className=\"nav-link active\" onClick={() => setSelectedTab(\"attributes\")}>Attributes</a>\n                </li>\n                <li className=\"nav-item\">\n                    <a href=\"#\" className=\"nav-link active\" onClick={() => setSelectedTab(\"actions\")}>Actions</a>\n                </li>\n            </ul>\n            <div className=\"drawer-contents\">\n                {content}\n            </div>\n        </div>\n    )\n}\n\nexport default EvaluableEditorDrawer","import React, { useState, useEffect, useContext } from 'react'\nimport './styles/ControlPanel.css'\nimport { DndProvider } from 'react-dnd'\nimport HTML5Backend from 'react-dnd-html5-backend'\n\nimport ShadeHeader from './ShadeHeader'\nimport PolicyComponentEditor from './PolicyComponentEditor'\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\nimport RuleComponentEditor from './RuleComponentEditor'\nimport EvaluableShade from './EvaluableShade'\nimport EvaluableEditorDrawer from './EvaluableEditorDrawer'\n\n// This component only exists when a component is selected, can be closed with an x arrow which deselects the component\nfunction SelectedComponentShade(props) {\n    const [isOpen, setIsOpen] = useState(props.isOpen)\n    const context = useContext(PolicyEditorContext)\n    const [drawerOpen, setDrawerOpen] = useState(false)\n\n    function handleRemove() {\n        context.setSelectedComponent(undefined)\n        context.setSelectedPojo(undefined)\n    }\n\n    let shadeContent = null\n    let evaluableShades = null\n    if (context.selectedPojo) {\n        let propNames = Object.getOwnPropertyNames(context.selectedPojo)\n        if (propNames.includes('children')) {\n            // This is a policy object\n            shadeContent=<PolicyComponentEditor />\n            evaluableShades = <EvaluableShade title={\"Target\"} evaluable={context.selectedPojo.target} setDrawerOpen={setDrawerOpen}/>\n        } else if (propNames.includes('condition')) {\n            // Selected compone tis  a rule\n            shadeContent=<RuleComponentEditor />\n            evaluableShades = (\n                <>\n                <EvaluableShade title={\"Target\"} evaluable={context.selectedPojo.target} setDrawerOpen={setDrawerOpen}/>\n                <EvaluableShade title={\"Condition\"} evaluable={context.selectedPojo.condition} setDrawerOpen={setDrawerOpen}/>\n                </>\n            )\n        }\n    }\n\n    \n    \n    \n\n    return (\n        <>\n        <DndProvider backend={HTML5Backend}>\n            <div className={isOpen ? \"shade shade-open\" : \"shade shade-closed\"}>\n                <ShadeHeader title={\"Selected Component\"} removeable onCollapse={setIsOpen} isOpen={isOpen} onRemove={handleRemove}/>\n                <div className=\"shade-content\">\n                    {isOpen ? shadeContent : null}\n                </div>\n            </div>\n            {evaluableShades}\n            {drawerOpen ? <EvaluableEditorDrawer /> : null}\n        </DndProvider>\n        </>\n    )\n\n    \n}\n\nexport default SelectedComponentShade","import React, { useState, useEffect, useContext } from 'react'\nimport './styles/ControlPanel.css'\n\nimport ShadeHeader from './ShadeHeader'\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\n// This component only exists when a component is selected, can be closed with an x arrow which deselects the component\nfunction GroupUsersShade(props) {\n    const context = useContext(PolicyEditorContext)\n    const [isOpen, setIsOpen] = useState(props.isOpen)\n    const [selectedUser, setSelectedUser] = useState(undefined)\n\n    useEffect(() => {\n        props.selectUser(selectedUser)\n    }, [selectedUser])\n\n    let shadeContent\n    if (isOpen) {\n        shadeContent = (\n            <div className=\"shade-content\">\n                <table class=\"table table-hover\">\n                    <tbody>\n                        {context.editorData.users.map(user => {\n                            return <tr onClick={()=>setSelectedUser(user)}>\n                                <td>{user.user.name} {selectedUser ? selectedUser.user.id == user.user.id ? \"(Selected)\" : null : null}</td>\n                            </tr>\n                        })}\n                    </tbody>\n                </table>\n            </div>\n        )\n    }\n\n    return (\n        <div className={isOpen ? \"shade shade-open\" : \"shade shade-closed\"}>\n            <ShadeHeader title={`Group Users ${selectedUser ? \"Selected: \" + selectedUser.user.name : ''}`} onCollapse={setIsOpen} isOpen={isOpen}/>\n            {shadeContent}\n        </div>\n    )\n}\n\nexport default GroupUsersShade","import React, { useState, useEffect, useContext } from 'react'\nimport './styles/ControlPanel.css'\n\nimport ShadeHeader from './ShadeHeader'\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\n// This component only exists when a component is selected, can be closed with an x arrow which deselects the component\nfunction GroupDevicesShade(props) {\n    const context = useContext(PolicyEditorContext)\n    const [isOpen, setIsOpen] = useState(props.isOpen)\n    const [selectedDevice, setSelectedDevice] = useState(undefined)\n    \n\n    useEffect(() => {\n        props.selectDevice(selectedDevice)\n    }, [selectedDevice])\n\n    let shadeContent\n    if (isOpen) {\n        shadeContent = (\n            <div className=\"shade-content\">\n                <table class=\"table table-hover\">\n                    <tbody>\n                        {context.editorData.devices.map(device=> {\n                            return <tr onClick={()=>setSelectedDevice(device)}>\n                                <td>{device.device.name} {selectedDevice ? selectedDevice.device.id == device.device.id ? \"(Selected)\" : null : null}</td>\n                            </tr>\n                        })}\n                    </tbody>\n                </table>\n            </div>\n        )\n    }\n\n    return (\n        <div className={isOpen ? \"shade shade-open\" : \"shade shade-closed\"}>\n            <ShadeHeader title={`Group Devices ${selectedDevice ? \"Selected: \" + selectedDevice.device.name : ''}`} onCollapse={setIsOpen} isOpen={isOpen}/>\n            {shadeContent}\n        </div>\n    )\n}\n\nexport default GroupDevicesShade","import React, { useState, useEffect, useContext, useRef } from 'react'\n\nimport './styles/ControlPanel.css'\n\nimport ShadeHeader from './ShadeHeader'\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\nfunction EnvironmentShade(props) {\n    const context = useContext(PolicyEditorContext)\n    // const [timeValue, setTimeValue] = useState(props.timeValue)\n    // const [dateValue, setDateValue] = useState(props.dateValue)\n    const [isOpen, setIsOpen] = useState(false)\n\n    let shadeContent = null\n    if(isOpen) {\n        shadeContent = (\n        <div className=\"shade-content\">\n            <label htmlFor=\"dateEntry\">Date</label>\n            <input id=\"dateEntry\" value={props.date} onChange={e => props.setDate(e.target.value)}></input>\n            <label htmlFor=\"timeEntry\">Time</label>\n            <input id=\"timeEntry\" value={props.time} onChange={e => props.setTime(e.target.value)}></input>\n        </div>\n        )\n        \n    }\n\n    return (\n        <div className={isOpen ? \"shade shade-open\" : \"shade shade-closed\"}>\n            <ShadeHeader title={`Environment Attributes`} onCollapse={setIsOpen} isOpen={isOpen}/>\n            {shadeContent}\n        </div>\n    )\n}\n\nexport default EnvironmentShade","import React, { useState, useContext, useEffect, useRef } from 'react'\nimport './styles/ControlPanel.css'\nimport Request from './accesscontrol/syntax/Request'\n\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\nimport GroupUsersShade from './GroupUsersShade'\nimport GroupDevicesShade from './GroupDevicesShade'\nimport EnvironmentShade from './EnvironmentShade'\n\nimport * as Constants from './constants/'\n\nfunction RequestBuilder(props) {\n    const context = useContext(PolicyEditorContext)\n    const [selectedUser, setSelectedUser] = useState(undefined)\n    const [selectedDevice, setSelectedDevice] = useState(undefined)\n    const [selectedActionType, setSelectedActionType] = useState(\"\")\n    const envAttributes = context.editorData.environmentDefaultAttributes\n    const dateAttribute = useRef(envAttributes.find(attr => attr.attribute_id == 'env_date'))\n    const timeAttribute = useRef(envAttributes.find(attr => attr.attribute_id == 'env_time'))\n    const [timeValue, setTimeValue] = useState(timeAttribute.current.value)\n    const [dateValue, setDateValue] = useState(dateAttribute.current.value)\n\n    function handleStop() {\n        context.setRequest(null)\n    }\n\n    function handleRun() {\n        if (selectedUser != undefined && selectedDevice != undefined && selectedActionType != \"\" && timeValue != \"\" && dateValue != \"\") {\n            let request = new Request()\n            request.Subject = selectedUser.attributes\n            request.Action.Type = selectedActionType\n            request.Resource = selectedDevice.attributes\n            request.Environment.Attributes = [\n                {\n                    attribute_id: 'env_date',\n                    data_type: 'integer',\n                    value: dateValue\n                },\n                {\n                    attribute_id: 'env_time',\n                    data_type: 'integer',\n                    value: timeValue\n                }\n            ]\n            console.log(request)\n            context.setRequest(request)\n        }\n    }\n    \n    function handleActionTypeChange(e) {\n        setSelectedActionType(e.target.value)\n    }\n\n    return (\n        <>\n        <div className=\"shade\">\n            <div className=\"shade-header\">\n                <span className=\"title\">Request Builder</span>\n                <div className=\"shade-controls\">\n                    <i className=\"fa fa-stop\" onClick={handleStop}></i>\n                    <i className=\"fa fa-play\" onClick={handleRun}></i>\n                </div>\n            </div>\n            <div className=\"shade-content request-builder\">\n                <span>Selected User: {selectedUser ? selectedUser.user.name : \"None\"}</span>\n                <span>Selected Device: {selectedDevice ? selectedDevice.device.name : \"None\"}</span>\n                <div className=\"form-group\">\n                        <select className=\"form-control form-control-sm\" id=\"actionType\" placeholder=\"Select Action Type\" value={selectedActionType} onChange={handleActionTypeChange}>\n                            <option value=\"\" disabled selected>Select an Action Type</option>\n                            <option value=\"powerControl\">Power Control</option>\n                            <option value=\"config1\">Config Data 1</option>\n                            <option value=\"config2\">Config Data 2</option>\n                        </select>\n                    </div>\n            </div>\n        </div>\n        <GroupUsersShade selectUser={setSelectedUser} />\n        <GroupDevicesShade selectDevice={setSelectedDevice} />\n        <EnvironmentShade setTime={setTimeValue} time={timeValue} setDate={setDateValue} date={dateValue} />\n        </>\n    )\n}\n\nexport default RequestBuilder","import React, { useState, useEffect, useContext } from 'react'\n\nimport SelectedComponentShade from './SelectedComponentShade'\nimport RequestBuilder from './RequestBuilder'\n\nimport './styles/ControlPanel.css'\n\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\nfunction ControlPanel(props) {\n    const context = useContext(PolicyEditorContext)\n \n\n    return (\n        <>\n        <div className=\"controlpanel-top\">\n            {context.selectedComponent != undefined ? <SelectedComponentShade isOpen={true} /> : null}\n        </div>\n        <div className=\"controlpanel-bottom\">\n            <RequestBuilder />\n        </div>\n        </>\n    )\n}\n\nexport default ControlPanel","import axios from 'axios'\nimport React, { useState, useEffect, useRef } from 'react'\nimport LoadingOverlay from 'react-loading-overlay'\nimport { BeatLoader } from 'react-spinners'\nimport './styles/PolicyEditor.css'\nimport Request from './accesscontrol/syntax/Request'\n\nimport Policy from './accesscontrol/syntax/Policy'\n\nimport PolicyStage from './PolicyStage'\nimport ControlPanel from './ControlPanel'\nimport PolicyEditorContext from './hooks/PolicyEditorContext'\n\n// import testPolicy from './accesscontrol/policies/test.json'\n// import testRequest from './accesscontrol/examples/fileowner_example_request.json'\n\nfunction PolicyEditor(props) {\n    const [rootPolicy, setRootPolicy] = useState(undefined)\n    const [loadedRequest, setLoadedRequest] = useState(null)\n    const [selectedComponent, setSelectedComponent] = useState(undefined)\n    const [selectedPojo, setSelectedPojo] = useState(undefined)\n    const [depthLevels, setDepthLevels] = useState(undefined)\n    const [finalDecision, setFinalDecision] = useState(undefined)\n    const [editorData, setEditorData] = useState(undefined)\n\n    // Load the relevant policy from server\n    useEffect(() => {\n        let url = localStorage.getItem('remoteUrl')\n        switch(props.selectedPolicy.type) {\n            case 'device':\n                console.error(\"Getting device policy NYI\")\n            case 'group':\n                let groupid = props.selectedPolicy.data.id\n                axios.get(url+'/users/policies/group/'+groupid, {headers: {'Authorization':props.user.id}})\n                .then(response => {\n                    console.log(response)\n                    if (response.data.status != 'success') {\n                        throw new Error(\"Error getting policy\")\n                    }\n                    return response.data.data\n                })\n                .then(response => {\n                    let policy = new Policy(null)\n                    policy._obj_constructor(response)\n                    let [_, depths] = policy.calculateDepthLevel(0, {})\n                    setDepthLevels(depths)\n                    setRootPolicy(policy)\n                })\n                .catch(err => {throw new Error(err)})\n                axios.get(url+'/users/editor/groupdetails/'+groupid, {headers: {'Authorization': props.user.id}})\n                .then(response => {\n                    if (response.data.status != 'success') {\n                        throw new Error(\"Error getting group details\")\n                    }\n                    return response.data.data\n                })\n                .then(data => setEditorData(data))\n                .catch(err => {throw new Error(err)})\n        }\n    }, [])\n\n    useEffect(() => {\n        if (rootPolicy) {\n            if (loadedRequest != null) {\n                reevaluateRequest()\n            } else {\n                rootPolicy.deactivate()\n                setFinalDecision(undefined)\n            }\n        }  \n    }, [loadedRequest])\n\n    function recalculateDepthLevels() {\n        let [_, depths] = rootPolicy.calculateDepthLevel(0, {})\n        setDepthLevels(depths)\n    }\n\n    function reevaluateRequest() {\n        if (rootPolicy) {\n            if (rootPolicy.isApplicable(loadedRequest)) {\n                setFinalDecision(rootPolicy.evaluate(loadedRequest))\n            } else {\n                rootPolicy.deactivate()\n                setFinalDecision(undefined)\n            }\n        }\n    }\n\n    let context = {\n        selectedComponent: selectedComponent, \n        setSelectedComponent: setSelectedComponent,\n        selectedPojo: selectedPojo,\n        setSelectedPojo: setSelectedPojo,\n        depthLevels: depthLevels,\n        recalculateDepthLevels: recalculateDepthLevels,\n        request: loadedRequest,\n        setRequest: setLoadedRequest,\n        reevaluateRequest: reevaluateRequest,\n        finalDecision: finalDecision,\n        editorData: editorData\n    }\n\n    function toJson() {\n        console.log(JSON.stringify(rootPolicy.toJson(), null, 4))\n    }\n\n    function sendToServer() {\n        let url = localStorage.getItem('remoteUrl')\n        let groupid = props.selectedPolicy.data.id\n        axios.post(url+'/users/policies/group/'+groupid,{data: rootPolicy.toJson()}, {headers: {'Authorization': props.user.id}})\n        .then(response => {\n            console.log(response)\n        })\n        .catch(err => {\n            console.log(err)\n        })\n    }\n\n    if (!rootPolicy || !depthLevels || !editorData) {\n        return (\n            <LoadingOverlay\n                active={true}\n                spinner={<BeatLoader/>}\n                text=\"Loading policy..\">\n                <div style={{height: '100vh', width:'100vh'}}></div>\n            </LoadingOverlay>\n        )\n    }\n\n    if (!depthLevels) return null\n\n    return (\n        <PolicyEditorContext.Provider value={context}>\n            <div className=\"container-fullwidth\">\n                <div className=\"navbar navbar-expand navbar-dark bg-primary\">\n                    <div className=\"container\">\n                        <span className=\"navbar-brand\"><button className=\"btn btn-outline-light btn-sm\">{\"\\u2190 Your policies\"}</button></span>\n                        <div className=\"collapse navbar-collapse\">\n                            <ul className=\"navbar-nav\">\n                                <li className=\"nav-item\">\n                                    <a className=\"nav-link active\">{props.selectedPolicy.data.name}</a>\n                                </li>\n                                <li className=\"nav-item border border-light\">\n                                    <a className=\"nav-link\" onClick={toJson}>toJson (in console)</a>\n                                </li>\n                                <li className=\"nav-item border border-light\">\n                                    <a className=\"nav-link\" onClick={sendToServer}>Save to Server</a>\n                                </li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"diagram-container\">\n                    <PolicyStage policy={rootPolicy} request={loadedRequest} />\n                </div>\n                <div className=\"controlpanel-container\">\n                    <ControlPanel />\n                </div>\n            </div>\n        </PolicyEditorContext.Provider>\n    )\n}\n\nexport default PolicyEditor","import React, { useState } from 'react'\nimport axios from 'axios'\n\nimport LoginScreen from './LoginScreen'\nimport NavigationBar from './NavigationBar'\nimport PolicyList from './PolicyList'\nimport PolicyEditor from './PolicyEditor'\n\nfunction App() {\n  const [loggedInUser, setLoggedInUser] = useState(JSON.parse(localStorage.getItem('user')))\n  const [selectedPolicy, setSelectedPolicy] = useState(null)\n\n  if (!loggedInUser || !localStorage.getItem('remoteUrl')) {\n    return (\n      <div className=\"App\">\n        <LoginScreen setLoggedInUser={setLoggedInUser} />\n      </div>\n    );\n  }\n\n  let pageContent\n  if (!selectedPolicy) {\n      pageContent = <PolicyList user={loggedInUser} setSelectedPolicy={setSelectedPolicy}/>\n  } else {\n      pageContent = <PolicyEditor user={loggedInUser} selectedPolicy={selectedPolicy} setSelectedPolicy={setSelectedPolicy} />\n  }\n\n  return (\n    <div className=\"App\">\n        <NavigationBar setLoggedInUser={setLoggedInUser} />\n        {pageContent}\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport '../node_modules/bootstrap/dist/css/bootstrap.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}