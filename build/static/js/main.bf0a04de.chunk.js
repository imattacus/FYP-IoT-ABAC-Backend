(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{135:function(e,t,a){},16:function(e,t,a){},180:function(e,t,a){},185:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(31),o=a.n(r),l=(a(79),a(1)),c=a(23),s=a.n(c);a(97);var u=function(e){var t,a=Object(n.useState)(""),r=Object(l.a)(a,2),o=r[0],c=r[1],u=Object(n.useState)("http://localhost:3002"),d=Object(l.a)(u,2),m=d[0],v=d[1],b=Object(n.useState)(!1),h=Object(l.a)(b,2),f=h[0],p=h[1],E=Object(n.useState)(""),y=Object(l.a)(E,2),g=y[0],j=y[1];return f&&(t=i.a.createElement("div",{className:"alert alert-danger",role:"alert"},g)),i.a.createElement("div",{className:"container-fluid"},i.a.createElement("div",{className:"row align-items-center vertical-center"},i.a.createElement("div",{className:"col-sm-3"}),i.a.createElement("div",{className:"col-sm-6"},i.a.createElement("div",{className:"jumbotron"},t,i.a.createElement("div",{className:"form-group"},i.a.createElement("label",null,"Username"),i.a.createElement("input",{className:"form-control",placeholder:"Enter your username",value:o,onChange:function(e){return c(e.target.value)}})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",null,"Remote URL"),i.a.createElement("input",{className:"form-control",placeholder:"Enter the hostname of remote server",value:m,onChange:function(e){return v(e.target.value)}})),i.a.createElement("button",{type:"submit",className:"btn btn-primary btn-block",onClick:function(){s.a.post(m+"/users/login",{username:o}).then(function(t){"success"==t.data.status?(localStorage.setItem("remoteUrl",m),localStorage.setItem("user",JSON.stringify(t.data.user)),e.setLoggedInUser(t.data.user)):(j("Connection to remote established, but login details incorrect!"),p(!0))}).catch(function(e){console.log(e),j("Could not connect to remote!"),p(!0)})}},"Sign In"))),i.a.createElement("div",{className:"col-sm-3"})))};var d=function(e){return JSON.parse(localStorage.getItem("user")).name,i.a.createElement("div",null,i.a.createElement("div",{className:"navbar"},i.a.createElement("div",{className:"container"},i.a.createElement("span",{className:"navbar-brand"},"IoT Policy Editor"),i.a.createElement("button",{className:"btn btn-outline-danger",onClick:function(){localStorage.removeItem("user"),e.setLoggedInUser(null)}},"Sign Out"))))};a(98);var m=function(e){var t=Object(n.useState)([]),a=Object(l.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)([]),u=Object(l.a)(c,2),d=u[0],m=u[1];Object(n.useEffect)(function(){s.a.get(localStorage.getItem("remoteUrl")+"/users/policies",{headers:{Authorization:e.user.id}}).then(function(e){o(e.data.groups),m(e.data.devices)}).catch(function(e){return console.log(e)})},[]);var v=null;r.length>0&&(v=i.a.createElement(i.a.Fragment,null,i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"col"},"Groups"),i.a.createElement("th",{scope:"col"},"Filename"))),i.a.createElement("tbody",null,r.map(function(t){return i.a.createElement("tr",{onClick:function(){return e.setSelectedPolicy({type:"group",data:t})}},i.a.createElement("td",{scope:"row"},t.name),i.a.createElement("td",null,"group_",t.id,".json"))}))));var b=null;return d.length>0&&(b=i.a.createElement(i.a.Fragment,null,i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"col"},"Devices"),i.a.createElement("th",{scope:"col"}))),i.a.createElement("tbody",null,d.map(function(t){return i.a.createElement("tr",{onClick:function(){return e.setSelectedPolicy({type:"device",data:t})}},i.a.createElement("td",{scope:"row"},t.name),i.a.createElement("td",null,"device_",t.id,".json"))})))),i.a.createElement("div",{className:"container"},i.a.createElement("div",{className:"row"},i.a.createElement("table",{className:"table table-hover",id:"policyListTable"},v,b)))},v=a(69),b=a.n(v),h=a(70),f=(a(135),a(12)),p=a(13),E=function(){function e(t,a,n){Object(f.a)(this,e),this.attribute_id=t,this.data_type=a,this.value=n}return Object(p.a)(e,[{key:"_obj_constructor",value:function(e){if(!("attribute_id"in e))throw new Error("No attribute_id in attribute.");if(!("data_type"in e))throw new Error("No data_type in attribute.");if(!("value"in e))throw new Error("No value in attribute.");this.attribute_id=e.attribute_id,this.data_type=e.data_type,this.value=e.value}}]),e}(),y=function(){function e(){Object(f.a)(this,e),this.Subject={Attributes:[]},this.Resource={Attributes:[]},this.Action={Type:"unknown",Attributes:[]},this.Environment={Attributes:[]}}return Object(p.a)(e,[{key:"_obj_constructor",value:function(e){if(!("Subject"in e))throw new Error("No Subject in request.");if(!("Resource"in e))throw new Error("No Resource in request.");if(!("Environment"in e))throw new Error("No Environment in request.");if(!("Action"in e))throw new Error("No Action in request.");if(!("Attributes"in e.Subject))throw new Error("No Attributes in request Subject.");if(!("Attributes"in e.Resource))throw new Error("No Attributes in request Resource.");if(!("Attributes"in e.Environment))throw new Error("No Attributes in request Environment.");if(!("Attributes"in e.Action))throw new Error("No Attributes in request Action.");if(!("Type"in e.Action))throw new Error("No Type in request Action.");this.Subject.Attributes=e.Subject.Attributes.map(function(e){return Object.assign(new E,e)}),this.Resource.Attributes=e.Resource.Attributes.map(function(e){return Object.assign(new E,e)}),this.Action.Type=e.Action.Type,this.Action.Attributes=e.Action.Attributes.map(function(e){return Object.assign(new E,e)}),this.Environment.Attributes=e.Environment.Attributes.map(function(e){return Object.assign(new E,e)})}},{key:"getSubjectAttribute",value:function(e){var t=this.Subject.Attributes.find(function(t){return t.attribute_id==e});if(void 0!=t)return t;throw new Error("Could not get attribute "+e+" from the subject in this request")}},{key:"getResourceAttribute",value:function(e){var t=this.Resource.Attributes.find(function(t){return t.attribute_id==e});if(void 0!=t)return t;throw new Error("Could not get attribute "+e+" from the resource in this request")}},{key:"getActionType",value:function(){return this.Action.Type}},{key:"getEnvironmentAttribute",value:function(e){var t=this.Environment.Attributes.find(function(t){return t.attribute_id==e});if(void 0!=t)return t;throw new Error("Could not get attribute "+e+" from the environment in this request")}},{key:"getActionAttribute",value:function(e){return this.Action.Attributes.find(function(t){return t.attribute_id==e})}},{key:"_addSubjectAttribute",value:function(e){this.Subject.Attributes.push(e)}},{key:"_addResourceAttribute",value:function(e){this.Resource.Attributes.push(e)}},{key:"_addActionAttribute",value:function(e){this.Action.Attributes.push(e)}},{key:"_addEnvironmentAttribute",value:function(e){this.Environment.Attributes.push(e)}},{key:"setActionType",value:function(e){this.Action.Type=e}},{key:"populateUserDefaultAttributes",value:function(e,t){var a=this;return new Promise(function(n,i){e.get("SELECT * FROM User WHERE id=?",t,{Promise:Promise}).then(function(e){a._addSubjectAttribute(new E("user_id","integer",e.id)),a._addSubjectAttribute(new E("user_name","string",e.name)),n()}).catch(function(e){return i("Could not get default user attributes from database.")})})}},{key:"populateUserCustomAttributes",value:function(e,t){var a=this;return new Promise(function(n,i){e.all("\n                SELECT ADef.name, ADef.datatype, AVal.value\n                FROM AttributeValue AS AVal\n                JOIN AttributeDef AS ADef\n                ON AVal.attrid = ADef.id\n                WHERE AVal.userid = ?\n            ",t,{Promise:Promise}).then(function(e){e.map(function(e){return a._addSubjectAttribute(new E(e.name,e.datatype,e.value))}),n()}).catch(function(e){i("Could not get user custom attributes from database!")})})}},{key:"populateDeviceDefaultAttributes",value:function(e,t){var a=this;return new Promise(function(n,i){e.get("SELECT * FROM Device WHERE id=?",t,{Promise:Promise}).then(function(e){void 0==e&&i("No such device to get attributes for!"),a._addResourceAttribute(new E("device_id","integer",e.id)),a._addResourceAttribute(new E("device_owner_id","integer",e.ownerid)),n()}).catch(function(e){i("Could not get default device attributes from database.")})})}},{key:"populateDeviceCustomAttributes",value:function(e,t){var a=this;return new Promise(function(n,i){e.all("\n                SELECT ADef.name, ADef.datatype, AVal.value\n                FROM AttributeValue AS AVal\n                JOIN AttributeDef AS ADef\n                ON AVal.attrid = ADef.id\n                WHERE AVal.deviceid = ?\n            ",t,{Promise:Promise}).then(function(e){e.map(function(e){return a._addResourceAttribute(new E(e.name,e.datatype,e.value))}),n()}).catch(function(e){return i("Could not get device custom attributes from database!")})})}},{key:"populateAttributes",value:function(e,t,a){return Promise.all([this.populateUserDefaultAttributes(e,t),this.populateUserCustomAttributes(e,t),this.populateDeviceDefaultAttributes(e,a),this.populateDeviceCustomAttributes(e,a)])}}]),e}(),g=function(){function e(t,a){Object(f.a)(this,e),this.id=t,this.description=a,this.Decision="NotApplicable",this.Obligations=[]}return Object(p.a)(e,[{key:"setDecision",value:function(e){this.Decision=e}},{key:"addObligation",value:function(e){this.Obligations.push(e)}},{key:"setObligations",value:function(e){this.Obligations=e}}]),e}(),j=function(){function e(t,a){Object(f.a)(this,e),this.op=t,this.children=a}return Object(p.a)(e,[{key:"evaluate",value:function(e){switch(this.op){case"anyOf":return this._anyOf(e);case"allOf":return this._allOf(e);default:throw new Error("Cannot evaluate invalid combinator.")}}},{key:"validate",value:function(){try{if(this.children.map(function(e){return e.validate()}).every(function(e){return"boolean"==e}))return"boolean";throw new Error("Combinators must all be booleans")}catch(e){throw e}}},{key:"_anyOf",value:function(e){return this.children.map(function(t){return t.evaluate(e)}).some(function(e){return 1==e})}},{key:"_allOf",value:function(e){return this.children.map(function(t){return t.evaluate(e)}).every(function(e){return 1==e})}},{key:"getObject",value:function(){return{op:this.op,children:this.children}}},{key:"toJson",value:function(){var e=this.children.map(function(e){return e.toJson()});switch(this.op){case"anyOf":return{anyOf:e};case"allOf":return{allOf:e};default:throw new Error("cannot toJson invalid combinator")}}}]),e}(),O=function(){function e(t,a,n){Object(f.a)(this,e),this.op=t,this.param1=a,this.param2=n}return Object(p.a)(e,[{key:"evaluate",value:function(e){switch(this.op){case"equalTo":var t=this.param1.evaluate(e),a=this.param2.evaluate(e);return console.log("EQUALTO: "+t+", "+a),this._equalTo(t,a);case"lessThan":t=this.param1.evaluate(e),a=this.param2.evaluate(e);return console.log("LESSTHAN: "+t+", "+a),this._lessThan(t,a);default:throw new Error("Cannot evaluate invalid comparator.")}}},{key:"validate",value:function(){try{var e=this.param1.validate();if(e!=this.param2.validate())throw new Error("Comparator cannot compare different data types!");if("lessThan"==this.op&&"integer"!=e)throw new Error("Less than only works on integer values");return"boolean"}catch(t){throw t}}},{key:"_equalTo",value:function(e,t){return e==t}},{key:"_lessThan",value:function(e,t){return e<t}},{key:"getObject",value:function(){var e={op:this.op};switch(this.op){case"lessThan":case"equalTo":e.param1=this.param1,e.param2=this.param2;break;default:throw new Error("Could not getObject on invalid Comparator")}return e}},{key:"toJson",value:function(){switch(this.op){case"equalTo":return{comparator:"equalTo",param1:this.param1.toJson(),param2:this.param2.toJson()};default:throw new Error("Cannot toJson invalid comparator")}}}]),e}(),w=function(){function e(){Object(f.a)(this,e),this.op="empty",this.result=null,this.error=!1,this.errordetail=""}return Object(p.a)(e,[{key:"resetToEmpty",value:function(){for(var e in Object.keys(this))delete this[e];this.op="empty",this.result=null,this.error=!1,this.errordetail=""}},{key:"initSubjectHasAttribute",value:function(){this.op="subjectHasAttribute",this.attr=null}},{key:"initResourceHasAttribute",value:function(){this.op="resourceHasAttribute",this.attr=null}},{key:"initSubjectAttribute",value:function(){this.op="subjectAttribute",this.attr=null,this.default_value=new e,this.default_value.initValue()}},{key:"initResourceAttribute",value:function(){this.op="resourceAttribute",this.attr=null,this.default_value=new e,this.default_value.initValue()}},{key:"initEnvironmentAttribute",value:function(){this.op="environmentAttribute",this.attr=null,this.default_value=new e,this.default_value.initValue()}},{key:"initCombinator",value:function(t){this.op="combinator",this.combinator=new j(t,[new e])}},{key:"initComparator",value:function(t){this.op="comparator",this.comparator=new O(t,new e,new e)}},{key:"initValue",value:function(){this.op="value",this.value=null,this.data_type="string"}},{key:"initActionType",value:function(){this.op="actionType",this.action=null}},{key:"_obj_constructor",value:function(t){if(console.log(t),0!=Object.keys(t).length){if("value"in t)return this.op="value",this.value=t.value,void(this.data_type=t.data_type);if("subjectAttribute"in t)return this.op="subjectAttribute",this.attr=t.subjectAttribute,this.default_value=new e,void this.default_value._obj_constructor(t.default_value);if("resourceAttribute"in t)return this.op="resourceAttribute",this.attr=t.resourceAttribute,this.default_value=new e,void this.default_value._obj_constructor(t.default_value);if("environmentAttribute"in t)return this.op="environmentAttribute",this.attr=t.environmentAttribute,this.default_value=new e,void this.default_value._obj_constructor(t.default_value);if("comparator"in t){this.op="comparator";var a=new e;a._obj_constructor(t.param1);var n=new e;return n._obj_constructor(t.param2),void(this.comparator=new O(t.comparator,a,n))}return"allOf"in t?(this.op="combinator",void(this.combinator=new j("allOf",t.allOf.map(function(t){var a=new e;return a._obj_constructor(t),a})))):"anyOf"in t?(this.op="combinator",void(this.combinator=new j("anyOf",t.anyOf.map(function(t){var a=new e;return a._obj_constructor(t),a})))):"subjectHasAttribute"in t?(this.op="subjectHasAttribute",void(this.attr=t.subjectHasAttribute)):"resourceHasAttribute"in t?(this.op="resourceHasAttribute",void(this.attr=t.resourceHasAttribute)):"actionType"in t?(this.op="actionType",void(this.action=t.actionType)):void 0}this.op="empty"}},{key:"setAction",value:function(e){this.action=e}},{key:"evaluate",value:function(e){var t;switch(this.op){case"empty":t=!0;break;case"value":t=this.value;break;case"subjectAttribute":t=this._getSubjectAttribute(e);break;case"resourceAttribute":t=this._getResourceAttribute(e);break;case"environmentAttribute":t=this._getEnvironmentAttribute(e);break;case"combinator":t=this.combinator.evaluate(e);break;case"comparator":t=this.comparator.evaluate(e);break;case"subjectHasAttribute":t=this._subjectHasAttribute(e);break;case"resourceHasAttribute":t=this._resourceHasAttribute(e);break;case"actionType":t=this._actionType(e);break;default:throw new Error("Could not evaluate invalid evaluable.")}return this.result=t,this.result}},{key:"throwError",value:function(e){throw this.error=!0,this.errordetail=e,new Error(e)}},{key:"validate",value:function(){var e;switch(this.error=!1,this.errordetail=null,this.op){case"empty":e="boolean";break;case"value":switch(null==this.value&&this.throwError("value undefined"),null==this.data_type&&this.throwError("No data type specified for value"),this.data_type){case"boolean":"true"!=this.value&&"false"!=this.value&&this.throwError("Invalid value for boolean");break;case"string":break;case"integer":isNaN(this.value)&&this.throwError("Invalid value for integer");break;default:this.throwError("invalid datatype for value")}e=this.data_type;break;case"subjectAttribute":null==this.attr&&this.throwError("missing attribute in subject attribute lookup"),null==this.default_value&&this.throwError("must provide a default attribute for subject attribute lookup");try{var t=this.default_value.validate();this.attr.data_type!=t&&this.throwError("Default value datatype for subject attribute lookup must match the attributes datatype"),e=this.attr.data_type;break}catch(i){throw Error(i)}break;case"resourceAttribute":null==this.attr&&this.throwError("missing attribute in resource attribute lookup"),null==this.default_value&&this.throwError("must provide a default attribute for resource attribute lookup");try{var a=this.default_value.validate();this.attr.data_type!=a&&this.throwError("Default value datatype for resource attribute lookup must match the attributes datatype"),e=this.attr.data_type;break}catch(i){this.throwError("Default value for resource attribute lookup is invalid")}break;case"environmentAttribute":null==this.attr&&this.throwError("missing attribute in resource attribute lookup"),null==this.default_value&&this.throwError("must provide a default attribute for environment attribute lookup");try{var n=this.default_value.validate();this.attr.data_type!=n&&this.throwError("Default value datatype for environment attribute lookup must match the attributes datatype"),e=this.attr.data_type;break}catch(i){throw i}break;case"subjectHasAttribute":case"resourceHasAttribute":null==this.attr&&this.throwError("missing attribute"),e="boolean";break;case"comparator":try{e=this.comparator.validate();break}catch(i){this.throwError(i.message)}case"combinator":try{e=this.combinator.validate();break}catch(i){this.throwError(i.message)}case"actionType":null==this.action&&this.throwError("Action type cannot be null"),e="boolean";break;default:throw new Error("could not validate invalid evaluable")}return e}},{key:"combinatorAddChild",value:function(){this.combinator.children.push(new e)}},{key:"setValue",value:function(e){this.value=e}},{key:"_getSubjectAttribute",value:function(e){try{return e.getSubjectAttribute(this.attr.attribute_id).value}catch(t){return this.default_value.evaluate()}}},{key:"_getResourceAttribute",value:function(e){try{return e.getResourceAttribute(this.attr.attribute_id).value}catch(t){return this.default_value.evaluate()}}},{key:"_getEnvironmentAttribute",value:function(e){try{return e.getEnvironmentAttribute(this.attr.attribute_id).value}catch(t){return this.default_value.evaluate()}}},{key:"_subjectHasAttribute",value:function(e){try{return void 0!=e.getSubjectAttribute(this.attr.attribute_id)}catch(t){return!1}}},{key:"_resourceHasAttribute",value:function(e){try{return void 0!=e.getResourceAttribute(this.attr.attribute_id)}catch(t){return!1}}},{key:"_actionType",value:function(e){return this.action==e.getActionType()}},{key:"getObject",value:function(){var e={op:this.op,result:this.result,error:this.error,errordetail:this.errordetail};switch(this.op){case"empty":break;case"value":e.value=this.value,e.data_type=this.data_type;break;case"subjectAttribute":case"resourceAttribute":case"environmentAttribute":e.attribute=this.attr,e.default_value=this.default_value;break;case"combinator":e.combinator=this.combinator.getObject();break;case"comparator":e.comparator=this.comparator.getObject();break;case"subjectHasAttribute":case"resourceHasAttribute":e.attribute=this.attr;break;case"actionType":e.action=this.action;break;default:throw new Error("Could not getObject of invalid evaluable")}return e}},{key:"toJson",value:function(){switch(this.op){case"empty":return{};case"value":return{value:this.value,data_type:this.data_type};case"subjectAttribute":return{subjectAttribute:this.attr,default_value:this.default_value.toJson()};case"resourceAttribute":return{resourceAttribute:this.attr,default_value:this.default_value.toJson()};case"environmentAttribute":return{environmentAttribute:this.attr,default_value:this.default_value.toJson()};case"combinator":return this.combinator.toJson();case"comparator":return this.comparator.toJson();case"subjectHasAttribute":return{subjectHasAttribute:this.attr};case"resourceHasAttribute":return{resourceHasAttribute:this.attr};case"actionType":return{actionType:this.action};default:throw new Error("Could not toJson invalid evaluable.")}}}]),e}(),A=function(){function e(t){if(Object(f.a)(this,e),null==t)throw new Error("Rule has no parent - but cannot be the root of the policy");this.parent=t,this.isTargetMet=!1,this.isConditionMet=!1,this.finalDecision=void 0}return Object(p.a)(e,[{key:"init",value:function(e){this.id=e,this.name="No Name",this.description="No Description",this.target=new w,this.condition=new w,this.obligations=[],this.effect="Deny",this.depth_level=null}},{key:"_obj_constructor",value:function(e){if(!("id"in e))throw new Error("id not defined in rule object.");if(!("target"in e))throw new Error("target not defined in rule object.");if(!("obligations"in e))throw new Error("obligations not defined in rule object.");if(!("condition"in e))throw new Error("condition not defined in rule object.");if(!("effect"in e))throw new Error("effect not defined in rule object.");return this.name="name"in e?e.name:"No Name",this.description="description"in e?e.description:"No Description",this.id=e.id,this.target=new w,this.target._obj_constructor(e.target),this.condition=new w,this.condition._obj_constructor(e.condition),this.effect=e.effect,this.obligations=e.obligations,this.depth=0,this.depth_level=null,this.id}},{key:"calculateDepthLevel",value:function(e,t){return this.depth_level=e,console.log("Rule "+this.id+" depth_level: "+this.depth_level),t[this.id]=this.depth_level,[e,t]}},{key:"isApplicable",value:function(e){return this.isTargetMet=this.target.evaluate(e),this.isTargetMet}},{key:"conditionMet",value:function(e){return this.isConditionMet=this.condition.evaluate(e),this.isConditionMet}},{key:"evaluate",value:function(e){var t=new g(this.id,this.description);return this.conditionMet(e)&&(t.setDecision(this.effect),t.setObligations(this.obligations)),this.finalDecision=t,this.finalDecision}},{key:"setName",value:function(e){this.name=e}},{key:"setDescription",value:function(e){this.description=e}},{key:"setEffect",value:function(e){this.effect=e}},{key:"deactivate",value:function(){this.isTargetMet=!1,this.isConditionMet=!1,this.finalDecision=void 0}},{key:"moveUpInParent",value:function(){this.parent.moveChildUp(this.id)}},{key:"moveDownInParent",value:function(){this.parent.moveChildDown(this.id)}},{key:"deleteInParent",value:function(){this.parent.deleteChild(this.id)}},{key:"getObject",value:function(){return{id:this.id,name:this.name,description:this.description,obligations:this.obligations,target:this.target,condition:this.condition,effect:this.effect,depth_level:this.depth_level,isTargetMet:this.isTargetMet,isConditionMet:this.isConditionMet,finalDecision:this.finalDecision}}},{key:"toJson",value:function(){var e=this.target.toJson(),t=this.condition.toJson();return{id:this.id,name:this.name,description:this.description,obligations:this.obligations,target:e,condition:t,effect:this.effect}}}]),e}(),k=function(){function e(t,a,n){Object(f.a)(this,e),this.id=t,this.description=a,this.setType(n)}return Object(p.a)(e,[{key:"getType",value:function(){return this.type}},{key:"setType",value:function(e){if(!["denyOverrides","permitOverrides","firstApplicable","permitUnlessDeny","denyUnlessPermit"].includes(e))throw new Error("Invalid combining algorithm type!");this.type=e}},{key:"combine",value:function(e){switch(this.type){case"denyOverrides":return this._denyOverrides(e);case"permitOverrides":return this._permitOverrides(e);case"firstApplicable":return this._firstApplicable(e);case"permitUnlessDeny":return this._permitUnlessDeny(e);case"denyUnlessPermit":return this._denyUnlessPermit(e);default:throw new Error("Could not evaluate invalid algorithm type!")}}},{key:"_denyOverrides",value:function(e){var t=e.find(function(e){return"Deny"==e.Decision});return t||this._firstApplicable(e)}},{key:"_permitOverrides",value:function(e){var t=e.find(function(e){return"Permit"==e.Decision});return t||this._firstApplicable(e)}},{key:"_firstApplicable",value:function(e){var t=e.find(function(e){return"Permit"==e.Decision||"Deny"==e.Decision});return t||new g(this.id,this.description)}},{key:"_permitUnlessDeny",value:function(e){var t=e.find(function(e){return"Deny"==e.Decision});if(t)return t;var a=new g(this.id,this.description);return a.setDecision("Permit"),a}},{key:"_denyUnlessPermit",value:function(e){var t=e.find(function(e){return"Permit"==e.Decision});if(t)return t;var a=new g(this.id,this.description);return a.setDecision("Deny"),a}}]),e}(),N=function(){function e(t){Object(f.a)(this,e),null==t&&(this.isRoot=!0),this.parent=t,this.idCounter=0,this.finalDecision=void 0,this.isActive=!1,this.isTargetMet=!1}return Object(p.a)(e,[{key:"init",value:function(e){this.id=e,this.name="No Name",this.description="No Description",this.target=new w,this.obligations=[],this.algorithm=new k(this.id,this.description,"firstApplicable"),this.children=[],this.depth_level=null}},{key:"_obj_constructor",value:function(t){var a=this;if(console.log("Constructing new AC Policy object"),!("id"in t))throw new Error("id not defined in policy object.");if(!("target"in t))throw new Error("target not defined in policy object.");if(!("obligations"in t))throw new Error("obligations not defined in policy object.");if(!("children"in t))throw new Error("children not defined in policy object.");if(!("algorithm"in t))throw new Error("policy combining algorithm not defined in policy object.");return this.name="name"in t?t.name:"No Name",this.description="description"in t?t.description:"No Description",this.id=t.id,this.target=new w,this.target._obj_constructor(t.target),this.obligations=t.obligations,this.children=t.children.map(function(t){if("condition"in t){var n=new A(a);return n._obj_constructor(t),n}var i=new e(a);return i._obj_constructor(t),i}),this.algorithm=new k(this.id,this.description,t.algorithm),this.depth_level=null,this.idCounter=this.children.length,this.id}},{key:"calculateDepthLevel",value:function(e,t){this.depth_level=e;for(var a=e,n=t,i=0;i<this.children.length;i++){var r=this.children[i].calculateDepthLevel(a+1,n),o=Object(l.a)(r,2);a=o[0],n=o[1]}return t[this.id]=this.depth_level,[a,n]}},{key:"isApplicable",value:function(e){var t=this.target.evaluate(e);return this.isTargetMet=t,t}},{key:"evaluate",value:function(e){this.isActive=!0;var t=[];return this.children.forEach(function(a){a.isApplicable(e)?t.push(a.evaluate(e)):a.deactivate()}),this.finalDecision=this.algorithm.combine(t),console.log(this.id+" final decision is "+this.finalDecision.id),this.finalDecision}},{key:"deactivate",value:function(){this.isActive=!1,this.targetMet=!1,this.finalDecision=void 0,this.children.forEach(function(e){e.deactivate()})}},{key:"setName",value:function(e){this.name=e}},{key:"setDescription",value:function(e){this.description=e}},{key:"setAlgorithm",value:function(e){this.algorithm.setType(e)}},{key:"moveUpInParent",value:function(){null!=this.parent&&this.parent.moveChildUp(this.id)}},{key:"moveDownInParent",value:function(){null!=this.parent&&this.parent.moveChildDown(this.id)}},{key:"deleteInParent",value:function(){null!=this.parent&&this.parent.deleteChild(this.id)}},{key:"moveChildUp",value:function(e){var t=this.children,a=t.findIndex(function(t){return t.id==e});if(0!=a){var n=t.slice(0,a).concat(t.slice(a+1));n.splice(a-1,0,t[a]),this.children=n}}},{key:"moveChildDown",value:function(e){var t=this.children,a=t.findIndex(function(t){return t.id==e});if(a!=t.length-1){var n=t.slice(0,a).concat(t.slice(a+1));n.splice(a+1,0,t[a]),this.children=n}}},{key:"deleteChild",value:function(e){var t=this.children.findIndex(function(t){return t.id==e}),a=this.children.slice(0);a.splice(t,1),this.children=a}},{key:"newChildPolicy",value:function(){var t=new e(this);t.init(this.id+"_"+this.idCounter),this.idCounter++,this.children.push(t)}},{key:"newChildRule",value:function(){var e=new A(this);e.init(this.id+"_"+this.idCounter),this.idCounter++,this.children.push(e)}},{key:"getObject",value:function(){return{id:this.id,name:this.name,description:this.description,obligations:this.obligations,target:this.target,algorithm:this.algorithm,depth_level:this.depth_level,children:this.children,isActive:this.isActive,isTargetMet:this.isTargetMet,finalDecision:this.finalDecision}}},{key:"toJson",value:function(){var e=this.target.toJson(),t=this.children.map(function(e){return e.toJson()});return{id:this.id,name:this.name,description:this.description,obligations:this.obligations,target:e,algorithm:this.algorithm.getType(),children:t}}}]),e}(),C=a(7),_=a(71),D=a.n(_),S=(a(180),50),P=50,x=150,T=50,R="white",L=150,F=50,H="white",q="grey",U="green",M="red",I="grey",J="black",V=x,z=2*T,W="grey",G="black",B=[{name:"Subject Has Attribute",type:"Evaluable",options:{op:"subjectHasAttribute"}},{name:"Resource Has Attribute",type:"Evaluable",options:{op:"resourceHasAttribute"}},{name:"Subject Attribute",type:"Evaluable",options:{op:"subjectAttribute"}},{name:"Resource Attribute",type:"Evaluable",options:{op:"resourceAttribute"}},{name:"Environment Attribute",type:"Evaluable",options:{op:"environmentAttribute"}},{name:"Value",type:"Evaluable",options:{op:"value"}},{name:"All Of",type:"Evaluable",options:{op:"combinator",comOp:"allOf"}},{name:"Any Of",type:"Evaluable",options:{op:"combinator",comOp:"anyOf"}},{name:"Equal To",type:"Evaluable",options:{op:"comparator",comOp:"equalTo"}},{name:"Less Than",type:"Evaluable",options:{op:"comparator",comOp:"lessThan"}},{name:"Action Type",type:"Evaluable",options:{op:"actionType"}}],Y=[{name:"Power Control",type:"Action",options:{type:"powerControl"}},{name:"Config Data 1",type:"Action",options:{type:"config1"}},{name:"Config Data 2",type:"Action",options:{type:"config2"}}];a(63);var K=function(e){var t,a,r,o,c=Object(n.useState)(e.parentActive),s=Object(l.a)(c,2),u=s[0],d=s[1];Object(n.useEffect)(function(){d(e.parentActive)},[e.parentActive]),0!=e.parentPosition.x&&0!=e.parentPosition.y?(t=e.parentPosition.x+x/2,a=e.parentPosition.y+T,r=e.childPosition.x,o=e.childPosition.y+T/2):(t=e.parentPosition.x,a=e.childPosition.y+T/2,r=e.childPosition.x,o=e.childPosition.y+T/2);var m=u?G:W;return i.a.createElement(C.Arrow,{points:[t,a,t,o,r,o],stroke:m,fill:m,pointerLength:10,pointerWidth:10,strokeWidth:2,zIndex:!0})};var Q=function(e){if(!e.decision)return null;var t,a,n,r;0!=e.parentPosition.x&&0!=e.parentPosition.y?(t=e.parentPosition.x+x/2-10,a=e.parentPosition.y+T,n=e.childPosition.x,r=e.childPosition.y+T/2+10):(t=e.parentPosition.x,a=e.childPosition.y+T/2+10,n=e.childPosition.x,r=e.childPosition.y+T/2+10);var o="Permit"==e.decision.Decision?"green":"Deny"==e.decision.Decision?"red":"grey";return i.a.createElement(C.Arrow,{points:[n,r,t,r,t,a],stroke:o,fill:o,pointerLength:10,pointerWidth:10,strokeWidth:2,zIndex:!0})},$=i.a.createContext({selectedComponent:null,setSelectedComponent:function(){},request:null,setRequest:function(){}});var X=function(e){var t=Object(n.useContext)($),a=Object(n.useRef)(e),i=Object(n.useState)(e.getObject()),r=Object(l.a)(i,2),o=r[0],c=r[1],s=Object(n.useState)(e.id),u=Object(l.a)(s,2),d=u[0],m=(u[1],Object(n.useState)(null)),v=Object(l.a)(m,2),b=v[0],h=v[1],f=Object(n.useState)(void 0),p=Object(l.a)(f,2),E=p[0];return p[1],Object(n.useEffect)(function(){return function(){console.log(a.current.id+" hook unmounted"),a.current=null}},[]),Object(n.useEffect)(function(){t.selectedComponent&&t.selectedComponent.id==d&&t.setSelectedPojo(o)},[t.selectedComponent]),Object(n.useEffect)(function(){t.selectedComponent&&t.selectedComponent.id==d&&t.setSelectedPojo(o)},[o]),Object(n.useEffect)(function(){t.depthLevels&&(h(t.depthLevels[d]*z+S),c(a.current.getObject()))},[t.depthLevels]),Object(n.useEffect)(function(){c(a.current.getObject())},[t.finalDecision]),{id:d,rulePojo:o,ruleObj:a.current,setName:function(e){a.current.setName(e),c(a.current.getObject())},setDescription:function(e){a.current.setDescription(e),c(a.current.getObject())},setEffect:function(e){a.current.setEffect(e),c(a.current.getObject()),t.reevaluateRequest()},depthLevel:b,moveUp:function(){a.current.moveUpInParent(),t.recalculateDepthLevels(),t.reevaluateRequest()},moveDown:function(){a.current.moveDownInParent(),t.recalculateDepthLevels(),t.reevaluateRequest()},destroy:function(){t.setSelectedComponent(void 0),a.current.deleteInParent(),t.recalculateDepthLevels(),t.reevaluateRequest()},finalDecision:E}};var Z=function(e){Object(n.useRef)(e.rule);var t=X(e.rule),a=t.rulePojo,r=Object(n.useState)(e.parentPosition),o=Object(l.a)(r,2),c=o[0],s=o[1],u=Object(n.useState)(null),d=Object(l.a)(u,2),m=d[0],v=d[1],b=Object(n.useState)(e.parentActive),h=Object(l.a)(b,2),f=h[0],p=h[1],E=Object(n.useState)(!1),y=Object(l.a)(E,2),g=y[0],j=y[1],O=Object(n.useContext)($),w=Object(n.useRef)(),A=Object(n.useRef)(),k=!!O.selectedComponent&&O.selectedComponent.id==a.id,N=!!O.finalDecision&&O.finalDecision.id==a.id;if(Object(n.useEffect)(function(){return function(){console.log(a.id+" unmounted")}},[]),Object(n.useEffect)(function(){null!=t.depthLevel&&v({x:e.x,y:t.depthLevel})},[t.depthLevel]),Object(n.useEffect)(function(){null!=m&&(k?w.current.show():w.current.hide())},[k]),Object(n.useEffect)(function(){s(e.parentPosition)},[e.parentPosition]),Object(n.useEffect)(function(){p(e.parentActive)},[e.parentActive]),Object(n.useEffect)(function(){null!=O.request&&a.finalDecision&&e.parentFinalDecision?j(e.parentFinalDecision.id==a.finalDecision.id):j(!1)},[e.parentFinalDecision]),null==m)return null;function _(e){document.body.style.cursor="pointer"}function D(e){document.body.style.cursor="default"}var S=i.a.createElement(K,{parentPosition:c,childPosition:m,parentActive:f}),P=null;g&&(P=i.a.createElement(Q,{parentPosition:c,childPosition:m,decision:a.finalDecision}));var T=f?a.isTargetMet&&a.isConditionMet?"Permit"==a.effect?U:M:q:H,R=k?J:I,V=i.a.createElement(C.Group,{x:m.x,y:m.y,draggable:!0,onDragMove:function(e){v({x:e.target.x(),y:e.target.y()})},onDragEnd:function(e){v({x:e.target.x(),y:e.target.y()})},onClick:function(e){console.log(a.id+" clicked"),O.setSelectedComponent(t)}},i.a.createElement(C.Rect,{x:0,y:0,width:L,height:F,fill:T,stroke:R}),i.a.createElement(C.Text,{x:.1*F,y:.1*F,text:a.name,fontSize:15,fontFamily:"Calibri",fill:"black"}),i.a.createElement(C.Label,{x:L+5,y:F/2,tag:A,visible:N},i.a.createElement(C.Tag,{pointerDirection:"left",pointerWidth:10,pointerHeight:10,fill:O.finalDecision?"Permit"==O.finalDecision.Decision?"green":"Deny"==O.finalDecision.Decision?"red":"grey":"black",lineJoin:"round"}),i.a.createElement(C.Text,{text:"Final decision",fontSize:18,padding:5,fill:"white"})),i.a.createElement(C.Group,{ref:w,visible:!1},i.a.createElement(C.Text,{x:x+5,y:0,fontSize:15,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,onClick:t.moveUp,text:"\uf062"}),i.a.createElement(C.Text,{x:x+5,y:20,fontSize:15,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,text:"\uf063",onClick:t.moveDown}),i.a.createElement(C.Text,{x:x+5,y:40,fontSize:15,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,text:"\uf1f8",onClick:t.destroy})));return i.a.createElement(i.a.Fragment,null,S,P,V)};var ee=function(e){var t=Object(n.useContext)($),a=Object(n.useRef)(e),i=Object(n.useState)(e.getObject()),r=Object(l.a)(i,2),o=r[0],c=r[1],s=Object(n.useState)(e.id),u=Object(l.a)(s,2),d=u[0],m=(u[1],Object(n.useState)(null)),v=Object(l.a)(m,2),b=v[0],h=v[1],f=Object(n.useState)(!1),p=Object(l.a)(f,2),E=p[0],y=p[1];return Object(n.useEffect)(function(){return function(){console.log(a.current.id+" hook unmounted"),a.current=null}},[]),Object(n.useEffect)(function(){t.selectedComponent&&t.selectedComponent.id==d&&t.setSelectedPojo(o)},[t.selectedComponent]),Object(n.useEffect)(function(){t.selectedComponent&&t.selectedComponent.id==d&&t.setSelectedPojo(o)},[o]),Object(n.useEffect)(function(){t.depthLevels&&(0==t.depthLevels[d]&&y(!0),h(t.depthLevels[d]*z+S),c(a.current.getObject()))},[t.depthLevels]),Object(n.useEffect)(function(){c(a.current.getObject())},[t.finalDecision]),{id:d,policyPojo:o,policyObj:a.current,depthLevel:b,isRoot:E,setName:function(e){a.current.setName(e),c(a.current.getObject())},setDescription:function(e){a.current.setDescription(e),c(a.current.getObject())},setAlgorithm:function(e){a.current.setAlgorithm(e),c(a.current.getObject()),t.reevaluateRequest()},moveUp:function(){a.current.moveUpInParent(),t.recalculateDepthLevels(),t.reevaluateRequest()},moveDown:function(){a.current.moveDownInParent(),t.recalculateDepthLevels(),t.reevaluateRequest()},destroy:function(){t.setSelectedComponent(void 0),a.current.deleteInParent(),t.recalculateDepthLevels(),t.reevaluateRequest()},newPolicy:function(){a.current.newChildPolicy(),t.recalculateDepthLevels(),t.reevaluateRequest()},newRule:function(){a.current.newChildRule(),t.recalculateDepthLevels(),t.reevaluateRequest()}}};var te=function e(t){Object(n.useRef)(t.policy);var a=ee(t.policy),r=a.policyPojo,o=Object(n.useState)(t.parentPosition),c=Object(l.a)(o,2),s=c[0],u=c[1],d=Object(n.useState)(t.parentActive),m=Object(l.a)(d,2),v=m[0],b=m[1],h=Object(n.useState)(null),f=Object(l.a)(h,2),p=f[0],E=f[1],y=Object(n.useContext)($),g=Object(n.useRef)(),j=Object(n.useState)(!1),O=Object(l.a)(j,2),w=O[0],A=O[1],k=!!y.selectedComponent&&y.selectedComponent.id==r.id,N=!!y.finalDecision&&y.finalDecision.id==r.id;if(Object(n.useEffect)(function(){null!=a.depthLevel&&E({x:t.x,y:a.depthLevel})},[a.depthLevel]),Object(n.useEffect)(function(){r&&console.log(r.id+" has "+r.children.length+" children "+r.children.map(function(e){return e.id}))},[r]),Object(n.useEffect)(function(){u(t.parentPosition)},[t.parentPosition]),Object(n.useEffect)(function(){b(t.parentActive)},[t.parentActive]),Object(n.useEffect)(function(){null!=y.request&&t.parentFinalDecision&&r.finalDecision?A(t.parentFinalDecision.id==r.finalDecision.id):A(!1)},[t.parentFinalDecision]),null==p)return null;function _(e){document.body.style.cursor="pointer"}function D(e){document.body.style.cursor="default"}var S=i.a.createElement(K,{parentPosition:s,childPosition:p,parentActive:v}),P=null;w&&y.finalDecision&&(P=i.a.createElement(Q,{parentPosition:s,childPosition:p,decision:r.finalDecision}));var H=k?J:I,q=i.a.createElement(C.Group,{x:p.x,y:p.y,draggable:!0,onDragMove:function(e){E({x:e.target.x(),y:e.target.y()})},onDragEnd:function(e){E({x:e.target.x(),y:e.target.y()})},onClick:function(e){console.log(r.id+" selected"),y.setSelectedComponent(a)}},i.a.createElement(C.Rect,{x:0,y:0,width:x,height:T,fill:R,stroke:H}),i.a.createElement(C.Text,{x:.1*T,y:.1*T,text:r.name,fontSize:15,fontFamily:"Calibri",fill:"black"}),i.a.createElement(C.Text,{x:.1*T,y:.5*T,text:"Target met: ".concat(r.isTargetMet),fontSize:15,fontFamily:"Calibri",fill:"black"}),i.a.createElement(C.Label,{x:L+5,y:F/2,visible:N},i.a.createElement(C.Tag,{pointerDirection:"left",pointerWidth:10,pointerHeight:10,fill:y.finalDecision?"Permit"==y.finalDecision.Decision?"green":"Deny"==y.finalDecision.Decision?"red":"grey":"black",lineJoin:"round"}),i.a.createElement(C.Text,{text:"Final decision",fontSize:18,padding:5,fill:"white"})),i.a.createElement(C.Group,{ref:g,visible:k},a.isRoot?null:i.a.createElement(C.Text,{x:x+5,y:0,fontSize:15,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,text:"\uf062",onClick:a.moveUp}),a.isRoot?null:i.a.createElement(C.Text,{x:x+5,y:20,fontSize:15,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,text:"\uf063",onClick:a.moveDown}),a.isRoot?null:i.a.createElement(C.Text,{x:x+5,y:40,fontSize:15,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,text:"\uf1f8",onClick:a.destroy}),i.a.createElement(C.Text,{x:0,y:T+5,fontSize:13,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,text:"\uf067 Policy",onClick:a.newPolicy}),i.a.createElement(C.Text,{x:.6*x,y:T+5,fontSize:13,fontFamily:"FontAwesome",fill:W,onMouseEnter:_,onMouseLeave:D,text:"\uf067 Rule",onClick:a.newRule}))),U=null;return r.children.length>0&&(U=r.children.map(function(a){return"children"in a?i.a.createElement(e,{key:a.id,policy:a,x:t.x+V,parentPosition:p,parentActive:r.isActive,parentFinalDecision:r.finalDecision}):i.a.createElement(Z,{key:a.id,rule:a,x:t.x+V,parentPosition:p,parentActive:r.isActive,parentFinalDecision:r.finalDecision})})),i.a.createElement(i.a.Fragment,null,q,y.finalDecision?P:null,S,U)};var ae=function(e){var t=Object(n.useRef)();return Object(n.useEffect)(function(){new D.a("FontAwesome").load().then(function(){t.current&&t.current.draw()})},[]),null==e.policy?null:i.a.createElement($.Consumer,null,function(a){return i.a.createElement(C.Stage,{width:1e3,height:1e3},i.a.createElement($.Provider,{value:a},i.a.createElement(C.Layer,{ref:t},i.a.createElement(te,{policy:e.policy,x:P,parentPosition:{x:0,y:0},parentActive:!0}))))})},ne=(a(16),a(15)),ie=a(74);var re=function(e){var t=Object(n.useState)(e.isOpen),a=Object(l.a)(t,2),r=a[0],o=a[1];return i.a.createElement("div",{className:"shade-header"},i.a.createElement("span",{className:"title"},e.title),i.a.createElement("div",{className:"shade-controls"},e.editable?e.isEditing?i.a.createElement("i",{className:"fa fa-floppy-o",onClick:function(){return e.onSave()}}):i.a.createElement("i",{id:"edit",class:"fa fa-pencil",onClick:function(){return e.onEdit(!0)}}):null,i.a.createElement("i",{id:"collapse",class:r?"fa fa-caret-down":"fa fa-caret-left",onClick:function(){var t=!r;o(t),e.onCollapse(t)}}),e.removeable?i.a.createElement("i",{id:"close",class:"fa fa-times-circle",onClick:e.onRemove}):null))};var oe=function(e){var t=Object(n.useContext)($),a=t.selectedComponent;return t.selectedPojo?i.a.createElement("div",{className:"policy-editor"},i.a.createElement("form",null,i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"nameEntry",className:"form-control-sm"},"Policy Name"),i.a.createElement("input",{className:"form-control form-control-sm",id:"nameEntry",placeholder:"Policy Name",value:t.selectedPojo.name,onChange:function(e){t.selectedComponent.setName(e.target.value)}})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"descEntry",className:"form-control-sm"},"Policy Description (This will be provided in the response to the user)"),i.a.createElement("input",{className:"form-control form-control-sm",id:"descEntry",placeholder:"Policy Name",value:t.selectedPojo.description,onChange:function(e){t.selectedComponent.setDescription(e.target.value)}})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"algoEntry",className:"form-control-sm"},"Combining Algorithm"),i.a.createElement("select",{className:"form-control form-control-sm",id:"algoEntry",placeholder:"Policy Name",value:t.selectedPojo.algorithm.getType(),onChange:function(e){a.setAlgorithm(e.target.value)}},i.a.createElement("option",{value:"firstApplicable"},"First Applicable"),i.a.createElement("option",{value:"denyOverrides"},"Deny Overrides"),i.a.createElement("option",{value:"permitOverrides"},"Permit Overrides"),i.a.createElement("option",{value:"denyUnlessPermit"},"Deny Unless Permit"),i.a.createElement("option",{value:"permitUnlessDeny"},"Permit Unless Deny"))))):null};var le=function(e){var t=Object(n.useContext)($);return t.selectedPojo?i.a.createElement("div",{className:"policy-editor"},i.a.createElement("form",null,i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"nameEntry",className:"form-control-sm"},"Rule Name"),i.a.createElement("input",{className:"form-control form-control-sm",id:"nameEntry",placeholder:"Rule Name",value:t.selectedPojo.name,onChange:function(e){t.selectedComponent.setName(e.target.value)}})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"descEntry",className:"form-control-sm"},"Rule Description (This will be provided in the response to the user)"),i.a.createElement("input",{className:"form-control form-control-sm",id:"descEntry",placeholder:"Rule Description",value:t.selectedPojo.description,onChange:function(e){t.selectedComponent.setDescription(e.target.value)}})),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"effectEntry",className:"form-control-sm"},"Effect"),i.a.createElement("select",{className:"form-control form-control-sm",id:"effectEntry",placeholder:"Policy Name",value:t.selectedPojo.effect,onChange:function(e){t.selectedComponent.setEffect(e.target.value)}},i.a.createElement("option",{value:"Permit"},"Permit"),i.a.createElement("option",{value:"Deny"},"Deny"))))):null},ce=(a(19),i.a.createContext({error:null}));var se=function(e){Object(n.useContext)($);var t=Object(n.useContext)(ce),a=Object(n.useRef)(e),i=Object(n.useState)(e.getObject()),r=Object(l.a)(i,2),o=r[0],c=r[1];return Object(n.useEffect)(function(){c(a.current.getObject())},[t.error]),{evaluableObj:a.current,evaluablePojo:o,setOp:function(e,t){if("empty"!=a.current.op)throw new Error("Cannot change the op of an existing evaluable");switch(e){case"subjectHasAttribute":a.current.initSubjectHasAttribute();break;case"resourceHasAttribute":a.current.initResourceHasAttribute();break;case"subjectAttribute":a.current.initSubjectAttribute();break;case"resourceAttribute":a.current.initResourceAttribute();break;case"environmentAttribute":a.current.initEnvironmentAttribute();break;case"comparator":a.current.initComparator(t);break;case"combinator":a.current.initCombinator(t);break;case"value":a.current.initValue();break;case"actionType":a.current.initActionType();break;default:throw new Error("Could not set op to invalid op")}c(a.current.getObject())},setEmpty:function(){a.current.resetToEmpty(),c(a.current.getObject())},combinatorAdd:function(){if("combinator"!=a.current.op)throw new Error("Cannot add to non combinator");a.current.combinatorAddChild(),c(a.current.getObject())},setAttribute:function(e){a.current.attr={attribute_id:e.attribute_id,data_type:e.data_type},c(a.current.getObject())},setValue:function(e){if("value"!=a.current.op)throw new Error("cannot set value of non value eval");a.current.setValue(e),c(a.current.getObject())},setDataType:function(e){if("value"!=a.current.op)throw new Error("cannot set value of non value eval");a.current.data_type=e,c(a.current.getObject())},setAction:function(e){a.current.setAction(e),c(a.current.getObject())}}};var ue=function(e){Object(n.useContext)($);var t=e.evaluable,a=Object(ne.d)({accept:"Evaluable",drop:function(a,n){var i,r;e.isEditing&&(n.didDrop(),i=a.options.op,r=a.options.comOp,t.setOp(i,r))},collect:function(e){return{isHovering:e.isOver()}}}),r=Object(l.a)(a,2),o=r[0].isHovering,c=r[1];if("empty"!=t.evaluablePojo.op){var s=t.evaluableObj;return i.a.createElement(pe,{evaluable:s,isEditing:e.isEditing})}return i.a.createElement("div",{ref:c,className:"evaluable-container ".concat(o?"hover":"")},i.a.createElement("span",{className:"eval-op-label"},"Empty"),i.a.createElement("span",{className:"eval-detail-label"},"(Always true)"))};var de=function(e){var t,a=e.evaluable,r=a.evaluablePojo,o=Object(n.useState)(e.isEditing),c=Object(l.a)(o,2),s=c[0],u=c[1];if(Object(n.useEffect)(function(){u(e.isEditing)},[e.isEditing]),!r)return null;if("combinator"!=r.op){var d=a.evaluableObj;return i.a.createElement(pe,{evaluable:d,isEditing:e.isEditing})}"allOf"==r.combinator.op?t="All Of":"anyOf"==r.combinator.op&&(t="Any Of");var m=null;return s&&(m=i.a.createElement("div",{className:"evaluable-icons"},i.a.createElement("i",{className:"fa fa-plus",onClick:a.combinatorAdd},"add"),i.a.createElement("i",{className:"fa fa-trash-o",onClick:a.setEmpty},"del"),r.error?i.a.createElement("i",{className:"fa fa-exclamation-triangle",onClick:function(){window.alert(r.errordetail)}},"err"):null)),i.a.createElement("div",{className:"evaluable-container"},i.a.createElement("span",{className:"eval-op-label combinator"},t,m),r.combinator.children.map(function(e){return i.a.createElement("div",{className:"eval-combinator-child"},i.a.createElement(pe,{evaluable:e,isEditing:s}))}))};var me=function(e){var t,a=e.evaluable,r=a.evaluablePojo,o=Object(n.useState)(e.isEditing),c=Object(l.a)(o,2),s=c[0],u=c[1],d=Object(ne.d)({accept:"Attribute",drop:function(t,n){var i;e.isEditing&&(n.didDrop(),i=t.options,a.setAttribute(i))},collect:function(e){return{isHovering:e.isOver({shallow:!0})}}}),m=Object(l.a)(d,2),v=m[0].isHovering,b=m[1];if(Object(n.useEffect)(function(){u(e.isEditing)},[e.isEditing]),!r)return null;"subjectAttribute"==r.op?t="Subject Attribute":"resourceAttribute"==r.op?t="Resource Attribute":"environmentAttribute"==r.op&&(t="Environment Attribute");var h=i.a.createElement("div",{ref:b,className:"empty-placeholder ".concat(v?"hover":"")},i.a.createElement("span",{className:"eval-detail-label"},"You must put an attribute here!"));null!=r.attribute&&(h=i.a.createElement("span",{ref:b,className:"eval-detail-label ".concat(v?"hover":"")},r.attribute.attribute_id));var f=null;return e.isEditing&&(f=i.a.createElement("div",{className:"evaluable-icons"},i.a.createElement("i",{className:"fa fa-trash-o",onClick:a.setEmpty},"del"),r.error?i.a.createElement("i",{className:"fa fa-exclamation-triangle",onClick:function(){window.alert(r.errordetail)}},"err"):null)),i.a.createElement("div",{className:"evaluable-container"},i.a.createElement("span",{className:"eval-op-label"},t,f),h,i.a.createElement("span",{className:"eval-op-label"},"Defaults To"),i.a.createElement(pe,{evaluable:r.default_value,isEditing:s}))};var ve=function(e){var t,a=e.evaluable,n=a.evaluablePojo,r=Object(ne.d)({accept:"Attribute",drop:function(t,n){var i;e.isEditing&&(n.didDrop(),i=t.options,a.setAttribute(i))},collect:function(e){return{isHovering:e.isOver({shallow:!0})}}}),o=Object(l.a)(r,2),c=o[0].isHovering,s=o[1];if(!n)return null;"subjectHasAttribute"==n.op?t="Subject Has Attribute":"resourceHasAttribute"==n.op&&(t="Resource Has Attribute");var u=null;e.isEditing&&(u=i.a.createElement("div",{className:"evaluable-icons"},i.a.createElement("i",{className:"fa fa-trash-o",onClick:a.setEmpty},"del"),n.error?i.a.createElement("i",{className:"fa fa-exclamation-triangle",onClick:function(){window.alert(n.errordetail)}},"err"):null));var d=i.a.createElement("div",{ref:s,className:"empty-placeholder ".concat(c?"hover":"")},i.a.createElement("span",{className:"eval-detail-label"},"You must put an attribute here!"));return null!=n.attribute&&(d=i.a.createElement("span",{ref:s,className:"eval-detail-label ".concat(c?"hover":"")},n.attribute.attribute_id)),i.a.createElement("div",{className:"evaluable-container"},i.a.createElement("span",{className:"eval-op-label"},t,u),d)};var be=function(e){var t=e.evaluable,a=t.evaluablePojo,r=Object(n.useState)(a.value),o=Object(l.a)(r,2),c=o[0],s=o[1];if(Object(n.useEffect)(function(){console.log(a.value)},[a]),!a)return null;var u=null;e.isEditing&&(u=i.a.createElement("div",{className:"evaluable-icons"},i.a.createElement("i",{className:"fa fa-trash-o",onClick:t.setEmpty},"del"),a.error?i.a.createElement("i",{className:"fa fa-exclamation-triangle",onClick:function(){window.alert(a.errordetail)}},"err"):null));var d=i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"eval-detail-label"},a.value),i.a.createElement("span",{className:"eval-detail-label"},a.data_type));return e.isEditing&&(d=i.a.createElement(i.a.Fragment,null,i.a.createElement("input",{placeholder:"Value",value:c,onChange:function(e){return s(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&(console.log("enter pressed"),t.setValue(c))}}),i.a.createElement("select",{value:a.data_type,onChange:function(e){t.setDataType(e.target.value)}},i.a.createElement("option",{value:"string"},"String"),i.a.createElement("option",{value:"boolean"},"Boolean"),i.a.createElement("option",{value:"integer"},"Integer")))),i.a.createElement("div",{className:"evaluable-container"},i.a.createElement("span",{className:"eval-op-label"},"Value",u),d)};var he=function(e){var t,a=e.evaluable,r=a.evaluablePojo,o=Object(n.useState)(e.isEditing),c=Object(l.a)(o,2),s=c[0],u=c[1];if(Object(n.useEffect)(function(){u(e.isEditing)},[e.isEditing]),!r)return null;"equalTo"==r.comparator.op?t="Equal To":"lessThan"==r.comparator.op&&(t="Less Than");var d=null;return s&&(d=i.a.createElement("div",{className:"evaluable-icons"},i.a.createElement("i",{className:"fa fa-trash-o",onClick:a.setEmpty},"del"),r.error?i.a.createElement("i",{className:"fa fa-exclamation-triangle",onClick:function(){window.alert(r.errordetail)}},"err"):null)),i.a.createElement("div",{className:"evaluable-container"},i.a.createElement("div",{className:"eval-comparator-param1"},i.a.createElement(pe,{evaluable:r.comparator.param1,isEditing:s})),i.a.createElement("span",{className:"eval-op-label comparator"},t,d),i.a.createElement("div",{className:"eval-comparator-param2"},i.a.createElement(pe,{evaluable:r.comparator.param2,isEditing:s})))};var fe=function(e){var t=e.evaluable,a=t.evaluablePojo,n=Object(ne.d)({accept:"Action",drop:function(a,n){var i;e.isEditing&&(n.didDrop(),i=a.options,t.setAction(i.type))},collect:function(e){return{isHovering:e.isOver({shallow:!0})}}}),r=Object(l.a)(n,2),o=r[0].isHovering,c=r[1];if(!a)return null;var s=i.a.createElement("div",{ref:c,className:"empty-placeholder ".concat(o?"hover":"")},i.a.createElement("span",{className:"eval-detail-label"},"You must put an action here!"));null!=a.action&&(s=i.a.createElement("span",{ref:c,className:"eval-detail-label ".concat(o?"hover":"")},a.action));var u=null;return e.isEditing&&(u=i.a.createElement("div",{className:"evaluable-icons"},i.a.createElement("i",{className:"fa fa-trash-o",onClick:t.setEmpty},"del"),a.error?i.a.createElement("i",{className:"fa fa-exclamation-triangle",onClick:function(){window.alert(a.errordetail)}},"err"):null)),i.a.createElement("div",{className:"evaluable-container"},i.a.createElement("span",{className:"eval-op-label"},"Action Type ",u),s)};var pe=function(e){var t,a=se(e.evaluable),r=Object(n.useState)(e.isEditing),o=Object(l.a)(r,2),c=o[0],s=o[1];switch(Object(n.useEffect)(function(){s(e.isEditing)},[e.isEditing]),a.evaluablePojo.error&&console.log("error "+a.evaluablePojo.errordetail),a.evaluablePojo.op){case"empty":t=i.a.createElement(ue,{evaluable:a,isEditing:c});break;case"value":t=i.a.createElement(be,{evaluable:a,isEditing:c});break;case"environmentAttribute":case"subjectAttribute":case"resourceAttribute":t=i.a.createElement(me,{evaluable:a,isEditing:c});break;case"combinator":t=i.a.createElement(de,{evaluable:a,isEditing:c});break;case"comparator":t=i.a.createElement(he,{evaluable:a,isEditing:c});break;case"subjectHasAttribute":case"resourceHasAttribute":t=i.a.createElement(ve,{evaluable:a,isEditing:c});break;case"actionType":t=i.a.createElement(fe,{evaluable:a,isEditing:c});break;default:throw new Error("EvaluableComponent could not match this evaluable objects op to a component")}return t};var Ee=function(e){var t=Object(n.useContext)($),a=Object(n.useState)(!1),r=Object(l.a)(a,2),o=r[0],c=r[1],s=Object(n.useState)(!1),u=Object(l.a)(s,2),d=u[0],m=u[1],v=Object(n.useState)(null),b=Object(l.a)(v,2),h=b[0],f=b[1],p=Object(n.useRef)(null),E={error:h},y=i.a.createElement(pe,{evaluable:e.evaluable,isEditing:d});return i.a.createElement(ce.Provider,{value:E},i.a.createElement("div",{className:o?"shade shade-open":"shade shade-closed"},i.a.createElement(re,{title:e.title,editable:!0,onEdit:function(a){a&&(p.current=t.request,e.setDrawerOpen(!0),t.setRequest(null),m(!0))},isEditing:d,onCollapse:c,isOpen:o,onSave:function(){try{if("boolean"!=e.evaluable.validate())return void window.alert("Evaluable must evaluate to a boolean at the top level!");f(null),m(!1),e.setDrawerOpen(!1),t.setRequest(p.current)}catch(a){window.alert(a.message),f(a.message)}}}),i.a.createElement("div",{className:"shade-content"},i.a.createElement("div",{className:"evaluable-view"},o?y:null))))};var ye=function(e){var t=Object(ne.c)({item:{type:e.type,options:e.options}}),a=Object(l.a)(t,2)[1];return i.a.createElement("div",{ref:a,className:"draggable-component"},e.name)};var ge=function(e){var t=Object(n.useRef)(B);return i.a.createElement("div",{className:"drawer-section"},i.a.createElement("div",{className:"drawer-section-contents"},t.current.map(function(e){return i.a.createElement(ye,{name:e.name,type:e.type,options:e.options})})))};var je=function(e){var t=Object(n.useRef)(Y);return i.a.createElement("div",{className:"drawer-section"},i.a.createElement("div",{className:"drawer-section-contents"},t.current.map(function(e){return i.a.createElement(ye,{name:e.name,type:e.type,options:e.options})})))};var Oe=function(e){var t=Object(n.useContext)($),a=t.editorData.userDefaultAttributes,r=t.editorData.deviceDefaultAttributes,o=t.editorData.groupCustomAttributes,l=t.editorData.environmentDefaultAttributes;return i.a.createElement("div",{className:"drawer-section"},i.a.createElement("div",{className:"drawer-section-contents"},i.a.createElement("div",{className:"drawer-header"},i.a.createElement("span",null,"Default User Attributes")),a.map(function(e){return i.a.createElement(ye,{name:e.attribute_id,type:"Attribute",options:e})}),i.a.createElement("div",{className:"drawer-header"},i.a.createElement("span",null,"Default Device Attributes")),r.map(function(e){return i.a.createElement(ye,{name:e.attribute_id,type:"Attribute",options:e})}),i.a.createElement("div",{className:"drawer-header"},i.a.createElement("span",null,"Environment Attributes")),l.map(function(e){return i.a.createElement(ye,{name:e.attribute_id,type:"Attribute",options:e})}),i.a.createElement("div",{className:"drawer-header"},i.a.createElement("span",null,"Group Custom Attributes")),o.map(function(e){return i.a.createElement(ye,{name:e.prettyname,type:"Attribute",options:e})})))};var we=function(e){var t=Object(n.useState)("evaluables"),a=Object(l.a)(t,2),r=a[0],o=a[1],c=null;switch(r){case"evaluables":c=i.a.createElement(ge,null);break;case"attributes":c=i.a.createElement(Oe,null);break;case"actions":c=i.a.createElement(je,null)}return i.a.createElement("div",{className:"drawer-container"},i.a.createElement("ul",{className:"nav nav-tabs"},i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{href:"#",className:"nav-link active",onClick:function(){return o("evaluables")}},"Evaluables")),i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{href:"#",className:"nav-link active",onClick:function(){return o("attributes")}},"Attributes")),i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{href:"#",className:"nav-link active",onClick:function(){return o("actions")}},"Actions"))),i.a.createElement("div",{className:"drawer-contents"},c))};var Ae=function(e){var t=Object(n.useState)(e.isOpen),a=Object(l.a)(t,2),r=a[0],o=a[1],c=Object(n.useContext)($),s=Object(n.useState)(!1),u=Object(l.a)(s,2),d=u[0],m=u[1],v=null,b=null;if(c.selectedPojo){var h=Object.getOwnPropertyNames(c.selectedPojo);h.includes("children")?(v=i.a.createElement(oe,null),b=i.a.createElement(Ee,{title:"Target",evaluable:c.selectedPojo.target,setDrawerOpen:m})):h.includes("condition")&&(v=i.a.createElement(le,null),b=i.a.createElement(i.a.Fragment,null,i.a.createElement(Ee,{title:"Target",evaluable:c.selectedPojo.target,setDrawerOpen:m}),i.a.createElement(Ee,{title:"Condition",evaluable:c.selectedPojo.condition,setDrawerOpen:m})))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(ne.b,{backend:ie.a},i.a.createElement("div",{className:r?"shade shade-open":"shade shade-closed"},i.a.createElement(re,{title:"Selected Component",removeable:!0,onCollapse:o,isOpen:r,onRemove:function(){c.setSelectedComponent(void 0),c.setSelectedPojo(void 0)}}),i.a.createElement("div",{className:"shade-content"},r?v:null)),b,d?i.a.createElement(we,null):null))};var ke=function(e){var t,a=Object(n.useContext)($),r=Object(n.useState)(e.isOpen),o=Object(l.a)(r,2),c=o[0],s=o[1],u=Object(n.useState)(void 0),d=Object(l.a)(u,2),m=d[0],v=d[1];return Object(n.useEffect)(function(){e.selectUser(m)},[m]),c&&(t=i.a.createElement("div",{className:"shade-content"},i.a.createElement("table",{class:"table table-hover"},i.a.createElement("tbody",null,a.editorData.users.map(function(e){return i.a.createElement("tr",{onClick:function(){return v(e)}},i.a.createElement("td",null,e.user.name," ",m&&m.user.id==e.user.id?"(Selected)":null))}))))),i.a.createElement("div",{className:c?"shade shade-open":"shade shade-closed"},i.a.createElement(re,{title:"Group Users ".concat(m?"Selected: "+m.user.name:""),onCollapse:s,isOpen:c}),t)};var Ne=function(e){var t,a=Object(n.useContext)($),r=Object(n.useState)(e.isOpen),o=Object(l.a)(r,2),c=o[0],s=o[1],u=Object(n.useState)(void 0),d=Object(l.a)(u,2),m=d[0],v=d[1];return Object(n.useEffect)(function(){e.selectDevice(m)},[m]),c&&(t=i.a.createElement("div",{className:"shade-content"},i.a.createElement("table",{class:"table table-hover"},i.a.createElement("tbody",null,a.editorData.devices.map(function(e){return i.a.createElement("tr",{onClick:function(){return v(e)}},i.a.createElement("td",null,e.device.name," ",m&&m.device.id==e.device.id?"(Selected)":null))}))))),i.a.createElement("div",{className:c?"shade shade-open":"shade shade-closed"},i.a.createElement(re,{title:"Group Devices ".concat(m?"Selected: "+m.device.name:""),onCollapse:s,isOpen:c}),t)};var Ce=function(e){Object(n.useContext)($);var t=Object(n.useState)(!1),a=Object(l.a)(t,2),r=a[0],o=a[1],c=null;return r&&(c=i.a.createElement("div",{className:"shade-content"},i.a.createElement("label",{htmlFor:"dateEntry"},"Date"),i.a.createElement("input",{id:"dateEntry",value:e.date,onChange:function(t){return e.setDate(t.target.value)}}),i.a.createElement("label",{htmlFor:"timeEntry"},"Time"),i.a.createElement("input",{id:"timeEntry",value:e.time,onChange:function(t){return e.setTime(t.target.value)}}))),i.a.createElement("div",{className:r?"shade shade-open":"shade shade-closed"},i.a.createElement(re,{title:"Environment Attributes",onCollapse:o,isOpen:r}),c)};var _e=function(e){var t=Object(n.useContext)($),a=Object(n.useState)(void 0),r=Object(l.a)(a,2),o=r[0],c=r[1],s=Object(n.useState)(void 0),u=Object(l.a)(s,2),d=u[0],m=u[1],v=Object(n.useState)(""),b=Object(l.a)(v,2),h=b[0],f=b[1],p=t.editorData.environmentDefaultAttributes,E=Object(n.useRef)(p.find(function(e){return"env_date"==e.attribute_id})),g=Object(n.useRef)(p.find(function(e){return"env_time"==e.attribute_id})),j=Object(n.useState)(g.current.value),O=Object(l.a)(j,2),w=O[0],A=O[1],k=Object(n.useState)(E.current.value),N=Object(l.a)(k,2),C=N[0],_=N[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"shade"},i.a.createElement("div",{className:"shade-header"},i.a.createElement("span",{className:"title"},"Request Builder"),i.a.createElement("div",{className:"shade-controls"},i.a.createElement("i",{className:"fa fa-stop",onClick:function(){t.setRequest(null)}}),i.a.createElement("i",{className:"fa fa-play",onClick:function(){if(void 0!=o&&void 0!=d&&""!=h&&""!=w&&""!=C){var e=new y;e.Subject=o.attributes,e.Action.Type=h,e.Resource=d.attributes,e.Environment.Attributes=[{attribute_id:"env_date",data_type:"integer",value:C},{attribute_id:"env_time",data_type:"integer",value:w}],console.log(e),t.setRequest(e)}}}))),i.a.createElement("div",{className:"shade-content request-builder"},i.a.createElement("span",null,"Selected User: ",o?o.user.name:"None"),i.a.createElement("span",null,"Selected Device: ",d?d.device.name:"None"),i.a.createElement("div",{className:"form-group"},i.a.createElement("select",{className:"form-control form-control-sm",id:"actionType",placeholder:"Select Action Type",value:h,onChange:function(e){f(e.target.value)}},i.a.createElement("option",{value:"",disabled:!0,selected:!0},"Select an Action Type"),i.a.createElement("option",{value:"powerControl"},"Power Control"),i.a.createElement("option",{value:"config1"},"Config Data 1"),i.a.createElement("option",{value:"config2"},"Config Data 2"))))),i.a.createElement(ke,{selectUser:c}),i.a.createElement(Ne,{selectDevice:m}),i.a.createElement(Ce,{setTime:A,time:w,setDate:_,date:C}))};var De=function(e){var t=Object(n.useContext)($);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"controlpanel-top"},void 0!=t.selectedComponent?i.a.createElement(Ae,{isOpen:!0}):null),i.a.createElement("div",{className:"controlpanel-bottom"},i.a.createElement(_e,null)))};var Se=function(e){var t=Object(n.useState)(void 0),a=Object(l.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(null),u=Object(l.a)(c,2),d=u[0],m=u[1],v=Object(n.useState)(void 0),f=Object(l.a)(v,2),p=f[0],E=f[1],y=Object(n.useState)(void 0),g=Object(l.a)(y,2),j=g[0],O=g[1],w=Object(n.useState)(void 0),A=Object(l.a)(w,2),k=A[0],C=A[1],_=Object(n.useState)(void 0),D=Object(l.a)(_,2),S=D[0],P=D[1],x=Object(n.useState)(void 0),T=Object(l.a)(x,2),R=T[0],L=T[1];function F(){r&&(r.isApplicable(d)?P(r.evaluate(d)):(r.deactivate(),P(void 0)))}Object(n.useEffect)(function(){var t=localStorage.getItem("remoteUrl");switch(e.selectedPolicy.type){case"device":console.error("Getting device policy NYI");case"group":var a=e.selectedPolicy.data.id;s.a.get(t+"/users/policies/group/"+a,{headers:{Authorization:e.user.id}}).then(function(e){if(console.log(e),"success"!=e.data.status)throw new Error("Error getting policy");return e.data.data}).then(function(e){var t=new N(null);t._obj_constructor(e);var a=t.calculateDepthLevel(0,{}),n=Object(l.a)(a,2),i=(n[0],n[1]);C(i),o(t)}).catch(function(e){throw new Error(e)}),s.a.get(t+"/users/editor/groupdetails/"+a,{headers:{Authorization:e.user.id}}).then(function(e){if("success"!=e.data.status)throw new Error("Error getting group details");return e.data.data}).then(function(e){return L(e)}).catch(function(e){throw new Error(e)})}},[]),Object(n.useEffect)(function(){r&&(null!=d?F():(r.deactivate(),P(void 0)))},[d]);var H={selectedComponent:p,setSelectedComponent:E,selectedPojo:j,setSelectedPojo:O,depthLevels:k,recalculateDepthLevels:function(){var e=r.calculateDepthLevel(0,{}),t=Object(l.a)(e,2),a=(t[0],t[1]);C(a)},request:d,setRequest:m,reevaluateRequest:F,finalDecision:S,editorData:R};return r&&k&&R?k?i.a.createElement($.Provider,{value:H},i.a.createElement("div",{className:"container-fullwidth"},i.a.createElement("div",{className:"navbar navbar-expand navbar-dark bg-primary"},i.a.createElement("div",{className:"container"},i.a.createElement("span",{className:"navbar-brand"},i.a.createElement("button",{className:"btn btn-outline-light btn-sm"},"\u2190 Your policies")),i.a.createElement("div",{className:"collapse navbar-collapse"},i.a.createElement("ul",{className:"navbar-nav"},i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{className:"nav-link active"},e.selectedPolicy.data.name)),i.a.createElement("li",{className:"nav-item border border-light"},i.a.createElement("a",{className:"nav-link",onClick:function(){console.log(JSON.stringify(r.toJson(),null,4))}},"toJson (in console)")),i.a.createElement("li",{className:"nav-item border border-light"},i.a.createElement("a",{className:"nav-link",onClick:function(){var t=localStorage.getItem("remoteUrl"),a=e.selectedPolicy.data.id;s.a.post(t+"/users/policies/group/"+a,{data:r.toJson()},{headers:{Authorization:e.user.id}}).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}},"Save to Server")))))),i.a.createElement("div",{className:"diagram-container"},i.a.createElement(ae,{policy:r,request:d})),i.a.createElement("div",{className:"controlpanel-container"},i.a.createElement(De,null)))):null:i.a.createElement(b.a,{active:!0,spinner:i.a.createElement(h.BeatLoader,null),text:"Loading policy.."},i.a.createElement("div",{style:{height:"100vh",width:"100vh"}}))};var Pe=function(){var e,t=Object(n.useState)(JSON.parse(localStorage.getItem("user"))),a=Object(l.a)(t,2),r=a[0],o=a[1],c=Object(n.useState)(null),s=Object(l.a)(c,2),v=s[0],b=s[1];return r&&localStorage.getItem("remoteUrl")?(e=v?i.a.createElement(Se,{user:r,selectedPolicy:v,setSelectedPolicy:b}):i.a.createElement(m,{user:r,setSelectedPolicy:b}),i.a.createElement("div",{className:"App"},i.a.createElement(d,{setLoggedInUser:o}),e)):i.a.createElement("div",{className:"App"},i.a.createElement(u,{setLoggedInUser:o}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(Pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},19:function(e,t,a){},75:function(e,t,a){e.exports=a(185)},97:function(e,t,a){},98:function(e,t,a){}},[[75,1,2]]]);
//# sourceMappingURL=main.bf0a04de.chunk.js.map